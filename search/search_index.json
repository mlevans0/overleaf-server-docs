{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome","text":""},{"location":"#welcome","title":"Welcome","text":"<p>Welcome to the technical documentation for Overleaf Community Edition and Overleaf Server Pro! This documentation is designed to provide you with an in-depth understanding of the features, configuration options, and best practices for managing and utilizing Overleaf's collaborative writing and publishing platform within your own infrastructure.</p> <p>Overleaf is a powerful tool that facilitates collaborative authoring and publishing of LaTeX documents. The Server CE and Server Pro versions allow organizations to host their own instances of Overleaf, providing enhanced control, security, and customization over the platform's capabilities.</p> <p>Whether you're an administrator setting up Overleaf for your organization or a user looking to leverage Overleaf's collaborative features for document creation for your lab, this documentation will walk you through the necessary steps to install, configure, and utilize Server CE and Server Pro as an on-premise solution.</p> <p>Question</p> <p>Does your business or research organization need enhanced security, central administration, collaboration features, and Git integration? Overleaf offers Server Pro, an enterprise solution for teams of 10 or more. Talk to us. </p>"},{"location":"#what-is-the-difference-between-server-pro-and-server-ce","title":"What is the difference between Server Pro and Server CE?","text":"<p>Overleaf has two on-premise solutions - Server Pro and Server CE. Both versions run in Docker containers, isolating them from other applications on the same host. This provides an additional layer of security by preventing potential cross-application attacks. They have also been designed to run on air-gapped servers, which means they can be completely isolated from other networks, including the Internet. Docker provides tooling for transferring the application from an internet-connected to an air-gapped environment. After the initial download, no internet connection is required, significantly reducing the risk of external threats.</p> <p>Finally, Overleaf expedites security patches when updates for dependencies become available. This ensures any potential vulnerabilities can be addressed quickly. </p>"},{"location":"#server-pro","title":"Server Pro","text":"<p>Server Pro comes as a Docker container and is a drop in replacement for Server CE. Server Pro includes features such as SSO provided via LDAP and SAML2, improved security, tracked changes, comments, our optimized version of TexLive, visual editor mode, templates and admin panel. </p> <p>One of the key security features offered in Server Pro is Sandboxed Compiles. This feature uses separately created Docker containers to isolate each compile process into its own secure environment. Sandboxed Containers have limited capabilities and no access to outside resources like the host network. This prevents any potentially malicious code used in the compilation of a LaTeX project from affecting other users or projects.</p> <p>You can find more information about Server Pro for enterprise over on our website.</p> <p>Info</p> <p>We recommend enterprise organizations begin with Server CE to familiarize themselves with the platform's requirements and ensure a smooth experience before considering an upgrade to Server Pro.</p>"},{"location":"#server-ce","title":"Server CE","text":"<p>Server CE is a lite version of our LaTeX editing platform which can be freely self-installed and Server Pro is our full, officially supported, premium service. Server Pro is an excellent option for enterprise organizations that are looking for the ease and functionality of the Overleaf platform, but require full control of the infrastructure in which the application runs.</p>"},{"location":"#support","title":"Support","text":"<p>For customers using a self-hosted Server Pro instance we will provide reasonable support to assist with the resolution of technical issues relating to the installation, configuration, maintenance and general usage of Server Pro, to a single, named staff member.</p> <p>Support services for Server Pro specifically exclude:</p> <ul> <li>Direct support for the LaTeX language including layout, typesetting, and programming errors;</li> <li>Defects or errors resulting from any modifications to Server Pro unless made, instructed, or approved by us in writing;</li> <li>Support for any version of Server Pro other than:<ul> <li>The two (2) most current point releases of the current major version (currently 5.0.3); and</li> <li>The last released point release of the previous major version (currently 3.5.15, 4.2.3 and 4.2.4);</li> </ul> </li> <li>Support for any non-current version of Server Pro that is more than twenty-four (24) months old;</li> <li>Any fault in the environment or in any software or hardware used in conjunction with Server Pro; and</li> <li>Defects or errors caused by the use with any software products other than those specifically certified for use with Server Pro in this documentation.</li> </ul> <p>If you have any questions regarding your Server Pro instance, please reach out to either your Account Manager directly, or send us a message via our general contact form. </p> <p>Note</p> <p>Please note that we are not able to provide support for local installations of the free Server CE.</p>"},{"location":"#keeping-up-to-date","title":"Keeping up to date","text":"<p>Stay in the loop with the latest advancements and updates regarding Overleaf Server Server CE and Server Pro by signing up to our mailing list. </p> <p>By subscribing, you'll receive timely notifications about new features, enhancements, security patches, and valuable insights from the team. Keeping up to date is essential to ensure that you're making the most of your Overleaf server, staying secure, and leveraging the newest functionalities to enhance your collaborative writing and document editing workflows. </p>"},{"location":"administration/using-the-toolkit/","title":"Using the toolkit","text":"<p>The Toolkit uses <code>docker compose</code> to manage your servers Docker containers. The Toolkit provides you with a set of scripts which wrap <code>docker compose</code>, and helps take care of most of the more technical details for you.</p>"},{"location":"administration/using-the-toolkit/#the-bindocker-compose-wrapper","title":"The <code>bin/docker-compose</code> Wrapper","text":"<p>The <code>bin/docker-compose</code> script is a wrapper around <code>docker compose</code>. It loads configuration from the <code>config/</code> directory, before invoking <code>docker compose</code> with whatever arguments were passed to the script.</p> <p>You can treat <code>bin/docker-compose</code> as a transparent wrapper for the <code>docker compose</code> program installed on your machine.</p> <p>For example, we can check which containers are running with the following:</p> <pre><code>$ bin/docker-compose ps\n</code></pre>"},{"location":"administration/using-the-toolkit/#convenience-helpers","title":"Convenience Helpers","text":"<p>In addition to <code>bin/docker-compose</code>, the toolkit also provides a collection of convenient scripts to automate common tasks:</p> <ul> <li><code>bin/up</code>: shortcut for <code>bin/docker-compose up</code></li> <li><code>bin/start</code>: shortcut for <code>bin/docker-compose start</code></li> <li><code>bin/stop</code>: shortcut for <code>bin/docker-compose stop</code></li> <li><code>bin/shell</code>: starts a shell inside the main container</li> </ul> <p>backup-config  dev  docker-compose  doctor  error-logs  images  init  logs  mongo  shell  start  stop  up  upgrade</p> <p>Tip</p> <p>If you prefer to run your instance without attaching to the Docker logs you can run <code>bin/up -d</code> to run in detached mode.</p>"},{"location":"administration/using-the-toolkit/#checking-your-server","title":"Checking your server","text":"<p>The Toolkit includes a handy script called <code>bin/doctor</code> that produces a report pointing to any unfulfilled dependency.</p> <p>Before we continue any further, let's run the <code>bin/doctor</code> script and check that everything is working correctly.</p> <pre><code>bin/doctor\n</code></pre> <p>We should see some output similar to this:</p> <pre><code>====== Overleaf Doctor ======\n- Host Information\n    - Linux\n    - Output of 'lsb_release -a':\n            No LSB modules are available.\n            Distributor ID:     Ubuntu\n            Description:        Ubuntu 22.04.3 LTS\n            Release:    22.04\n            Codename:   jammy\n- Dependencies\n    - bash\n        - status: present\n        - version info: 5.1.16(1)-release\n    - docker\n        - status: present\n        - version info: Docker version 24.0.5, build ced0996\n    - realpath\n        - status: present\n        - version info: realpath (GNU coreutils) 8.32\n    - perl\n        - status: present\n        - version info: 5.034000\n    - awk\n        - status: present\n        - version info: GNU Awk 5.1.0, API: 3.0 (GNU MPFR 4.1.0, GNU MP 6.2.1)\n    - openssl\n        - status: present\n        - version info: OpenSSL 3.0.2 15 Mar 2022 (Library: OpenSSL 3.0.2 15 Mar 2022)\n    - docker compose\n        - status: present\n        - version info: Docker Compose version v2.20.2\n- Docker Daemon\n    - status: up\n====== Configuration ======\n- config/version\n    - status: present\n    - version: 4.1.0\n- config/overleaf.rc\n    - status: present\n    - values\n        - OVERLEAF_DATA_PATH: data/sharelatex\n        - SERVER_PRO: true\n            - logged in to quay.io: true\n        - SIBLING_CONTAINERS_ENABLED: true\n        - OVERLEAF_LISTEN_IP: 0.0.0.0\n        - OVERLEAF_PORT: 80\n        - MONGO_ENABLED: true\n        - MONGO_IMAGE: mongo:4.4\n        - MONGO_DATA_PATH: data/mongo\n        - REDIS_ENABLED: true\n        - REDIS_IMAGE: redis:6.2\n        - REDIS_DATA_PATH: data/redis\n- config/variables.env\n    - status: present\n    - values\n        - OVERLEAF_FILESTORE_BACKEND: fs\n        - OVERLEAF_HISTORY_BACKEND: fs\n====== Warnings ======\n- None, all good\n====== End ======\n</code></pre> <p>First, we see some information about the host system (the machine that the Toolkit is being run on), then some information about dependencies. If any dependencies are missing, we will see a warning here. Next, the doctor checks our local configuration. At the end, the doctor will print out some warnings, if any problems were encountered.</p> <p>If you run into problems with running the Toolkit, you should first run the <code>bin/doctor</code> script and check it's output for any warnings.</p> <p>Need help?</p> <p>Users of the free Server CE should open an issue on GitHub.</p> <p>Users of Server Pro should contact support@overleaf.com for assistance.</p> <p>In both cases, it is a good idea to include the output of the <code>bin/doctor</code> script in your message.    </p>"},{"location":"configuration/adding-learn-pages/","title":"Adding Learn pages","text":"<p>If you want or need access to Overleaf documentation on your instance of Server Pro, then set <code>OVERLEAF_PROXY_LEARN=true</code> (<code>SHARELATEX_PROXY_LEARN=true</code> for versions <code>4.x</code> and earlier) in <code>toolkit/variables.env</code> or add the environment variable to your <code>docker-compose.yml</code> file. Documentation will be enabled at the <code>/learn</code> path.</p> <p>This will proxy requests to the main Overleaf documentation site, where it is always up to date. </p> <p>Note</p> <p>Your local server will require access to the internet so it can perform external <code>GET</code> requests to overleaf.com.</p>","tags":["Server Pro"]},{"location":"configuration/branding/","title":"Branding","text":"<p>Important</p> <p>Starting with Overleaf CE/Server Pro <code>5.0.1</code> environment variables have been rebranded from <code>OVERLEAF_*</code> to <code>OVERLEAF_*</code>.</p> <p>If you're using a <code>4.x</code> version (or earlier) please make sure the variables are prefix accordingly (e.g. <code>OVERLEAF_NAV_TITLE</code> instead of <code>OVERLEAF_NAV_TITLE</code>)</p>"},{"location":"configuration/branding/#header","title":"Header","text":"<p>In this section, you we'll cover how to personalize key elements of your Server Pro instance. Using the following options you  have the ability to customize the site title, navigation links, header, footer, and logo according to your preferences. </p>"},{"location":"configuration/branding/#site-title","title":"Site title","text":"<p>The navigation bar title can be customized with the <code>OVERLEAF_NAV_TITLE</code> environment variable, this text is used in the top left corner of navigation if no logo is set.</p> <pre><code># add to config/variables.env\nOVERLEAF_NAV_TITLE=Our Overleaf Instance\n</code></pre> <p></p>"},{"location":"configuration/branding/#logo","title":"Logo","text":"<p>You can add a custom logo rather than using text by setting the environment variable <code>OVERLEAF_HEADER_IMAGE_URL</code>. This value should point to an externally hosted image file.</p> <pre><code># add to config/variables.env\nOVERLEAF_HEADER_IMAGE_URL=https://mysite.somewhere.com/img/logo.png\n</code></pre> <p></p>"},{"location":"configuration/branding/#header-navigation-links","title":"Header navigation links","text":"<p>Extra navigation items can be added to the navigation header by setting the <code>OVERLEAF_HEADER_EXTRAS</code> environment variable to a JSON array of objects. For example:</p> <pre><code>[\n  {\n    \"text\": \"Some link\",\n    \"url\": \"http://example.com/somelink\",\n    \"class\": \"subdued\",\n    \"only_when_logged_out\": true\n  },\n  {\n    \"text\": \"Help\",\n    \"class\": \"subdued\",\n    \"dropdown\": [\n      {\n        \"text\": \"Documentation\",\n        \"url\": \"/learn\"\n      },\n      {\n        \"text\": \"Contact Admin\",\n        \"url\": \"http://example.com/contact\"\n      }\n    ]\n  }\n]\n\n# add to toolkit/variables.env\nOVERLEAF_HEADER_EXTRAS=[{\"text\":\"Some link\",\"url\":\"http://example.com/somelink\",\"class\":\"subdued\",\"only_when_logged_out\":true},{\"text\":\"Help\",\"class\":\"subdued\",\"dropdown\":[{\"text\":\"Documentation\",\"url\":\"/learn\"},{\"text\":\"Contact Admin\",\"url\":\"http://example.com/contact\"}]}]\n</code></pre> <p></p>"},{"location":"configuration/branding/#footers","title":"Footers","text":"<p>It is possible to customise both the left and smaller right footer which is found on pages like <code>/project</code> using the environmental variables <code>OVERLEAF_LEFT_FOOTER</code> and the smaller <code>OVERLEAF_RIGHT_FOOTER</code></p> <p>Both expect an array of JSON which will be inserted.</p> <pre><code>[\n    {\n        \"text\": \"Powered by &lt;a href=\\\"https://www.sharelatex.com\\\"&gt;ShareLaTeX&lt;/a&gt; \u00a9 2016\"\n    },{\n        \"text\": \"Another page I want to link to can be found &lt;a href=\\\"here\\\"&gt;here&lt;/a&gt;\"\n    }\n]\n</code></pre> <p>This data needs to be valid JSON to work, with quotes escaped when passed through as an environmental variable</p> <pre><code># add to config/variables.env\nOVERLEAF_LEFT_FOOTER=[{\"text\": \"Powered by &lt;a href=\\\"https://www.sharelatex.com\\\"&gt;ShareLaTeX&lt;/a&gt; \u00a9 2016\"},{\"text\": \"Another page I want to link to can be found &lt;a href=\\\"here\\\"&gt;here&lt;/a&gt;\"} ]\nOVERLEAF_RIGHT_FOOTER=[{\"text\":\"Hello I am on the Right\"}]\n</code></pre> <p></p>"},{"location":"configuration/email/","title":"Configuring email","text":"<p>Overleaf supports sending email through two methods: Simple Mail Transfer Protocol (SMTP) and Amazon Simple Email Service (SES). SMTP can be used if you have an email server enabled on your localhost that is listening for local connections.</p>"},{"location":"configuration/email/#configure","title":"Configure","text":"<p>Email can be configured via environmental variables passed to the Docker container.</p>"},{"location":"configuration/email/#sender-configuration","title":"Sender Configuration","text":"Name Description <code>OVERLEAF_EMAIL_FROM_ADDRESS</code> The from address e.g. <code>'support@mycompany.com'</code> - Required: yes <code>OVERLEAF_EMAIL_REPLY_TO</code> The reply to address e.g. <code>'noreply@mycompany.com'</code>"},{"location":"configuration/email/#smtp","title":"SMTP","text":"Name Description <code>OVERLEAF_EMAIL_SMTP_HOST</code> The hostname or IP address to connect to. Needs to be accessible from the Docker container <code>OVERLEAF_EMAIL_SMTP_PORT</code> The port to connect to <code>OVERLEAF_EMAIL_SMTP_SECURE</code> If <code>true</code> the connection will use TLS when connecting to server. If <code>false</code> or not set, then TLS is used if server supports the <code>STARTTLS</code> extension. In most cases set this value to <code>true</code> if you are connecting to port <code>465</code>. For port <code>587</code> or <code>25</code> keep it <code>false</code> <code>OVERLEAF_EMAIL_SMTP_USER</code> The username that should be used to authenticate against the SMTP server <code>OVERLEAF_EMAIL_SMTP_PASS</code> The password associated with the SMTP username <code>OVERLEAF_EMAIL_SMTP_TLS_REJECT_UNAUTH</code> If 'false' this would open a connection to TLS server with self-signed or invalid TLS certificate <code>OVERLEAF_EMAIL_SMTP_IGNORE_TLS</code> When <code>true</code> and <code>OVERLEAF_EMAIL_SMTP_SECURE</code> is <code>false</code> then TLS is not used even if the server supports <code>STARTTLS</code> extension <code>OVERLEAF_EMAIL_SMTP_NAME</code> Optional hostname for TLS validation if <code>OVERLEAF_EMAIL_SMTP_HOST</code> was set to an IP address, defaults to hostname of the machine. <code>OVERLEAF_EMAIL_SMTP_LOGGER</code> When <code>true</code> prints logging messages to <code>web.log</code>."},{"location":"configuration/email/#amazon-ses-smtp-interface","title":"Amazon SES SMTP interface","text":"<p>You can read more about using the Amazon SES SMTP interface to send email here.</p> Name Description <code>OVERLEAF_EMAIL_SMTP_HOST</code> The hostname or IP address to connect to. Needs to be accessible from the Docker container <code>OVERLEAF_EMAIL_SMTP_PORT</code> The port to connect to <code>OVERLEAF_EMAIL_SMTP_USER</code> The username that should be used to authenticate against the SMTP server <code>OVERLEAF_EMAIL_SMTP_PASS</code> The password associated with the SMTP username"},{"location":"configuration/email/#amazon-ses-api","title":"Amazon SES API","text":"<p>You can read more about using the Amazon SES API to send email here.</p> Name Description <code>OVERLEAF_EMAIL_AWS_SES_ACCESS_KEY_ID</code> If using AWS SES the access key <code>OVERLEAF_EMAIL_AWS_SES_SECRET_KEY</code> If using AWS SES the secret key <code>OVERLEAF_EMAIL_AWS_SES_REGION</code> If not set, the default region is US-EAST-1"},{"location":"configuration/email/#aws-ses-with-instance-roles","title":"AWS SES with Instance Roles","text":"Name Description <code>OVERLEAF_EMAIL_DRIVER</code>: When this is set to <code>ses</code>, the email system will use the SES API method and rely on the configured instance roles to send email."},{"location":"configuration/email/#customisation","title":"Customisation","text":"Name Description <code>OVERLEAF_CUSTOM_EMAIL_FOOTER</code> Custom HTML which is appended to all emails. e.g. Example: <code>\"&lt;div&gt;This system is run by department x &lt;/div&gt; &lt;div&gt; If you have any questions please look at our faq &lt;a href='https://somwhere.com'&gt;here&lt;/a&gt;&lt;/div&gt;\"</code>"},{"location":"configuration/environment-variables/","title":"Environment variables","text":""},{"location":"configuration/environment-variables/#all-versions","title":"All versions","text":"<p>These environment variables are compatible with Server CE and Server Pro providing you with an easy migration path between these two on-premise versions. They can also be used with both Toolkit and Docker Compose deployments.</p> Name Description <code>OVERLEAF_SITE_URL</code> Where your instance of Overleaf is publicly available. This is used in public links, and when connecting over websockets, so must be configured correctly! <code>OVERLEAF_ADMIN_EMAIL</code> The email address where users can reach the person who runs the site. <code>OVERLEAF_APP_NAME</code> The name to display when talking about the running application. Defaults to 'Overleaf (Community Edition)'. <code>OVERLEAF_MONGO_URL</code> The URL of the Mongo database to use <code>OVERLEAF_REDIS_HOST</code> and <code>REDIS_HOST</code> The host name of the Redis instance to use. Both are required (see release notes) <code>OVERLEAF_REDIS_PORT</code> and <code>REDIS_PORT</code> The port of the Redis instance to use. Both are required (see release notes) <code>OVERLEAF_REDIS_PASS</code> The password to use when connecting to Redis (if applicable) <code>OVERLEAF_NAV_TITLE</code> Set the tab title of the application <code>OVERLEAF_SESSION_SECRET</code> A random string which is used to secure tokens, if load balancing this needs to be set to the same toke across boxes. If only 1 instance is being run it does not need to be set by the user. <code>OVERLEAF_COOKIE_SESSION_LENGTH</code> This environment variable allows you to override the default session cookie expiration time of 5 days. The override value provided should be specified in milliseconds. For example, to make the session last for 1 hour, set <code>COOKIE_SESSION_LENGTH=3600000</code>. (Added in Server Pro 4.2) <code>OVERLEAF_BEHIND_PROXY</code> Set to true if running behind a proxy like nginx/apache allowing it to correctly detect the forwarded IP address <code>OVERLEAF_SECURE_COOKIE</code> Set this to something non-zero to use a secure cookie. Only use this if your Overleaf instance is running behind a reverse proxy with SSL configured. <code>OVERLEAF_RESTRICT_INVITES_TO_EXISTING_ACCOUNTS</code> If set to <code>true</code>, will restrict project invites to email addresses which correspond with existing user accounts. <code>OVERLEAF_ALLOW_PUBLIC_ACCESS</code> If set to <code>true</code>, will allow non-authenticated users to view the site. The default is <code>false</code>, which means  non-authenticated users will be unconditionally redirected to the login page when they try to view any part of the site. Note, setting this option does not disable authentication or security in any way. This option is necessary if your users intend to make their projects public and have non-authenticated users view those projects. <code>OVERLEAF_ALLOW_ANONYMOUS_READ_AND_WRITE_SHARING</code> If set to <code>true</code>, will allow anonymous users to view and edit projects shared via the new <code>EMAIL_CONFIRMATION_DISABLED</code> When set to <code>true</code> the banner requesting email confirmation won't be displayed. <code>ADDITIONAL_TEXT_EXTENSIONS</code> an array of strings to configure additional extensions for editable files <code>OVERLEAF_STATUS_PAGE_URL</code> Custom status page URL (Added in Server Pro 3.4.0), e.g. <code>status.example.com</code> <code>OVERLEAF_FPH_INITIALIZE_NEW_PROJECTS</code> set to <code>'false'</code> to prevent new projects from being initialised with Full Project History (Added in Server Pro 3.5.0) <code>OVERLEAF_FPH_DISPLAY_NEW_PROJECTS</code> set to <code>'false'</code> to prevent new projects from displaying Full Project History instead of the legacy history (Added in Server Pro 3.5.0) <code>ENABLE_CRON_RESOURCE_DELETION</code> Set this environment variable to <code>true</code> to enable the automatic clean-up of deleted projects and users after 90 days."},{"location":"configuration/environment-variables/#password-restrictions","title":"Password restrictions","text":"<p>It is possible to enforce password restrictions on users when using the Overleaf login system (local accounts), not an SSO option such as LDAP. For SSO accounts, password policies will be enforced by your identity provider or directory service, additionally allowing support for multi-factor authentication. </p> Name Description <code>OVERLEAF_PASSWORD_VALIDATION_MIN_LENGTH</code> The minimum length required <code>OVERLEAF_PASSWORD_VALIDATION_MAX_LENGTH</code> The Maximum length allowed <code>OVERLEAF_PASSWORD_VALIDATION_PATTERN</code> is used to validate password strengthExample- <code>abc123</code> \u2013 password requires 3 letters and 3 numbers and be at least 6 characters long- <code>aA</code> \u2013 password requires lower and uppercase letters and be 2 characters long- <code>ab$3</code> \u2013 it must contain letters, digits and symbols and be 4 characters long Note: There are 4 groups of characters: letters, UPPERcase letters, digits, symbols. Everything that is neither letter, nor digit is considered to be a symbol."},{"location":"configuration/environment-variables/#server-pro-only","title":"Server Pro only","text":"<p>The environment variables listed below are only compatible with Server Pro and can be used with both Toolkit and Docker Compose deployments.</p>"},{"location":"configuration/environment-variables/#ldapad","title":"LDAP/AD","text":"Name Description <code>OVERLEAF_LDAP_URL</code> Required, The URL of the LDAP server, E.g. <code>ldaps://ldap.example.com:636</code> <code>OVERLEAF_LDAP_EMAIL_ATT</code> The email attribute the LDAP server will return, defaults to <code>mail</code> <code>OVERLEAF_LDAP_NAME_ATT</code> The property name holding the name of the user which is used in the application <code>OVERLEAF_LDAP_LAST_NAME_ATT</code> If your LDAP server has a first and last name then this can be used in conjunction with <code>OVERLEAF_LDAP_NAME_ATT</code> <code>OVERLEAF_LDAP_PLACEHOLDER</code> The placeholder for the login form, defaults to Username <code>OVERLEAF_LDAP_UPDATE_USER_DETAILS_ON_LOGIN</code> If set to <code>true</code>, will update the user first_name and last_name field on each login, and turn off the user-details form on /user/settings page. Otherwise, details will be fetched only on first login. <code>OVERLEAF_LDAP_BIND_DN</code> Optional, e.g. <code>uid=admin,ou=people,o=planetexpress.com</code>. <code>OVERLEAF_LDAP_BIND_CREDENTIALS</code> Password for <code>bindDn</code>. <code>OVERLEAF_LDAP_BIND_PROPERTY</code> Optional, default <code>dn</code>. Property of user to bind against client e.g. name, email <code>OVERLEAF_LDAP_SEARCH_BASE</code> The base DN from which to search for users by username. E.g. <code>ou=people,o=planetexpress.com</code> <code>OVERLEAF_LDAP_SEARCH_FILTER</code> LDAP search filter with which to find a user by username, e.g. <code>(uid={{ username }})</code>. Use the literal <code>{{ username }}</code> to have the given username be interpolated in for the LDAP search. If you are using Active Directory then the search filter <code>(sAMAccountName={{ username }})</code> may be more appropriate. <code>OVERLEAF_LDAP_SEARCH_SCOPE</code> Optional, default <code>sub</code>. Scope of the search, one of <code>base</code>, <code>one</code>, or <code>sub</code>. <code>OVERLEAF_LDAP_SEARCH_ATTRIBUTES</code> Optional, default all. Json array of attributes to fetch from LDAP server. <code>OVERLEAF_LDAP_GROUP_DN_PROPERTY</code> Optional, default <code>dn</code>. The property of user object to use in <code>{{ dn }}</code> interpolation of <code>groupSearchFilter</code>. <code>OVERLEAF_LDAP_GROUP_SEARCH_BASE</code> Optional. The base DN from which to search for groups. If defined, also <code>groupSearchFilter</code> must be defined for the search to work. <code>OVERLEAF_LDAP_GROUP_SEARCH_SCOPE</code> Optional, default <code>sub</code>. <code>OVERLEAF_LDAP_GROUP_SEARCH_FILTER</code> Optional. LDAP search filter for groups. The following literals are interpolated from the found user object: <code>{{ dn }}</code> the property configured with <code>groupDnProperty</code>. Optionally you can also assign a function instead, which passes a user object, from this a dynamic <code>groupSearchFilter</code> can be retrieved. <code>OVERLEAF_LDAP_GROUP_SEARCH_ATTRIBUTES</code> Optional, default all. Json array of attributes to fetch from LDAP server. <code>OVERLEAF_LDAP_CACHE</code> Optional, default <code>false</code>. If <code>true</code>, then up to 100 credentials at a time will be cached for 5 minutes. <code>OVERLEAF_LDAP_TIMEOUT</code> Optional, default Infinity. How long the client should let operations live for before timing out. <code>OVERLEAF_LDAP_CONNECT_TIMEOUT</code> Optional, default is up to the OS. How long the client should wait before timing out on TCP connections. <code>OVERLEAF_LDAP_TLS_OPTS_CA_PATH</code> A JSON array of paths to the CA file for TLS, must be accessible to the Docker container. E.g. <code>-env OVERLEAF_LDAP_TLS_OPTS_CA_PATH='[\"/var/one.pem\", \"/var/two.pem\"]'</code> <code>OVERLEAF_LDAP_TLS_OPTS_REJECT_UNAUTH</code> If <code>true</code>, the server certificate is verified against the list of supplied CAs."},{"location":"configuration/environment-variables/#saml-20","title":"SAML 2.0","text":"Name Description <code>OVERLEAF_SAML_IDENTITY_SERVICE_NAME</code> Display name for the Identity Provider, used on the login page. <code>OVERLEAF_SAML_EMAIL_FIELD</code> Name of the Email field in user profile, defaults to <code>nameID</code>. Alias: <code>OVERLEAF_SAML_EMAIL_FIELD_NAME</code> <code>OVERLEAF_SAML_FIRST_NAME_FIELD</code> Name of the firstName field in user profile, defaults to <code>givenName</code> <code>OVERLEAF_SAML_LAST_NAME_FIELD</code> Name of the lastName field in user profile, defaults to <code>lastName</code> <code>OVERLEAF_SAML_UPDATE_USER_DETAILS_ON_LOGIN</code> If set to <code>true</code>, will update the users firstName and lastName fields on each login, and turn off the user-details form on <code>/user/settings</code> page. <code>OVERLEAF_SAML_ENTRYPOINT</code> Entrypoint URL for the SAML Identity Service Example: <code>https://idp.example.com/simplesaml/saml2/idp/SSOService.php</code>Azure: <code>https://login.microsoftonline.com/8b26b46a-6dd3-45c7-a104-f883f4db1f6b/saml2</code> <code>OVERLEAF_SAML_CALLBACK_URL</code> Callback URL for Overleaf service. Should be the full URL of the <code>/saml/callback</code> path. Example: <code>https://sharelatex.example.com/saml/callback</code> <code>OVERLEAF_SAML_ISSUER</code> The issuer name <code>OVERLEAF_SAML_CERT</code> (required since <code>2.7.0</code>) Identity Provider's public signing certificate, used to validate incoming SAML messages, in single-line format.  Example: <code>MIICizCCAfQCCQCY8tKaMc0BMjANBgkqh...W==</code>  - See more information about passing keys and certificates. - See full documentation for more information. - An array of certificates can be provided to support certificate rotation as of 5.1.0. <code>OVERLEAF_SAML_PRIVATE_CERT</code> Optional, path to a file containing a PEM-formatted private key used to sign auth requests sent by passport-saml.Note: This would be better called <code>PRIVATE_KEY_FILE</code>, but <code>PRIVATE_CERT</code> is the current name.See more information about passing keys and certificates- See full documentation for more information. <code>OVERLEAF_SAML_DECRYPTION_CERT</code> Optional, public certificate matching the <code>OVERLEAF_SAML_DECRYPTION_PVK</code>, used for the metadata endpoint.- See more information about passing keys and certificates for how to pass the certificate.- See full documentation for more information. <code>OVERLEAF_SAML_SIGNING_CERT</code> Optional, public certificate matching <code>OVERLEAF_SAML_PRIVATE_CERT</code>. It's required when setting up the metadata endpoint if the strategy is configured with a <code>OVERLEAF_SAML_PRIVATE_CERT</code>.- An array of certificates can be provided to support certificate rotation. When supplying an array of certificates, the first entry in the array should match the current <code>OVERLEAF_SAML_PRIVATE_CERT</code>.- See more information about passing keys and certificates for how to pass the certificate.- See full documentation for more information. <code>OVERLEAF_SAML_DECRYPTION_PVK</code> Optional, private key that will be used to attempt to decrypt any encrypted assertions that are received, in PEM (multi-line) format.- See more information about passing keys and certificates for how to pass the key in PEM format.- See full documentation for more information. <code>OVERLEAF_SAML_SIGNATURE_ALGORITHM</code> Optionally set the signature algorithm for signing requests, valid values are <code>sha1</code> (default) or <code>sha256</code> <code>OVERLEAF_SAML_ADDITIONAL_PARAMS</code> JSON dictionary of additional query params to add to all requests <code>OVERLEAF_SAML_ADDITIONAL_AUTHORIZE_PARAMS</code> JSON dictionary of additional query params to add to 'authorize' requests. Example: <code>{\"some_key\": \"some_value\"}</code> <code>OVERLEAF_SAML_IDENTIFIER_FORMAT</code> If present, name identifier format to request from identity provider (Default: <code>urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress</code>) <code>OVERLEAF_SAML_ACCEPTED_CLOCK_SKEW_MS</code> Time in milliseconds of skew that is acceptable between client and server when checking OnBefore and  NotOnOrAfter assertion condition validity timestamps. Setting to <code>-1</code> will disable checking these conditions entirely. Default is <code>0</code>. <code>OVERLEAF_SAML_ATTRIBUTE_CONSUMING_SERVICE_INDEX</code> Optional, <code>AttributeConsumingServiceIndex</code> attribute to add to AuthnRequest to instruct the IdP which attribute set to attach to the response (link) <code>OVERLEAF_SAML_AUTHN_CONTEXT</code> If present, name identifier format to request auth context (Default: <code>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</code>) <code>OVERLEAF_SAML_FORCE_AUTHN</code> If <code>true</code>, the initial SAML request from the service provider specifies that the IdP should force re-authentication of the user, even if they possess a valid session. <code>OVERLEAF_SAML_DISABLE_REQUESTED_AUTHN_CONTEXT</code> If <code>true</code>, do not request a specific auth context. For example, you can this this to <code>true</code> to allow additional contexts such as password-less logins (<code>urn:oasis:names:tc:SAML:2.0:ac:classes:X509</code>). Support for additional contexts is dependant on your IdP. <code>OVERLEAF_SAML_SKIP_REQUEST_COMPRESSION</code> If set to <code>true</code>, the SAML request from the service provider won't be compressed. <code>OVERLEAF_SAML_AUTHN_REQUEST_BINDING</code> If set to <code>HTTP-POST</code>, will request authentication from IDP via HTTP POST binding, otherwise defaults to HTTP RedirectNote: If <code>OVERLEAF_SAML_AUTHN_REQUEST_BINDING</code> is set to <code>HTTP-POST</code>, then <code>OVERLEAF_SAML_SKIP_REQUEST_COMPRESSION</code> must also be set to <code>true</code>. <code>OVERLEAF_SAML_VALIDATE_IN_RESPONSE_TO</code> If truthy, then <code>InResponseTo</code> will be validated from incoming SAML responses <code>OVERLEAF_SAML_REQUEST_ID_EXPIRATION_PERIOD_MS</code> Defines the expiration time when a Request ID generated for a SAML request will not be valid if seen in a SAML response in the <code>InResponseTo</code> field.  Default is <code>8</code> hours. <code>OVERLEAF_SAML_CACHE_PROVIDER</code> Defines the implementation for a cache provider used to store request Ids generated in SAML requests as part of <code>InResponseTo</code> validation. Default is a built-in in-memory cache provider. See link for more information. <code>OVERLEAF_SAML_LOGOUT_URL</code> Base address to call with logout requests (Default: <code>entryPoint</code>) <code>OVERLEAF_SAML_LOGOUT_CALLBACK_URL</code> The value with which to populate the <code>Location</code> attribute in the <code>SingleLogoutService</code> elements in the generated service provider metadata. <code>OVERLEAF_SAML_ADDITIONAL_LOGOUT_PARAMS</code> JSON dictionary of additional query params to add to 'logout' requests"},{"location":"configuration/getting-server-pro/","title":"Getting Server Pro","text":"","tags":["Server Pro"]},{"location":"configuration/getting-server-pro/#obtaining-server-pro-image","title":"Obtaining Server Pro Image","text":"<p>Server Pro is distributed as a Docker image on the quay.io registry: <code>quay.io/sharelatex/sharelatex-pro</code></p> <p>You will have been supplied with a set of credentials when you signed up for a Server Pro license.</p> <p>First use your Server Pro credentials to log in to quay.io:</p> <pre><code>docker login quay.io\nUsername: &lt;sharelatex+your_key_name&gt;\nPassword: &lt;your_key&gt;\n</code></pre> <p>Then run <code>bin/docker-compose pull</code> to pull the image from the <code>quay.io</code> registry.</p>","tags":["Server Pro"]},{"location":"configuration/getting-server-pro/#switching-to-server-pro","title":"Switching to Server Pro","text":"<p>We recommend first setting up your Toolkit with the default Server CE image before switching to Server Pro.</p> <p>Toolkit deployments can enable Server Pro by editing the <code>config/overleaf.rc</code> file and changing the <code>SERVER_PRO</code> environment variable to <code>true</code>:</p> <pre><code>SERVER_PRO=true\n</code></pre> <p>The next time you run <code>bin/up</code>, the Toolkit will download and use the Server Pro image.</p>","tags":["Server Pro"]},{"location":"configuration/git-bridge/","title":"Git integration","text":"<p>The Git integration is available since Server Pro 4.0.1</p> <p>User documentation for this feature can be found here.</p> <p>If you\u2019re using the Overleaf Toolkit, the git-bridge can be enabled by setting <code>GIT_BRIDGE_ENABLED=true</code> in your <code>config/overleaf.rc</code> file.</p> <p>For users running a custom <code>docker-compose.yml</code>, add the following container configuration to your compose file:</p> <pre><code>git-bridge:\n    restart: always\n    image: quay.io/sharelatex/git-bridge:4.0.0 # tag should match the `sharelatex` container tag\n    volumes:\n        - ~/git_bridge_data:/data/git-bridge\n    container_name: git-bridge\n    expose:\n        - \"8000\"\n    environment:\n        GIT_BRIDGE_API_BASE_URL: \"http://sharelatex:3000/api/v0/\" # \"http://sharelatex/api/v0/\" for version 4.1.6 and earlier\n        GIT_BRIDGE_OAUTH2_SERVER: \"http://sharelatex\"\n        GIT_BRIDGE_POSTBACK_BASE_URL: \"http://git-bridge:8000\"\n        GIT_BRIDGE_ROOT_DIR: \"/data/git-bridge\"\n    user: root\n    command: [\"/server-pro-start.sh\"]\n</code></pre> <p>You\u2019ll also need to add a link to the <code>git-bridge</code> container in the <code>sharelatex</code> container, and define new environment variables:   </p> <p><pre><code>sharelatex:\n    links:\n        - git-bridge\n    environment:         \n         GIT_BRIDGE_ENABLED: true\n         GIT_BRIDGE_HOST: \"git-bridge\"\n         GIT_BRIDGE_PORT: \"8000\"\n         V1_HISTORY_URL: \"http://sharelatex:3100/api\"\n</code></pre> When authenticating a git client, users need a Personal Access Token (note that overleaf.com supports username/password, this is not the case for Server Pro). Users can manage the Personal Access Tokens through the application UI (see the documentation).</p> <p>We recommend you monitor your host resources after enabling the git-bridge. The load increase will depend on the number of users accessing the feature and the type of projects hosted in your instance (larger projects will generally be more resource intensive). </p>","tags":["Server Pro"]},{"location":"configuration/git-bridge/#swapping-projects-to-s3","title":"Swapping projects to S3","text":"<p>The Git integration stores a complete git repository on disk for each project that gets cloned by a user. If you have limited disk space, you can activate a swap job that will move repositories that are less used to AWS S3. If a swapped repository is needed again, it gets moved back to the disk. The following environment variables control the swap job:</p> <ul> <li><code>GIT_BRIDGE_SWAPSTORE_TYPE</code>: set this to \u201cs3\u201d to activate the swap job</li> <li><code>GIT_BRIDGE_SWAPSTORE_AWS_ACCESS_KEY</code>: your AWS access key</li> <li><code>GIT_BRIDGE_SWAPSTORE_AWS_SECRET</code>: your AWS secret</li> <li><code>GIT_BRIDGE_SWAPSTORE_S3_BUCKET_NAME</code>: this bucket will contain the zipped git repositories</li> <li><code>GIT_BRIDGE_SWAPSTORE_AWS_REGION</code>: the bucket\u2019s region</li> <li><code>GIT_BRIDGE_SWAPJOB_MIN_PROJECTS</code>: how many projects to keep on disk, at a minimum. (default: 50)</li> <li><code>GIT_BRIDGE_SWAPJOB_LOW_GIB</code>: low watermark for swapping. The swap job will move projects until disk usage is below this value. (default: 128 GB)</li> <li><code>GIT_BRIDGE_SWAPJOB_HIGH_GIB</code>: high watermark for swapping. The swap job will start swapping when disk usage reaches this value. (default: 256 GB)</li> <li><code>GIT_BRIDGE_SWAPJOB_INTERVAL_MILLIS</code>: amount of time between checking disk usage and running the swap job. (default: 3600000 ms = 1 hour)</li> </ul>","tags":["Server Pro"]},{"location":"configuration/ldap/","title":"LDAP/AD","text":"<p>Server Pro provides LDAP server integration for user authentication and is compatible with Active Directory systems. For Toolkit deployments, the LDAP integration is configured via the <code>variables.env</code> file</p>","tags":["Server Pro"]},{"location":"configuration/ldap/#configuration","title":"Configuration","text":"<p>Internally, the Overleaf LDAP integration uses the passport-ldapauth library. Most of these configuration options are passed through to the <code>server</code> config object which is used to configure <code>passport-ldapauth</code>. If you are having issues configuring LDAP, it is worth reading the README for <code>passport-ldapauth</code> to get a feel for the configuration it expects.</p> <p>To enable LDAP authentication the <code>EXTERNAL_AUTH</code> variable must be set to <code>ldap</code>:</p> <pre><code>EXTERNAL_AUTH=ldap\n</code></pre> <p>You can see a full list of available configuration options for LDAP/AD over on the Environments variables page. </p> <p>After bootstrapping Server Pro for the first time with LDAP authentication, an existing LDAP user must be given admin permissions by visiting the <code>/launchpad</code> page (or via CLI, but in this case ignoring password confirmation). </p> <p>LDAP users will appear in Overleaf Admin Panel once they log in first time with their initial credentials.</p> <p>Note</p> <p>To preserve backward compatibility with older configuration files, if <code>EXTERNAL_AUTH</code> is not set, but <code>OVERLEAF_LDAP_URL</code> is set, then the LDAP module will be activated. We still recommend setting <code>EXTERNAL_AUTH</code> explicitly.</p>","tags":["Server Pro"]},{"location":"configuration/ldap/#example-configuration","title":"Example configuration","text":"<p>At Overleaf, we test the LDAP integration against a test openldap server. The following is an example of a working configuration:</p> <pre><code># added to variables.env\n\nEXTERNAL_AUTH=ldap\nOVERLEAF_LDAP_URL=ldap://ldap:389\nOVERLEAF_LDAP_SEARCH_BASE=ou=people,dc=planetexpress,dc=com\nOVERLEAF_LDAP_SEARCH_FILTER=(uid={{ username }})\nOVERLEAF_LDAP_BIND_DN=cn=admin,dc=planetexpress,dc=com\nOVERLEAF_LDAP_BIND_CREDENTIALS=GoodNewsEveryone\nOVERLEAF_LDAP_EMAIL_ATT=mail\nOVERLEAF_LDAP_NAME_ATT=cn\nOVERLEAF_LDAP_LAST_NAME_ATT=sn\nOVERLEAF_LDAP_UPDATE_USER_DETAILS_ON_LOGIN=true\n</code></pre> <p>The <code>openldap</code> needs to run in the same network as the <code>sharelatex</code> container (which by default would be <code>overleaf_default</code>), so we'll proceed with the following steps:</p> <ul> <li>Run <code>docker network create overleaf_default</code> (will possibly fail due to a <code>network with name overleaf_default already exists</code> error, that's ok).</li> <li>Start <code>openldap</code> container with <code>docker run --network=overleaf_default --name=ldap rroemhild/test-openldap:1.1</code></li> <li>Edit <code>variables.env</code> to add the LDAP Environment Variables as listed above.</li> <li>Restart Server Pro  You should be able to login using <code>fry</code> as both username and password.</li> </ul>","tags":["Server Pro"]},{"location":"configuration/ldap/#debugging","title":"Debugging","text":"<p>As LDAP is heavily configurable and flexible by nature it can be a good starting point to have a working example with <code>ldapsearch</code> or even used by another application.</p> <p>The following command will connect to the LDAP server at <code>ldap</code> on port <code>389</code>. It will then bind to the server using the distinguished name (DN) <code>admin@planetexpress.com</code> and password <code>password123</code>. The base DN for the search will be <code>ou=people,dc=planetexpress,dc=com</code>. The search filter is set to return entries where the Common Name (CN) contains <code>fry</code>, and it will return the <code>mail</code> attribute of these entries. </p> <p>When running this search command against your own service please ensure that you replace <code>fry</code>, <code>password123</code>, and <code>planetexpress.com</code> with your actual username, password, and domain. Also, make sure that the LDAP server is accessible and the provided details are correct.</p> <pre><code>ldapsearch -H ldap://ldap:389 -x -D admin@planetexpress.com -w password123  -b ou=people,dc=planetexpress,dc=com \"CN=\\*fry\\*\" mail\n</code></pre>","tags":["Server Pro"]},{"location":"configuration/localization/","title":"Localization","text":""},{"location":"configuration/localization/#i18n-languages","title":"i18n Languages","text":"<p>Both Server CE and Server Pro have been translated into multiple languages. </p> <p>The language can be set via <code>OVERLEAF_SITE_LANGUAGE</code> with one of the following options:</p> <ul> <li><code>en</code> - English (default)</li> <li><code>es</code> - Spanish</li> <li><code>pt</code> - Portuguese</li> <li><code>de</code> - German</li> <li><code>fr</code> - French</li> <li><code>cs</code> - Czech</li> <li><code>nl</code> - Dutch</li> <li><code>sv</code> - Swedish</li> <li><code>it</code> - Italian</li> <li><code>tr</code> - Turkish</li> <li><code>zh-CN</code> - Chinese (simplified)</li> <li><code>no</code> - Norwegian</li> <li><code>da</code> - Danish</li> <li><code>ru</code> - Russian</li> <li><code>ko</code> - Korean</li> <li><code>ja</code> - Japanese</li> <li><code>pl</code> - Polish</li> <li><code>fi</code> - Finnish</li> </ul> <p>Some of these are more complete than others, we always endeavour to have all supported languages fully translated, if you would like to help with our translations please get in touch!</p>"},{"location":"configuration/localization/#multi-language-support","title":"Multi language support","text":"<p>Overleaf can support multiple languages per container. This is done via different domains configured to respond in a set language using the env variable <code>OVERLEAF_LANG_DOMAIN_MAPPING</code> with an escaped JSON string.</p> <pre><code>OVERLEAF_LANG_DOMAIN_MAPPING = '\n    {\n        \"www\": {\n        \"lngCode\": \"en\",\n        \"url\": \"https:\\/\\/www.example.com\"\n        },\n        \"fr\": {\n        \"lngCode\": \"fr\",\n        \"url\": \"https:\\/\\/fr.example.com\"\n        },\n        \"de\": {\n        \"lngCode\": \"de\",\n        \"url\": \"https:\\/\\/de.example.com\"\n        },\n        \"sv\": {\n        \"lngCode\": \"sv\",\n        \"url\": \"https:\\/\\/sv.example.com\"\n        },\n        \"zh\": {\n        \"lngCode\": \"zh-CN\",\n        \"url\": \"https:\\/\\/zh.example.com\"\n        },\n        \"es\": {\n        \"lngCode\": \"es\",\n        \"url\": \"https:\\/\\/es.example.com\"\n        }\n    }'\n</code></pre>"},{"location":"configuration/logging/","title":"Logging","text":""},{"location":"configuration/logging/#overview","title":"Overview","text":"<p>Server CE and Server Pro are both complex systems that are made up of many different services and processes that all generate logs that ares stored in <code>/var/log/sharelatex/</code>, where they can be monitored and analyzed for troubleshooting, security purposes, and understanding system activity.</p> <p>If an error occurs in any of the processes it will be written to the respective log file such as <code>/var/log/sharelatex/web.log</code>.</p>"},{"location":"configuration/logging/#overleaf-toolkit-users","title":"Overleaf Toolkit users","text":"<p>Overleaf Toolkit users can have a look at the logs inside the container using the <code>bin/logs</code> script:</p> <p><pre><code>$ bin/logs web\n\n# You can use --help for help\n$ bin/logs --help\n\n# You can also look at the logs for multiple services at once:\n$ bin/logs filestore docstore web clsi\n\n# You can follow the log output using the -f flag\n$ bin/logs -f filestore docstore web clsi\n\n# You can use the -n {number} flag to limit the number of lines to print (default 50)\n$ bin/logs -n 50 web\n\n# You can use the -n all flag to show all log lines\n$ bin/logs -n all web\n\n# You can use &gt; to redirect the output to a file\n$ bin/logs -n all web &gt; web.log\n</code></pre> You can use the <code>bin/logs</code> script to view logs for the following services: <code>clsi</code>, <code>contacts</code>, <code>docstore</code>, <code>document-updater</code>, <code>filestore</code>, <code>git-bridge</code>, <code>mongo</code>, <code>notifications</code>, <code>real-time</code>, <code>redis</code>, <code>spelling</code>, <code>tags</code>, <code>track-changes</code>, <code>web</code>, <code>history-v1</code>, <code>project-history</code>.</p>"},{"location":"configuration/logging/#copying-logs","title":"Copying logs","text":"<p>You can copy log files from the main <code>sharelatex</code> container to local computer using the following command:</p> <pre><code>docker cp sharelatex:/var/log/sharelatex/{service-name}.log {service-name}.log\n</code></pre>"},{"location":"configuration/logging/#tracking-project-access","title":"Tracking project access","text":"<p>It is possible to see who and when a project is loaded with the following command:</p> <pre><code>docker exec sharelatex bash -c \"grep \"join project request\" /var/log/sharelatex/web.log\"\n</code></pre> <p>This will give both the <code>timestamp</code>, <code>user_id</code> and <code>project_id</code>.</p>"},{"location":"configuration/overleaf-toolkit/","title":"Files and locations","text":"<p>This page describes the configuration files that are used to configure the Overleaf Toolkit.</p>"},{"location":"configuration/overleaf-toolkit/#configuration-file-location","title":"Configuration File Location","text":"<p>All user-owned configuration files are found in the <code>config/</code> directory.</p> <p>This directory is excluded from the git revision control system, so it will not be changed by updating the Toolkit code. The Toolkit will not change any data in the <code>config/</code> directory without your permission.</p> <p>Note</p> <p>Changes to the configuration files will not be automatically applied to existing containers, even if the container is stopped and restarted (with <code>bin/stop</code> and <code>bin/start</code>). To apply the changes, run <code>bin/up</code>, and <code>docker compose</code> will automatically apply the configuration changes to a new container. (Or, run <code>bin/up -d</code>, if you prefer to not attach to the Docker logs)</p>"},{"location":"configuration/overleaf-toolkit/#the-overleafrc-file","title":"The <code>overleaf.rc</code> File","text":"<p>The <code>config/overleaf.rc</code> file contains the most important top level configuration settings used by the Toolkit. It contains statements that set variables, in the format <code>VARIABLE_NAME=value</code>.</p> <p>To see a breakdown of all available configuration options see our Toolkit settings section.</p>"},{"location":"configuration/overleaf-toolkit/#the-variablesenv-file","title":"The <code>variables.env</code> File","text":"<p>The <code>config/variables.env</code> file contains environment variables that are loaded into the <code>sharelatex</code> container, and used to configure the Overleaf microservices. These include the name of the application, as displayed in the header of the web interface, settings for sending emails, and other premium settings such as SSO for use with Server Pro.</p> <p>To see a breakdown of all available environment variables see our Environment variables section.</p>"},{"location":"configuration/overleaf-toolkit/#the-version-file","title":"The <code>version</code> File","text":"<p>The <code>config/version</code> file contains the version number of the Docker image that will be used to create the running instance of your Overleaf server.</p> <p>Note</p> <p>Changes to these configuration files will not be automatically applied to existing containers, even if the container is stopped and restarted (with <code>bin/stop</code> and <code>bin/start</code>). </p> <p>To apply your changes, run <code>bin/up</code>, and the Toolkit will automatically create a new container for you with configuration changes applied. </p>"},{"location":"configuration/overleaf-toolkit/#the-docker-composeoverrideyml-file","title":"The <code>docker-compose.override.yml</code> File","text":"<p>If present, the <code>config/docker-compose.override.yml</code> file will be included in the invocation to <code>docker compose</code>. This is useful for overriding configuration specific to Docker compose.</p> <p>See the docker-compose documentation for more details.</p>"},{"location":"configuration/s3/","title":"Configuring S3","text":"<p>This document covers the setup of S3 in Server CE and Server Pro.</p> <p>A separate guide can be found on migrating existing data to S3 compatible storage.</p>"},{"location":"configuration/s3/#when-to-consider-using-s3-for-data-storage","title":"When to consider using S3 for data storage","text":"<p>For instances with fewer than 1000 seats we recommend using local disk storage with regular consistent backups.</p> <p>For larger instances with more than 1000 seats that reach limits of their local storage (size or throughput), we recommend using a S3 compatible object storage back end over other network based storage solutions like NFS.</p>"},{"location":"configuration/s3/#s3-compatible-object-storage-options","title":"S3 compatible object storage options","text":"<p>Here are the most popular options for S3 compatible object storage:</p> <ul> <li>AWS S3, managed, we suggest picking AWS S3 when running Server CE/Server Pro on AWS</li> <li>Min.io, self-hosted</li> <li>Ceph.io, self-hosted</li> <li>Other hosting providers also have some kind of managed S3 compatible object storage, you may want to use these instead of running your own when already   running Server CE/Server Pro at such a provider.</li> </ul>"},{"location":"configuration/s3/#latency-considerations-when-picking-a-s3-compatible-object-storage","title":"Latency considerations when picking a S3 compatible object storage","text":"<p>The latency between the Server CE/Server Pro instance and your S3 compatible object storage is a big contributor to the time it takes to complete the migration. The latency also impacts the file-upload performance in Server CE/Server Pro and slow file-downloads can have a big impact on PDF compile times as well.We suggest minimizing the geo-graphical distance between your Server CE/Server Pro instance and the S3 compatible object storage. In a managed environment, this would mean provisioning a bucket in the same region, and for an on-premise solution, running the two on the same campus.</p>"},{"location":"configuration/s3/#s3-setup","title":"S3 setup","text":"<p>We need four \"buckets\" and two restricted user accounts.</p> <p>Buckets should not be publicly accessible</p> <p>Note</p> <p>The history related items are needed from Server CE and Server Pro v3.5 onwards.</p> Bucket Usage Service Previously in <code>/var/lib/overleaf/data</code> <code>overleaf-user-files</code> project user files filestore <code>user_files</code> <code>overleaf-template-files</code> template files filestore <code>template_files</code> <code>overleaf-project-blobs</code> project history blobs history <code>history/overleaf-project-blobs</code> <code>overleaf-chunks</code> history chunks history <code>history/overleaf-chunks</code> <p>You may want/need to pick a different name, be sure to use the custom buckets in all the commands.</p> <p>The following will use placeholders for actual credentials:</p> Environment variable Description <code>OVERLEAF_FILESTORE_S3_ACCESS_KEY_ID</code> The access key/username of the restricted user of the filestore service. <code>OVERLEAF_FILESTORE_S3_SECRET_ACCESS_KEY</code> The secret key/password of the restricted user of the filestore service. <code>OVERLEAF_HISTORY_S3_ACCESS_KEY_ID</code> The access key/username of the restricted user of the history service. <code>OVERLEAF_HISTORY_S3_SECRET_ACCESS_KEY</code> The secret key/password of the restricted user of the history service. <p>Server CE and Server Pro only needs a small set of permissions on each bucket:</p> <ul> <li>create object</li> <li>get object</li> <li>delete object</li> <li>list bucket</li> </ul>"},{"location":"configuration/s3/#access-policies","title":"Access Policies","text":"<p>Here is how a policy for the filestore user could look like:</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:ListBucket\"\n      ],\n      \"Resource\": \"arn:aws:s3:::overleaf-user-files\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:PutObject\",\n        \"s3:GetObject\",\n        \"s3:DeleteObject\"\n      ],\n      \"Resource\": \"arn:aws:s3:::overleaf-user-files/*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:ListBucket\"\n      ],\n      \"Resource\": \"arn:aws:s3:::overleaf-template-files\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:PutObject\",\n        \"s3:GetObject\",\n        \"s3:DeleteObject\"\n      ],\n      \"Resource\": \"arn:aws:s3:::overleaf-template-files/*\"\n    }\n  ]\n}\n</code></pre> <p>Here is how a policy for the history user could look like:</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:ListBucket\"\n      ],\n      \"Resource\": \"arn:aws:s3:::overleaf-project-blobs\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:PutObject\",\n        \"s3:GetObject\",\n        \"s3:DeleteObject\"\n      ],\n      \"Resource\": \"arn:aws:s3:::overleaf-project-blobs/*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:ListBucket\"\n      ],\n      \"Resource\": \"arn:aws:s3:::overleaf-chunks\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:PutObject\",\n        \"s3:GetObject\",\n        \"s3:DeleteObject\"\n      ],\n      \"Resource\": \"arn:aws:s3:::overleaf-chunks/*\"\n    }\n  ]\n}\n</code></pre>"},{"location":"configuration/s3/#overview-of-variables","title":"Overview of variables","text":""},{"location":"configuration/s3/#when-using-aws-s3","title":"When using AWS S3","text":"<pre><code># Enable S3 backend for filestore\nOVERLEAF_FILESTORE_BACKEND=s3\n\n# Bucket name for project files\nOVERLEAF_FILESTORE_USER_FILES_BUCKET_NAME=overleaf-user-files\n\n# Bucket name for template files\nOVERLEAF_FILESTORE_TEMPLATE_FILES_BUCKET_NAME=overleaf-template-files\n\n# Key for filestore user\nOVERLEAF_FILESTORE_S3_ACCESS_KEY_ID=...\n\n# Secret for filestore user\nOVERLEAF_FILESTORE_S3_SECRET_ACCESS_KEY=...\n\n# Bucket region you picked when creating the buckets.\nOVERLEAF_FILESTORE_S3_REGION=\"\"\n\n# Enable S3 backend for history\nOVERLEAF_HISTORY_BACKEND=s3\n\n# Bucket name for project history blobs\nOVERLEAF_HISTORY_PROJECT_BLOBS_BUCKET=overleaf-project-blobs\n\n# Bucket name for history chunks\nOVERLEAF_HISTORY_CHUNKS_BUCKET=overleaf-chunks\n\n# Key for history user\nOVERLEAF_HISTORY_S3_ACCESS_KEY_ID=...\n\n# Secret for history user\nOVERLEAF_HISTORY_S3_SECRET_ACCESS_KEY=...\n\n# Bucket region you picked when creating the buckets.\nOVERLEAF_HISTORY_S3_REGION=\"\"\n</code></pre>"},{"location":"configuration/s3/#when-using-a-self-hosted-option","title":"When using a self-hosted option","text":"<pre><code># Enable S3 backend for filestore\nOVERLEAF_FILESTORE_BACKEND=s3\n\n# Bucket name for project files\nOVERLEAF_FILESTORE_USER_FILES_BUCKET_NAME=overleaf-user-files\n\n# Bucket name for template files\nOVERLEAF_FILESTORE_TEMPLATE_FILES_BUCKET_NAME=overleaf-template-files\n\n# Key for filestore user\nOVERLEAF_FILESTORE_S3_ACCESS_KEY_ID=...\n\n# Secret for filestore user\nOVERLEAF_FILESTORE_S3_SECRET_ACCESS_KEY=...\n\n# S3 provider endpoint\nOVERLEAF_FILESTORE_S3_ENDPOINT=http://10.10.10.10:9000\n\n# Path style addressing of buckets. Most likely you need to set this to \"true\".\nOVERLEAF_FILESTORE_S3_PATH_STYLE=\"true\"\n\n# Bucket region. Most likely you do not need to configure this.\nOVERLEAF_FILESTORE_S3_REGION=\"\"\n\n# Enable S3 backend for history\nOVERLEAF_HISTORY_BACKEND=s3\n\n# Bucket name for project history blobs\nOVERLEAF_HISTORY_PROJECT_BLOBS_BUCKET=overleaf-project-blobs\n\n# Bucket name for history chunks\nOVERLEAF_HISTORY_CHUNKS_BUCKET=overleaf-chunks\n\n# Key for history user\nOVERLEAF_HISTORY_S3_ACCESS_KEY_ID=...\n\n# Secret for history user\nOVERLEAF_HISTORY_S3_SECRET_ACCESS_KEY=...\n\n# S3 provider endpoint\nOVERLEAF_HISTORY_S3_ENDPOINT=http://10.10.10.10:9000\n\n# Path style addressing of buckets. Most likely you need to set this to \"true\".\nOVERLEAF_HISTORY_S3_PATH_STYLE=\"true\"\n\n# Bucket region. Most likely you do not need to configure this.\nOVERLEAF_HISTORY_S3_REGION=\"\"\n</code></pre>"},{"location":"configuration/s3/#minio-setup","title":"minio setup","text":"<p>Note</p> <p><code>MINIO_ROOT_USER</code> and <code>MINIO_ROOT_PASSWORD</code> are the root credentials of the minio instance.</p> <p>Please follow the official documentation for obtaining a copy of <code>mc</code>.</p> <pre><code>mc alias set s3 http://10.10.10.10:9000 MINIO_ROOT_USER MINIO_ROOT_PASSWORD\n\n# Put the contents of the policies from the previous section in the\n# respective json file policy-filestore.json and policy-history.json.\n# Reminder: Replace the bucket names and credentials accordingly.\n\n# filestore buckets, user and policy\nmc mb --ignore-existing s3/overleaf-user-files\nmc mb --ignore-existing s3/overleaf-template-files\nmc admin user add s3 \\\n  OVERLEAF_FILESTORE_S3_ACCESS_KEY_ID \\\n  OVERLEAF_FILESTORE_S3_SECRET_ACCESS_KEY\nmc admin policy create s3 overleaf-filestore policy-filestore.json\nmc admin policy attach s3 overleaf-filestore \\\n  --user=OVERLEAF_FILESTORE_S3_ACCESS_KEY_ID\n\n# history buckets, user and policy\nmc mb --ignore-existing s3/overleaf-project-blobs\nmc mb --ignore-existing s3/overleaf-chunks\nmc admin user add s3 \\\n  OVERLEAF_HISTORY_S3_ACCESS_KEY_ID \\\n  OVERLEAF_HISTORY_S3_SECRET_ACCESS_KEY\nmc admin policy create s3 overleaf-history policy-history.json\nmc admin policy attach s3 overleaf-history \\\n  --user=OVERLEAF_HISTORY_S3_ACCESS_KEY_ID\n</code></pre>"},{"location":"configuration/saml2/","title":"SAML 2.0","text":"<p>Server Pro provides SAML 2.0 server integration for user authentication. For Toolkit deployments, the SAML 2.0 integration is configured via the <code>variables.env</code> file.</p> <p>You can see a full list of available configuration options for SAML 2.0 over on the Environments variables page. </p>","tags":["Server Pro"]},{"location":"configuration/saml2/#configuration","title":"Configuration","text":"<p>Internally, the Overleaf SAML 2.0 integration uses the passport-SAML library. Most of these configuration options are passed through to the <code>server</code> configuration object which is used to configure <code>passport-SAML</code>. </p> <p>If you are having issues configuring SAML 2.0, it is worth reading the README for <code>passport-SAML</code> to get a feel for the configuration it expects.</p> <p>To enable the SAML 2.0 module, the <code>EXTERNAL_AUTH</code> variable must be set to <code>saml</code>:</p> <pre><code>EXTERNAL_AUTH=saml\n</code></pre> <p>Note</p> <p>To preserve backward compatibility with older configuration files, if <code>EXTERNAL_AUTH</code> is not set, but <code>OVERLEAF_SAML_ENTRYPOINT</code> is set, then the SAML 2.0 module will be activated. We still recommend setting <code>EXTERNAL_AUTH</code> explicitly</p>","tags":["Server Pro"]},{"location":"configuration/saml2/#passing-keys-and-certificates","title":"Passing keys and certificates","text":"<p>As of Server Pro <code>2.7.0</code>:</p> <ul> <li>The value of the <code>OVERLEAF_SAML_CERT</code> environment variable cannot be empty if SAML 2.0 is enabled (with <code>EXTERNAL_AUTH=saml</code>, or if <code>OVERLEAF_SAML_ENTRYPOINT</code> is set).</li> </ul> <p>As of Server Pro <code>2.5.0</code>:</p> <ul> <li>The value of the <code>OVERLEAF_SAML_CERT</code> environment variable must be passed in single-line format (without the begin and end lines from the PEM format; see below for more information).</li> <li>The value of the <code>OVERLEAF_SAML_PRIVATE_CERT</code> environment variable should be a full path to a file which contains the private key in PEM format.</li> <li>The value of the <code>OVERLEAF_SAML_DECRYPTION_PVK</code> environment variable must be passed in PEM format (multi-line). (But single-line may be supported soon.)</li> </ul> <p>To pass a key or certificate in single-line format, you can just specify it as a string (don't include the begin or end lines, any internal whitespace, or any newline escapes, e.g. <code>\\n</code>, also do not add quotes):</p> <pre><code>OVERLEAF_SAML_CERT=MIIEowIBAAKCAQEAxmJWY0eJcuV2uBtLnQ4004fuknbODo5xIyRhkYNkls5n9OrBq4Lok6cjv7G2Q8mxAdlIUmzhTSyuNkrMMKZrPaMsAkNKE/aNpeWuSLXqcMs8T/8gYCDcEmC5KYEJakNtKb3ZX2FKwT4yHHpsNomLDzJD5DyJKbRpNBm2no7ggIy7TQRJ2H00mogQIQu8/fUANXVeGPshvLJU8MXEy/eiXkHJIT3DDA4VSr/C/tfP0tGJSNTM874urc4zej+4INuTuMPtesZS47J0AsPxQuxengS4M76cVt5cH+Iqd1nKe5UqiSKvLCXacPYg/T/Kdx0tBnwHIjKo/cbzZ+r+XynsCwIDAQABAoIBAFPWWwu5v6x+rJ1Ba8MDre93Eqty6cHdEJL5XQJRtMDGmcg3LYF94SwFBmaMg6pCIjvVx2qN+OjUaQsosQIeUlPKEV8jcLrfBx2E4xJ3Tow8V1C3UMdPG7Hojler4H633/oz8RkN1Lm1vxep5PFnTw0tAOQDcTPeulb6RuLbHqU0FEnf/jVOMhtPLcMAwJ3fkAJQ+ljFW2VKCQ83d+ci1p+NHY/dbGLSR4lK58mVghcRMO3zhe5scrbECHJMfT6fCb2TXdjaueFUGC6+fqUXvDj8HRfUilzTegNq8ZhwgMSw1HeX/PuiczSKc3aHYSsohMBugTErnkW+qF4ZkE+kxgECgYEA/sm7umcyFuZME+RWYL8Gsp8agH1OGEgsmIiMi1z6RTlTmdR8fN18ItzXyW+363VZln/1b5wCaPdLIxgASxybLAaxnKAXfmL7QvyVAaMwxj7N0ogvMQoNx2VuSGZSam2+LFVIMWHq1C+3fvVnCDLm6oHvIMK/zvEsPBBtz+L6rlECgYEAx1PrKogaGHCi1XgsrNv9aFaayRvmhzZbmiigF0iWKAd3KKww94BdyyGSVfMfyL23LAbMQDCrDNGpYAnpNZo/cL+OcGPYzlPsWDBrJub1HOA/H3WQlP4oEcfdbmJZhIkEwTGFHaCHynEu4ekiCrWz9+XVNCquTyqnmaVDEzAfEZsCgYA8jQbfUt0Vkh+sboyUq3FVC/jJZn4jyStICNOV3z/fKbOTkGsRZbW1t1RVHAbSn23uFXTn1GTCO1sQ+QhA0YiTGvgk5+sNb0qVbd+fpv/VbWGO0iyc8+24YIOoEyEtB+21LYNdsQ6U5M4wDvQwf6BfRQfmekIJVUmU8LaYPDIlMQKBgDSRiT/aTSeM7STnYMDl89sEnCXV2eJnD5mEhVQerJs5/M8ZOoDLtfDQlctdJ1DF1/0gfdWgADyNPuI5OuwMFhciLequKoufzoEjo97KonJPIdamJs9kiCTIVTm7bmhpyns5GCZMJAPb/cVOus+gRCpozuXHK9ltIm5/C0WQN2FpAoGBAOss6RN2krieqbn1mG8e2v5mMUd0CJkiJu2y5MnF3dYHXSQ3/ePAh/YgJOthpgYgBh+mV0DLqJhx/1DLS/xiqcoHDlndQDmYbtvvY7RlMo00+nGzkRVOfrqyhC+1KsYHGPbSQixNQXtvFbAAVMSo+RRBkVGINYGDFnlQUpkppYRk\n</code></pre> <p>To pass a key or certificate in multi-line format, wrap the entire value in double quotes and use new line characters (<code>\\n</code>) as usual:</p> <pre><code>OVERLEAF_SAML_DECRYPTION_PVK=\"-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAxmJWY0eJcuV2uBtLnQ4004fuknbODo5xIyRhkYNkls5n9OrB\nq4Lok6cjv7G2Q8mxAdlIUmzhTSyuNkrMMKZrPaMsAkNKE/aNpeWuSLXqcMs8T/8g\nYCDcEmC5KYEJakNtKb3ZX2FKwT4yHHpsNomLDzJD5DyJKbRpNBm2no7ggIy7TQRJ\n2H00mogQIQu8/fUANXVeGPshvLJU8MXEy/eiXkHJIT3DDA4VSr/C/tfP0tGJSNTM\n874urc4zej+4INuTuMPtesZS47J0AsPxQuxengS4M76cVt5cH+Iqd1nKe5UqiSKv\nLCXacPYg/T/Kdx0tBnwHIjKo/cbzZ+r+XynsCwIDAQABAoIBAFPWWwu5v6x+rJ1B\na8MDre93Eqty6cHdEJL5XQJRtMDGmcg3LYF94SwFBmaMg6pCIjvVx2qN+OjUaQso\nsQIeUlPKEV8jcLrfBx2E4xJ3Tow8V1C3UMdPG7Hojler4H633/oz8RkN1Lm1vxep\n5PFnTw0tAOQDcTPeulb6RuLbHqU0FEnf/jVOMhtPLcMAwJ3fkAJQ+ljFW2VKCQ83\nd+ci1p+NHY/dbGLSR4lK58mVghcRMO3zhe5scrbECHJMfT6fCb2TXdjaueFUGC6+\nfqUXvDj8HRfUilzTegNq8ZhwgMSw1HeX/PuiczSKc3aHYSsohMBugTErnkW+qF4Z\nkE+kxgECgYEA/sm7umcyFuZME+RWYL8Gsp8agH1OGEgsmIiMi1z6RTlTmdR8fN18\nItzXyW+363VZln/1b5wCaPdLIxgASxybLAaxnKAXfmL7QvyVAaMwxj7N0ogvMQoN\nx2VuSGZSam2+LFVIMWHq1C+3fvVnCDLm6oHvIMK/zvEsPBBtz+L6rlECgYEAx1Pr\nKogaGHCi1XgsrNv9aFaayRvmhzZbmiigF0iWKAd3KKww94BdyyGSVfMfyL23LAbM\nQDCrDNGpYAnpNZo/cL+OcGPYzlPsWDBrJub1HOA/H3WQlP4oEcfdbmJZhIkEwTGF\nHaCHynEu4ekiCrWz9+XVNCquTyqnmaVDEzAfEZsCgYA8jQbfUt0Vkh+sboyUq3FV\nC/jJZn4jyStICNOV3z/fKbOTkGsRZbW1t1RVHAbSn23uFXTn1GTCO1sQ+QhA0YiT\nGvgk5+sNb0qVbd+fpv/VbWGO0iyc8+24YIOoEyEtB+21LYNdsQ6U5M4wDvQwf6Bf\nRQfmekIJVUmU8LaYPDIlMQKBgDSRiT/aTSeM7STnYMDl89sEnCXV2eJnD5mEhVQe\nrJs5/M8ZOoDLtfDQlctdJ1DF1/0gfdWgADyNPuI5OuwMFhciLequKoufzoEjo97K\nonJPIdamJs9kiCTIVTm7bmhpyns5GCZMJAPb/cVOus+gRCpozuXHK9ltIm5/C0WQ\nN2FpAoGBAOss6RN2krieqbn1mG8e2v5mMUd0CJkiJu2y5MnF3dYHXSQ3/ePAh/Yg\nJOthpgYgBh+mV0DLqJhx/1DLS/xiqcoHDlndQDmYbtvvY7RlMo00+nGzkRVOfrqy\nhC+1KsYHGPbSQixNQXtvFbAAVMSo+RRBkVGINYGDFnlQUpkppYRk\n-----END RSA PRIVATE KEY-----\"\n</code></pre> <p>Warning</p> <p>The above private key is an example key from the <code>xml-encryption</code> library's test suite. Do not use this key.</p>","tags":["Server Pro"]},{"location":"configuration/saml2/#metadata-for-the-identity-provider","title":"Metadata for the identity provider","text":"<p>Your Identity Provider (IdP) will need to be configured to recognize your Server Pro instance as a Service Provider (SP). How this is done will vary between different IdP's - we therefore recommend that you consult the documentation for your SAML 2.0 server for instructions on how to do this.</p> <p>As of version <code>2.6.0</code>, Server Pro includes a metadata endpoint which can be used to retrieve Service Provider Metadata from, for example <code>http://my-overleaf-instance.com/saml/meta</code></p> <p>Here is an example of appropriate Service Provider (SP) metadata, note the <code>AssertionConsumerService.Location</code>, <code>EntityDescriptor.entityID</code> and <code>EntityDescriptor.ID</code> properties, and set as appropriate.</p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;EntityDescriptor xmlns=\"urn:oasis:names:tc:SAML:2.0:metadata\"\n                  xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"\n                  entityID=\"sharelatex-saml\"\n                  ID=\"OVERLEAF_saml\"&gt;\n  &lt;SPSSODescriptor protocolSupportEnumeration=\"urn:oasis:names:tc:SAML:2.0:protocol\"&gt;\n    &lt;NameIDFormat&gt;urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress&lt;/NameIDFormat&gt;\n    &lt;AssertionConsumerService index=\"1\"\n                              isDefault=\"true\"\n                              Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\"\n                              Location=\"https://sharelatex.example.com/saml/callback\" /&gt;\n  &lt;/SPSSODescriptor&gt;\n&lt;/EntityDescriptor&gt;\n</code></pre>","tags":["Server Pro"]},{"location":"configuration/saml2/#example-configuration","title":"Example configuration","text":"<p>At Overleaf, we test the SAML 2.0 integration against a SAML 2.0 test server. The following is an example of a working configuration:</p> <pre><code># added to variables.env\n\nEXTERNAL_AUTH=saml\nOVERLEAF_SAML_ENTRYPOINT=http://localhost:8081/simplesaml/saml2/idp/SSOService.php\nOVERLEAF_SAML_CALLBACK_URL=http://saml/saml/callback\nOVERLEAF_SAML_ISSUER=sharelatex-test-saml\nOVERLEAF_SAML_IDENTITY_SERVICE_NAME=SAML Test Server\nOVERLEAF_SAML_EMAIL_FIELD=email\nOVERLEAF_SAML_FIRST_NAME_FIELD=givenName\nOVERLEAF_SAML_LAST_NAME_FIELD=sn\nOVERLEAF_SAML_UPDATE_USER_DETAILS_ON_LOGIN=true\n</code></pre> <p>The <code>sharelatex/saml-test</code> image needs to run in the same network as the <code>sharelatex</code> container (which by default would be <code>overleaf_default</code>), so we'll proceed with the following steps:</p> <ul> <li>Run <code>docker network create overleaf_default</code> (will possibly fail due to a <code>network with name overleaf_default already exists</code> error, that's ok).</li> <li>Start <code>saml-test</code> container with some environment parameters:</li> </ul> <pre><code>docker run --network=overleaf_default --name=saml                 \\\n    --publish='8081:80'                                           \\\n    --env SAML_BASE_URL_PATH='http://localhost:8081/simplesaml/'  \\\n    --env SAML_TEST_SP_ENTITY_ID='sharelatex-test-saml'           \\\n    --env SAML_TEST_SP_LOCATION='http://localhost/saml/callback'  \\\n    sharelatex/saml-test \n</code></pre> <ul> <li>Edit <code>variables.env</code> to add the SAML 2.0 Environment Variables as listed above.</li> <li>Restart Server Pro.</li> </ul> <p>You should be able to login using <code>sally</code> as username and <code>sally123</code> as password.</p>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/","title":"Sandboxed Compiles","text":"<p>Server Pro comes with the option to run compiles in a secured sandbox environment for enterprise security. It does this by running every project in its own secured Docker environment. With Sandboxed Compiles you also benefit from easier package management. </p>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#improved-security","title":"Improved security","text":"<p>Sandbox Compiles are the recommended approach for Server Pro due to many LaTeX documents requiring/having the ability to execute arbitrary shell commands as part of the PDF compile process. If you use Sandboxed Compiles, each compile runs in a separate Docker container with limited capabilities that are not shared with any other user or project and has no access to outside resources such as the host network. </p> <p>If you attempt to run Server Pro without Sandboxed Compiles, the compile runs alongside other concurrent compiles inside the main Docker container.</p>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#easier-package-management","title":"Easier package management","text":"<p>To avoid manually installing packages, we recommend enabling Sandbox Compiles. This is a configurable setting within Server Pro that will provide your users with access to the same Tex Live environment as that on overleaf.com but within your own on-premise installation. TeX Live images used by Sandboxed Compiles contain the most popular packages and fonts tested against our gallery templates, ensuring maximum compatibility with on-premise projects. </p> <p>Enabling Sandboxed Compiles allows you to configure which TeX Live versions users are able to choose from within their project along with setting a default TeX Live image version for new projects. </p> <p>Note</p> <p>If you attempt to run Server Pro without Sandboxed Compiles, your instance will default to using a basic scheme version of TeX Live for compiles. This basic version is lightweight and only contains a very limited subset of LaTex packages, which will most likely result in missing package errors for your users, especially if they try to use pre-built templates. </p> <p>As Server Pro has been architected to work offline, there isn't an automated way to integrate overleaf.com gallery templates into your on-premise installation, it is, however, possible to do this manually on a per-template basis. For more information on how this works, pkeae check out our guide here: TODO:: ADD GUIDE.</p> <p>Information</p> <p>Sandbox Compiles requires that the Server Pro container has access to the Docker socket on the host machine (via a bind mount) so it can manage these compile containers.</p>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#how-it-works","title":"How it works","text":"<p>When Sandboxed Compiles are enabled, the Docker socket will be mounted from the host machine into the <code>sharelatex</code> container, so that the compiler service in the container can create new Docker containers on the host. Then for each run of the compiler in each project, the LaTeX compiler service (CLSI) will do the following:</p> <ul> <li>Write out the project files to a location inside the <code>OVERLEAF_DATA_PATH</code>, </li> <li>Use the mounted Docker socket to create a new <code>texlive</code> container for the compile run</li> <li>Have the <code>texlive</code> container read the project data from the location under <code>OVERLEAF_DATA_PATH</code></li> <li>Compile the project inside the <code>texlive</code> container</li> </ul>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#enabling-sandboxed-compiles","title":"Enabling Sandboxed Compiles","text":"","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#toolkit","title":"Toolkit","text":"<p>In <code>config/overleaf.rc</code>, set <code>SIBLING_CONTAINERS_ENABLED=true</code>, and ensure that the <code>DOCKER_SOCKET_PATH</code> setting is set to the location of the Docker socket on the host machine.</p> <p>The next time you start the Docker services (with <code>bin/up</code>), the <code>sharelatex</code> container will verify that it can communicate with Docker on the host machine, and will pull all configured <code>texlive</code> images it requires to create the Sandboxed Compile containers. This process can take several minutes, and compiles will be un-available during this time.</p> <p>TODO: Add steps to pull images first to minimize downtime</p>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#docker-compose","title":"Docker Compose","text":"<p>In this example, note the following:</p> <ul> <li>the Docker socket volume mounted into the <code>sharelatex</code> container</li> <li><code>DOCKER_RUNNER</code> set to \"true\"</li> <li><code>SANDBOXED_COMPILES</code> set to \"true\"</li> <li><code>SANDBOXED_COMPILES_SIBLING_CONTAINERS</code> set to \"true\"</li> <li><code>SANDBOXED_COMPILES_HOST_DIR</code> set to \"/data/overleaf_data/data/compiles\", the place on the host where the compile data will be written</li> </ul> <p>Important</p> <p>Starting with Overleaf Server CE/Server Pro <code>5.0.3</code> environment variables have been rebranded from <code>SHARELATEX_*</code> to <code>OVERLEAF_*</code>.</p> <p>If you're using a <code>4.x</code> version (or earlier) please make sure the variables are prefix accordingly (e.g. <code>SHARELATEX_MONGO_URL</code> instead of <code>OVERLEAF_MONGO_URL</code>)</p> <pre><code>version: '2'\nservices:\n    sharelatex:\n        restart: always\n        image: quay.io/sharelatex/sharelatex-pro:5.0.3\n        container_name: sharelatex\n        depends_on:\n            - mongo\n            - redis\n        ports:\n            - 80:80\n        links:\n            - mongo\n            - redis\n        volumes:\n            - /data/overleaf_data:/var/lib/overleaf # (/var/lib/sharelatex for versions 4.x and earlier)\n            - /var/run/docker.sock:/var/run/docker.sock    #### IMPORTANT\n        environment:\n            OVERLEAF_MONGO_URL: mongodb://mongo/sharelatex\n            OVERLEAF_REDIS_HOST: redis\n            OVERLEAF_APP_NAME: 'My Overleaf'\n            OVERLEAF_SITE_URL: \"http://overleaf.mydomain.com\"\n            OVERLEAF_NAV_TITLE: \"Our Overleaf Instance\"\n            OVERLEAF_ADMIN_EMAIL: \"support@example.com\"\n            ...\n            DOCKER_RUNNER: \"true\"\n            SANDBOXED_COMPILES: \"true\"\n            SANDBOXED_COMPILES_SIBLING_CONTAINERS: \"true\"    #### IMPORTANT\n            # Note: (/var/lib/sharelatex for versions 4.x and earlier)\n            SANDBOXED_COMPILES_HOST_DIR: \"/data/overleaf_data/data/compiles\"  #### IMPORTANT \n</code></pre>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#changing-the-tex-live-image","title":"Changing the Tex Live Image","text":"<p>Server Pro uses three environment variables to determine which Tex Live images to use for Sandboxed Compiles: </p> <ul> <li><code>TEX_LIVE_DOCKER_IMAGE</code>: name of the default image for new projects</li> <li><code>ALL_TEX_LIVE_DOCKER_IMAGES</code>: comma-separated list of all images in use</li> <li><code>ALL_TEX_LIVE_DOCKER_IMAGE_NAMES</code>: Optional: comma-separated list of user-facing friendly names for the images. If omitted, the version number will be used, for example, <code>texlive-full:2018.1</code></li> </ul> <p>When the Server Pro instance starts up, it will pull all of the images listed in <code>ALL_TEX_LIVE_DOCKER_IMAGES</code>. </p> <p>The current default is <code>quay.io/sharelatex/texlive-full:2017.1</code>, but you can override these values in the <code>config/variables.env</code> if you are using the Toolkit or  the <code>environment</code> section of the `docker-compose.yml' file if you are using Docker Compose.</p> <p>Here's an example where we default to TeX Live 2023 for new projects, and keep both 2023 and 2022 in use for older projects:</p> <pre><code>    TEX_LIVE_DOCKER_IMAGE: \"quay.io/sharelatex/texlive-full:2023.1\"\n    ALL_TEX_LIVE_DOCKER_IMAGES: \"quay.io/sharelatex/texlive-full:2023.1,quay.io/sharelatex/texlive-full:2022.1\"\n    ALL_TEX_LIVE_DOCKER_IMAGE_NAMES: \"TeX Live 2023.1,TeX Live 2022.1\"\n</code></pre> <p>Note</p> <p>Before updating to a newer version of Tex Live we strongly recommend performing a consistent back of your data and updating to the latest version of Server Pro available.</p>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#available-tex-live-images","title":"Available Tex Live images","text":"<p>These are all the Tex Live images that can be added to <code>TEX_LIVE_DOCKER_IMAGE</code> and <code>ALL_TEX_LIVE_DOCKER_IMAGES</code>:</p> <ul> <li><code>quay.io/sharelatex/texlive-full:2023.1</code></li> <li><code>quay.io/sharelatex/texlive-full:2022.1</code></li> <li><code>quay.io/sharelatex/texlive-full:2021.1</code></li> <li><code>quay.io/sharelatex/texlive-full:2020.1</code> (legacy)</li> <li><code>quay.io/sharelatex/texlive-full:2019.1</code> (legacy)</li> <li><code>quay.io/sharelatex/texlive-full:2018.1</code> (legacy) </li> <li><code>quay.io/sharelatex/texlive-full:2017.1</code> (legacy)</li> <li><code>quay.io/sharelatex/texlive-full:2016.1</code> (legacy)</li> <li><code>quay.io/sharelatex/texlive-full:2015.1</code> (legacy)</li> <li><code>quay.io/sharelatex/texlive-full:2014.2</code> (legacy)</li> </ul>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#extending-tex-live","title":"Extending Tex Live","text":"<p>It's possible to extend an existing Tex Live image using a new Dockerfile and configure the application to use the new image. </p> <p>Here we offer some guidelines to install new packages or fonts, but the configuration of a custom image is not covered by our support terms. </p> <p>The TeX Live images receive infrequent updates. We suggest rebuilding custom images when upgrading Server Pro.</p>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#installing-and-updating-new-packages","title":"Installing and updating new packages","text":"<p>You can use <code>tlmgr</code> commands such as <code>tlmgr install</code> and <code>tlmgr update</code> to manage Tex Live packages as in the following example:</p> <pre><code>FROM quay.io/sharelatex/texlive-full:2023.1\n\nRUN tlmgr update --force ebproof\n</code></pre>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#using-tlmgr-in-an-older-tex-live-image","title":"Using <code>tlmgr</code> in an older TeX Live image","text":"<p>By default <code>tlmgr</code> downloads resources from the latest TeX Live release. When patching an older TeX Live image, the downloads need to be switched to the respective archive. See the list in https://www.tug.org/historic/ for mirrors of archives.</p> <pre><code>FROM quay.io/sharelatex/texlive-full:2022.1\n\nRUN tlmgr option repository &lt;MIRROR&gt;/systems/texlive/&lt;YEAR&gt;/tlnet-final\n# e.g. RUN tlmgr option repository ftp://tug.org/historic/systems/texlive/2022/tlnet-final\n\nRUN tlmgr update --force ebproof\n</code></pre>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#installing-new-fonts","title":"Installing new fonts","text":"<p>There are different procedures to install new fonts in a Tex Live distribution, and installing a custom font might require several steps. Checking the instructions to install TeX fonts in the official Tex Live documentation is probably a good starting point.</p> <p>The following <code>Dockerfile</code> shows an example of installing a TrueType font over an existing Tex Live 2022 image:</p> <pre><code>FROM quay.io/sharelatex/texlive-full:2022.1\n\nCOPY ./myfonts/*.ttf /usr/share/fonts/truetype/myfont/\n\n# rebuild font information cache\nRUN fc-cache\n</code></pre>","tags":["Server Pro"]},{"location":"configuration/sandboxed-compiles/#configuring-server-pro-to-use-the-new-images","title":"Configuring Server Pro to use the new images","text":"<p>Use the name <code>quay.io/sharelatex/texlive-full</code> and a custom tag to build the new image, as in:</p> <pre><code>docker build -t quay.io/sharelatex/texlive-full:2023.1-custom\n</code></pre> <p>We can now configure Server Pro to use the new <code>2023.1-custom</code> image updating the <code>TEX_LIVE_DOCKER_IMAGE</code> and <code>ALL_TEX_LIVE_DOCKER_IMAGES</code> environment variables:</p> <pre><code>TEX_LIVE_DOCKER_IMAGE: \"quay.io/sharelatex/texlive-full:2023.1-custom\"\nALL_TEX_LIVE_DOCKER_IMAGES: \"quay.io/sharelatex/texlive-full:2023.1,quay.io/sharelatex/texlive-full:2023.1-custom\"\n</code></pre> <p>In the example above new projects are set by default to use the new <code>2023.1-custom</code> image, while <code>2023.1</code> is still available for when it's needed.</p>","tags":["Server Pro"]},{"location":"configuration/templates-system/","title":"Templates system","text":"<p>With Server Pro, you have the ability to create and publish your own templates, within your self-hosted environment, as well as re-distribute downloaded templates from the Template Gallery on overleaf.com. </p>","tags":["Server Pro"]},{"location":"configuration/templates-system/#setting-up-the-templates-user","title":"Setting up the templates user","text":"<p>In Server Pro, a single user is responsible for publishing the curated list of templates that are visible on your local template gallery <code>/templates</code>. </p> <p>To do this, you'll need to set the environment variable <code>OVERLEAF_TEMPLATES_USER_ID</code> in <code>toolkit/config/variables.env</code> to the <code>ID</code> of the user who will be responsible for template management within your instance, for example:</p> <pre><code>OVERLEAF_TEMPLATES_USER_ID=56a8865231faeb5f07d69959\n</code></pre> <p>To obtain the <code>ID</code> of the user you wish to publish public templates:</p> <ol> <li>Log in using an Administrator account and go to <code>Admin</code> &gt; <code>Manage Users</code>. </li> <li>Search for the user using their email address and click through to their user admin page. There you will find the <code>ID</code>: </li> <li>Copy that <code>ID</code> and use it to set the environment variable <code>OVERLEAF_TEMPLATES_USER_ID</code>.</li> <li>Run <code>bin/up -d</code> to recreate the <code>sharelatex</code> container and apply the change.</li> </ol> <p>Warning</p> <p>Altering the configuration files of your Server Pro typically necessitates the recreation of one or more containers. This procedure will cause user disconnections and lead to a period of downtime. As such, we advise implementing these modifications during prearranged maintenance periods.</p>","tags":["Server Pro"]},{"location":"configuration/templates-system/#publishing-templates","title":"Publishing templates","text":"<p>If you'd like to make templates available to all of your on-premise Server Pro users you'll need to:</p> <ol> <li>Log in as the templates user.</li> <li>As the templates user, create or upload a project containing the template's source code and make sure it compiles.</li> <li>In the editor's left-hand menu, choose Manage Template. </li> <li>Enter a custom description of the template</li> <li>Click the Publish button</li> </ol> <p>Tip</p> <p>Did you know that you can transfer quality, pre-built LaTeX templates that are available on the Template Gallery at overleaf.com to your on-premise instance of Server Pro? For more information see the Transferring templates section below.</p>","tags":["Server Pro"]},{"location":"configuration/templates-system/#unpublishing-templates","title":"Unpublishing templates","text":"<p>If you'd like to unpublish a template you'll need to:</p> <ol> <li>Log in as the templates user.</li> <li>Open the previously existing project containing the template's source code.</li> <li>In the editor's left-hand menu, choose Manage Template.</li> <li>Once the confirmation popup is displayed, click Unpublish.</li> </ol> <p>Once this has been done, the template should have been removed from the templates list.</p>","tags":["Server Pro"]},{"location":"configuration/templates-system/#linking-to-your-templates","title":"Linking to your templates","text":"","tags":["Server Pro"]},{"location":"configuration/templates-system/#your-gallery","title":"Your gallery","text":"<p>On the templates gallery page, <code>/templates</code>, templates are grouped together using the tag which the user assigns to the projects, e.g. Journals, Reports etc. To see all templates add <code>/all</code> to the URL <code>/templates/all</code>, which can also be used as the default URL if you do not wish to use tags for groupings.</p> <p>Like-wise, you can view/link to templates within a specific category by appending the tag name to the templates URL, for example: <code>/templates/journals</code>.</p> <p>Tip</p> <p>Did you know that if you tag a project multiple times it will appear in multiple groups.</p>","tags":["Server Pro"]},{"location":"configuration/templates-system/#new-project-menu","title":"New project menu","text":"<p>When a user creates a new project, they can be shown customized links to template categories. These links are set via the  <code>OVERLEAF_NEW_PROJECT_TEMPLATE_LINKS</code> environment variable in <code>toolkit/config/variables.env</code>, for example:</p> <pre><code>OVERLEAF_NEW_PROJECT_TEMPLATE_LINKS='[\n   {\"name\":\"All Templates\",\"url\":\"/templates/all\"},\n   {\"name\":\"All Categories\",\"url\":\"/templates\"},\n   {\"name\":\"Reports\",\"url\":\"/templates/reports\"},  \n   {\"name\":\"External\",\"url\":\"https://somewhere.com/templates/reports\"}\n]'\n</code></pre> <p></p>","tags":["Server Pro"]},{"location":"configuration/templates-system/#transferring-templates-from-overleafcom","title":"Transferring templates from overleaf.com","text":"<p>As Server Pro has been architected to work offline, there isn't an automated way to integrate overleaf.com gallery templates into your on-premise installation, it is however possible to do this manually on a per template basis.</p> <p>By default, Server Pro is configured to use a basic scheme version of TeXLive for compiles. This basic version is lightweight and only contains a very limited subset of LaTeX packages which, will most likely result in missing package errors for your users when attempting to use templates from overleaf.com on your local on-premise instance.</p> <p>Unfortunately, whilst there isn't an automatic way to install missing packages, we do have a configurable setting within Server Pro that will allow your users to compile projects with access to more packages, and in a more secure way. This feature is called Sandbox Compiles (also known as Sibling Containers).</p> <p>To ensure that downloaded templates are compatible with your on-premise Server Pro instance, we highly recommend that you enable Sandbox Compiles as this feature will provide your users with access to the same TexLive environment as that on overleaf.com. These images contain the most popular packages and fonts and have already been tested against our gallery templates. </p> <p>You can find additional information about configuring what TeXLive versions users are able to choose from within their project along with setting the default TeXLive image version for new projects in the Changing the TeXLive Image section of this documentation. </p> <p>Note</p> <p>Once you've switched to using Sandbox Compiles it'll take a little while for the new images to be downloaded by the container (this only happens once per image), during this time compiles will be unavailable.</p> <p>If you'd like to re-distribute a template from the Template Gallery on overleaf.com, or if one of your users would like to use one for their own project, the steps are as follows:</p> <ol> <li>Navigate to the Template Gallery on overleaf.com and locate the required template, for example IEEE Photonics Journal Paper Template - Example Submission</li> <li>Click on the Open as Template button</li> <li>Click on the project menu and choose Download Source</li> <li>Next, log into the on-premise Server Pro account</li> <li>Click the New Project button from the projects dashboard and choose Upload Project</li> <li>Click the Select a .zip file button and choose the downloaded template zip file</li> </ol> <p>The user can then use this newly uploaded template within their own account, or, as the templates user, you can publish it for other users to use.</p> <p>Note</p> <p>An overleaf.com account is required</p>","tags":["Server Pro"]},{"location":"configuration/tls-proxy/","title":"TLS Proxy","text":"<p>An optional TLS proxy for terminating HTTPS connections, based on NGINX.</p> <p>Run <code>bin/init --tls</code> to initialise local configuration with NGINX proxy configuration, or to add NGINX proxy configuration to an existing local configuration. A sample private key is created in <code>config/nginx/certs/overleaf_key.pem</code> and a dummy certificate in <code>config/nginx/certs/overleaf_certificate.pem</code>. Either replace these with your actual private key and certificate, or set the values of the <code>TLS_PRIVATE_KEY_PATH</code> and <code>TLS_CERTIFICATE_PATH</code> variables to the paths of your actual private key and certificate respectively.</p> <p>A default config for NGINX is provided in <code>config/nginx/nginx.conf</code> which may be customised to your requirements. The path to the config file can be changed with the <code>NGINX_CONFIG_PATH</code> variable.</p> <p>In order for Overleaf to run correctly behind the proxy, the following variables should be uncommented in <code>config/variables.env</code> <pre><code>OVERLEAF_BEHIND_PROXY=true\nOVERLEAF_SECURE_COOKIE=true\n</code></pre> Add the following section to your <code>config/overleaf.rc</code> file if it is not there already: <pre><code># TLS proxy configuration (optional)\nNGINX_ENABLED=false\nNGINX_CONFIG_PATH=config/nginx/nginx.conf\nNGINX_HTTP_PORT=80\n# Replace these IP addresses with the external IP address of your host\nNGINX_HTTP_LISTEN_IP=127.0.1.1 \nNGINX_TLS_LISTEN_IP=127.0.1.1\nTLS_PRIVATE_KEY_PATH=config/nginx/certs/overleaf_key.pem\nTLS_CERTIFICATE_PATH=config/nginx/certs/overleaf_certificate.pem\nTLS_PORT=443\n</code></pre> In order to run the proxy, change the value of the <code>NGINX_ENABLED</code> variable in <code>config/overleaf.rc</code> from <code>false</code> to <code>true</code> and re-run <code>bin/up</code>.</p> <p>By default the HTTPS web interface will be available on <code>https://127.0.1.1:443</code>. Connections to <code>http://127.0.1.1:80</code> will be redirected to <code>https://127.0.1.1:443</code>. To change the IP address that NGINX listens on, set the <code>NGINX_HTTP_LISTEN_IP</code> and <code>NGINX_TLS_LISTEN_IP</code> variables. The ports can be changed via the <code>NGINX_HTTP_PORT</code> and <code>TLS_PORT</code> variables.</p> <p>If NGINX fails to start with the error message <code>Error starting userland proxy: listen tcp4 ... bind: address already in use</code> ensure that <code>OVERLEAF_LISTEN_IP:OVERLEAF_PORT</code> does not overlap with <code>NGINX_HTTP_LISTEN_IP:NGINX_HTTP_PORT</code>.</p> <pre><code>sequenceDiagram\n    participant user as User\n    participant external as Host External\n    participant internal as Host Internal\n    participant nginx as nginx\n    participant sharelatex as sharelatex\n    participant git-bridge as git-bridge\n    %% User connects to external host HTTP\n    user-&gt;&gt;+ external: HTTP\n    note over external: NGINX_HTTP_LISTEN_IP:NGINX_HTTP_PORT\n    external-&gt;&gt;+ nginx: HTTP\n    note over nginx: nginx:80\n    nginx--&gt;&gt;-external: 301\n    %% User connects to external host HTTPS\n    user-&gt;&gt;+ external: HTTPS \n    note over external: NGINX_TLS_LISTEN_IP:TLS_PORT\n    external-&gt;&gt;+ nginx: HTTPS\n    note over nginx: nginx:443\n    nginx-&gt;&gt;+ sharelatex: HTTP\n    note over sharelatex: sharlatex:80\n    %% User connects to localhost HTTP\n    user-&gt;&gt;+ internal: HTTP\n    note over internal: OVERLEAF_LISTEN_IP:OVERLEAF_PORT\n    internal-&gt;&gt;+sharelatex: HTTP\n    note over sharelatex: sharlatex:80\n    %% sharelatex connects to git-bridge\n    sharelatex-&gt;&gt;+git-bridge: HTTP /git/\n    note over git-bridge: git-bridge:8000\n    note over sharelatex: GIT_BRIDGE_HOST:GIT_BRIDGE_PORT\n    git-bridge-&gt;&gt;+sharelatex: WEB/WEB-API:3000\n    git-bridge-&gt;&gt;+sharelatex: HISTORY-V1:3100</code></pre>"},{"location":"configuration/toolkit-settings/","title":"Toolkit settings","text":"<p>This document describes the variables that are supported in the <code>config/overleaf.rc</code> file for Toolkit deployments.</p> <p>The <code>config/overleaf.rc</code> file consists of variable definitions in the form <code>NAME=value</code> , lines beginning with <code>#</code> are treated as comments.</p> <p>Note</p> <p>We recommend that you re-create the Docker containers after changing anything in <code>overleaf.rc</code> or <code>variables.env</code> by running <code>bin/up</code>.</p>"},{"location":"configuration/toolkit-settings/#container","title":"Container","text":""},{"location":"configuration/toolkit-settings/#sharelatex","title":"<code>sharelatex</code>","text":"Name Description <code>PROJECT_NAME</code> Sets the value of the <code>--project-name</code> flag supplied to <code>docker-compose</code>. This is useful when running multiple instances of Overleaf on one host, as each instance can have a different project name.- Default: <code>overleaf</code> <code>SERVER_PRO</code> When set to <code>true</code>, tells the Toolkit to use the Server Pro image (<code>quay.io/sharelatex/sharelatex-pro</code>), rather than the default Server CE image (<code>sharelatex/sharelatex</code>).- Default: <code>false</code> <code>SIBLING_CONTAINERS_ENABLED</code> When set to <code>true</code>, tells the Toolkit to use the Sibling Containers technique for compiling projects in separate sandboxes, using a separate Docker container for each project. See the Sandboxed Compiles documentation for more information.- Requires: <code>SERVER_PRO=true</code>- Default: <code>false</code> <code>DOCKER_SOCKET_PATH</code> Sets the path to the Docker socket on the host machine (the machine running the Toolkit). When <code>SIBLING_CONTAINERS_ENABLED</code> is <code>true</code>, the socket will be mounted into the container, to allow the compiler service to spawn new Docker containers on the host. - Requires: <code>SIBLING_CONTAINERS_ENABLED=true</code>- Default: <code>/var/run/docker.sock</code> <code>OVERLEAF_DATA_PATH</code> Sets the path to the directory that will be mounted into the main <code>sharelatex</code> container, and used to store compile data. This can be either a full path (beginning with a <code>/</code>), or relative to the base directory of the Toolkit.- Default: <code>data/sharelatex</code> <code>OVERLEAF_LISTEN_IP</code> Sets the host IP address(es) that the container will bind to. For example, if this is set to <code>0.0.0.0</code>, then the web interface will be available on any host IP address. For direct container access the value of <code>OVERLEAF_LISTEN_IP</code> must be set to your public IP address. Setting <code>OVERLEAF_LISTEN_IP</code> to either <code>0.0.0.0</code> or the external IP of your host will typically cause errors when used in conjunction with the TLS Proxy.- Default: <code>127.0.0.1</code> <code>OVERLEAF_PORT</code> Sets the host port that the container will bind to. For example, if this is set to <code>8099</code> and <code>OVERLEAF_LISTEN_IP</code> is set to <code>127.0.0.1</code>, then the web interface will be available on <code>http://localhost:8099</code>.- Default: <code>80</code>"},{"location":"configuration/toolkit-settings/#mongo","title":"<code>mongo</code>","text":"Name Description <code>MONGO_ENABLED</code> When set to <code>true</code>, tells the Toolkit to create a MongoDB container to host the database. When set to <code>false</code>, this container will not be created, and the system will use the MongoDB database specified by <code>MONGO_URL</code> instead.- Default: <code>true</code> <code>MONGO_URL</code> Specifies the MongoDB connection URL to use when <code>MONGO_ENABLED</code> is <code>false</code>- Default: not set <code>MONGO_DATA_PATH</code> Sets the path to the directory that will be mounted into the <code>mongo</code> container, and used to store the MongoDB database. This can be either a full path (beginning with a <code>/</code>), or relative to the base directory of the toolkit. This option only affects the local <code>mongo</code> container that is created when <code>MONGO_ENABLED</code> is <code>true</code>.- Default: <code>data/mongo</code>"},{"location":"configuration/toolkit-settings/#redis","title":"<code>redis</code>","text":"Name Description <code>REDIS_ENABLED</code> When set to <code>true</code>, tells the Toolkit to create a Redis container, to host the redis database. When set to <code>false</code>, this container will not be created, and the system will use the Redis database specified by <code>REDIS_HOST</code> and <code>REDIS_PORT</code> instead.- Default: <code>true</code> <code>REDIS_HOST</code> Specifies the Redis host to use when <code>REDIS_ENABLED</code> is <code>false</code>- Default: not set <code>REDIS_PORT</code> Specifies the Redis port to use when <code>REDIS_ENABLED</code> is <code>false</code>- Default: not set <code>REDIS_DATA_PATH</code> Sets the path to the directory that will be mounted into the <code>redis</code> container, and used to store the Redis database. This can be either a full path beginning with a <code>/</code>), or relative to the base directory of the Toolkit. This option only affects the local <code>redis</code> container that is created when <code>REDIS_ENABLED</code> is <code>true</code>.- Default: <code>data/redis</code>"},{"location":"configuration/toolkit-settings/#nginx","title":"<code>nginx</code>","text":"Name Description <code>NGINX_ENABLED</code> When set to <code>true</code>, tells the Toolkit to create an NGINX container, to act as a TLS Proxy.- Default: <code>false</code> <code>NGINX_CONFIG_PATH</code> Path to the NGINX config file to use for the TLS Proxy.- Default: <code>config/nginx/nginx.conf</code> <code>NGINX_TLS_LISTEN_IP</code> Sets the host IP address(es) that the TLS Proxy container will bind to for HTTPS. For example, if this is set to <code>0.0.0.0</code> then the HTTPS web interface will be available on any host IP address. Typically this should be set to the external IP of your host.- Default: <code>127.0.1.1</code> <code>NGINX_HTTP_LISTEN_IP</code> Sets the host IP address(es) that the TLS Proxy container will bind to for http redirect. For example, if this is set to <code>127.0.1.1</code> then HTTP connections to <code>127.0.1.1</code> will be redirected to the HTTPS web interface. Typically this should be set to the external IP of your host. Do not set it to <code>0.0.0.0</code> as this will typically cause a conflict with <code>OVERLEAF_LISTEN_IP</code>. - Default: <code>127.0.1.1</code> <code>NGINX_HTTP_PORT</code> Sets the host port that the TLS Proxy container will bind to for HTTP.- Default: <code>80</code> <code>TLS_PORT</code> Sets the host port that the TLS Proxy container will bind to for HTTPS.- Default: <code>443</code> <code>TLS_PRIVATE_KEY_PATH</code> Path to the private key to use for the TLS Proxy.- Default: <code>config/nginx/certs/overleaf_key.pem</code> <code>TLS_CERTIFICATE_PATH</code> Path to the public certificate to use for the TLS Proxy.- Default: <code>config/nginx/certs/overleaf_certificate.pem</code>"},{"location":"getting-started/","title":"Overview","text":"<p>Before proceeding with the installation of Overleaf, we highly recommend thoroughly reading this documentation. Familiarizing yourself with the requirements, installation process, configuration options and upgrade sections will ensure a smoother rollout experience. It's also crucial to have a solid understanding of your organization's requirements for utilizing Overleaf and the necessary underlying infrastructure needed for its successful operation.</p>"},{"location":"getting-started/#what-can-i-do-to-prepare","title":"What can I do to prepare?","text":"<p>Understand the requirements for running Overleaf. This involves evaluating your organization's existing server environment, network capabilities and storage resources. Ensure that your infrastructure meets or exceeds the specified requirements outlined in this documentation.</p> <p>Before initiating the installation process, ensure you have administrative access to the server where you intend to deploy Overleaf. This may involve coordinating with your IT team or system administrators to obtain the necessary permissions and resources. Additionally, review any security considerations or network policies that might impact the installation.</p>"},{"location":"getting-started/#how-do-i-install-overleaf","title":"How do I install Overleaf?","text":"<p>This documentation will guide you through downloading the necessary files, configuring some basic settings, and get you familiarized with the Overleaf Toolkit so you are able to deploy your chosen version of Overleaf. Be sure to follow each step carefully and remember to check the troubleshooting section of this documentation should you run into any problems.</p>"},{"location":"getting-started/#what-about-making-configuration-changes","title":"What about making configuration changes?","text":"<p>Once Overleaf is installed, you'll have the opportunity to configure various settings and options according to your organization's needs. Refer to the documentation to learn about customization options, user management, authentication methods, and various other features that can be tailored to your requirements.</p>"},{"location":"getting-started/#what-about-administering-my-overleaf-instance","title":"What about administering my Overleaf instance?","text":"<p>In this part of the documentation we'll cover the most common administration tasks, from transferring ownership of projects and registering users to reporting on usage.</p>"},{"location":"getting-started/#how-can-i-stay-up-to-date-with-developments","title":"How can I stay up-to-date with developments?","text":"<p>Overleaf requires regular maintenance to ensure optimal performance and security. Stay informed about updates, patches, and new releases by signing up to our mailing list.</p>"},{"location":"getting-started/#how-do-i-upgrade","title":"How do I upgrade?","text":"<p>The documentation will provide you with guidance on maintaining your Overleaf Server instance and address common maintenance tasks such as performing upgrades and backups.</p>"},{"location":"getting-started/#what-if-i-have-a-problem","title":"What if I have a problem?","text":"<p>If you encounter any problems, we recommend first consulting the troubleshooting section of the documentation as it contains common issues and required information needed by the support team if you need to reach out for assistance.</p> <p>By following these steps and thoroughly reading the documentation, you'll be well-prepared to install, configure, and maintain Overleaf according to your organization's requirements. Remember that a solid understanding of your infrastructure and the installation process is key to a successful deployment.</p> <p>Note</p> <p>Please note that we are not able to provide support for local installations of the free Server CE.</p>"},{"location":"getting-started/hardware-requirements/","title":"Hardware requirements","text":"<p>When provisioning hardware to run Overleaf, the main factor to consider is how many concurrent users will be running compiles.</p> <p>For example, if you have a license for 100 total users, but only expect ~5 to be working at the same time, the minimal install will be sufficient. If you expect a higher proportion to be working (and compiling) simultaneously, you should consider provisioning a server with a higher specification.</p>"},{"location":"getting-started/hardware-requirements/#minimal-install","title":"Minimal install","text":"<p>A minimum base requirement of 2 cores and 3GB memory is required for basic operations with around 5 concurrent users. This minimum requirement will also be sufficient for larger groups where there is less concurrent usage, or where it is ok for compile times to be longer during heavier usage.</p> <p>Warning</p> <p>If you are considering using a NFS (Network File System) based filesystem for your small instance please have a look at this section in the Troubleshooting guide.</p>"},{"location":"getting-started/hardware-requirements/#scaling","title":"Scaling","text":"<p>As a rule of thumb, to provide a high and consistent level of service, 1 CPU core and 1GB of memory should be added to the minimal install for every 5-10 concurrent users.</p> <p>This should only be taken as a guide, as factors such as the size of typical documents (larger documents use up more compile resources), how often users compile, and what tolerance there is for longer compile times during heavy usage, all affect the level of provisioning required.</p> <p>Example</p> <p>If you are running an Server Pro installation for 300 total users, and regularly expect 30-60 of those users to be compiling documents at the same time, 8GB and 7 Cores (5 cores + 5GB + base of 2 cores &amp; 3GB) should provide sufficient resources for your users to have a consistently high level of service.</p>"},{"location":"getting-started/hardware-requirements/#large-deployments","title":"Large deployments","text":"<p>Many of our customers look to deploy Server Pro organization wide, or across large teams. In those situations, it is difficult for us to advise on specific setup requirements, because the use cases and underlying hardware available can be quite varied.</p> <p>Example</p> <p>To give an example of the hardware requirements for a larger deployment, a Server Pro installation for 1,000 total users has been set up successfully using a single server provisioned with two 4-core processors and 32GB of system memory. This has been sufficient for the team\u2019s needs over the past year of usage.</p> <p>We need your help</p> <p>If you have installed Overleaf at your organization and would like to share details of your set up to help us add to this section, please let us know.</p> <p>Customers who are exceeding the limits of a single large server can take a look at Horizontal Scaling for Server Pro.</p>"},{"location":"getting-started/hardware-requirements/#storage","title":"Storage","text":"<p>We advise against using Network File System (NFS)/Amazon EFS/Amazon EBS for project/history storage in larger setups and explicitly do not support it for horizontal scaling. </p> <p>The behavior of these file systems is not providing the necessary performance and reliability that Server Pro needs when running at a high scale. When the file system cannot keep up with the load, the application stalls from too many blocking IO operations. These stalls can lead to overrun redis-based locks, which in turn can result in corrupted project data. We advise on using S3 compatible object storage instead. Slow S3 performance in turn only affects the upload/download of files, which only leads to an elevated number of open connections to your S3 provider and in turn does not affect the behavior of the rest of the application.  Additionally Server Pro can specify reasonable timeouts on S3 requests, which is not possible for file system/IO operations at the application level.</p> <p>Info</p> <p>For reference, GitLab is following a similar stance of not supporting NFS/Amazon EFS with their self-managed offering.</p>"},{"location":"getting-started/hardware-requirements/#nginx-specific-configuration-for-large-deployments","title":"Nginx specific configuration for large deployments","text":"<p>By default, Overleaf Server instance limit the number of connections to 768. This includes persistent Websocket connections, top-level HTML navigation and ajax requests. Once the limit is hit, the editor might not be able to connect, the editor page might not load entirely and compile requests can fail. Nginx will return status 500 responses and log <code>worker_connections are not enough while connecting to upstream</code> into <code>var/log/nginx/error</code>.log inside the <code>sharelatex</code> container.</p> <p>The <code>worker_connections</code> setting limits the number of concurrent connections nginx will accept per worker. The number of workers is controlled by the <code>worker_processes</code> setting and is set to 4 by default in our nginx configuration.</p> <p>Nginx doesn't do much work compared to other parts of the system, so these limits act as a safety preventing too many connections from overwhelming the system. It's preferable to drop some excess connections early rather than slowing down every connection.</p> <p>Overleaf Server instances expose environment variables for adjusting these nginx settings:</p> <ul> <li><code>NGINX_WORKER_PROCESSES</code> for <code>worker_processes</code> (default <code>4</code>)</li> <li><code>NGINX_WORKER_CONNECTIONS</code> for <code>worker_connections</code> (default <code>768</code>)</li> <li><code>NGINX_KEEPALIVE_TIMEOUT</code> for <code>keepalive_timeout</code> (default <code>65</code>)</li> </ul> <p>Note</p> <p>When running another proxy in front of the <code>sharelatex</code> container (e.g. for TLS termination), the <code>NGINX_KEEPALIVE_TIMEOUT</code> in the Overleaf Server instance needs to be larger than the previous proxy. E.g. with another nginx process on the Docker host nginx-host, here are two examples: </p> <ul> <li>Default value <code>NGINX_KEEPALIVE_TIMEOUT</code>, use <code>keepalive_timeout 60s</code> (default value in upstream) in nginx-host</li> <li>Custom value <code>NGINX_KEEPALIVE_TIMEOUT=100s</code>, use <code>keepalive_timeout 90s</code> (custom value in upstream) in nginx-host</li> </ul>"},{"location":"getting-started/hardware-requirements/#cpu-speed","title":"CPU speed","text":"<p>LaTeX is a single threaded program, meaning it can only utilize one CPU core at a time. The CPU is also the main limitation when compiling a document. Therefore the faster the single core performance of your CPU the faster you will be able to compile a document. More cores will only help if you are trying to compile more documents than you have free CPU cores.</p>"},{"location":"getting-started/microservices/","title":"Overleaf microservices","text":"<p>The recommended way to deploy and manage Overleaf Server CE and Server Pro instances is via the use of the Overleaf Toolkit. </p> <p>The Overleaf Toolkit simplifies the creation of your Overleaf instance through the use of some custom scripts that abstract away the orchestration of required microservices. Simply run the bundled initialization script, provide a few configuration options like your persistent storage paths, and the Overleaf Toolkit will take care of provisioning and connecting the microservices that make up your Overleaf Server CE or Server Pro instance. </p> <p>This leaves you free to focus on customizing the user experience and implementing the specific features that make up your on-premise instance. The Overleaf Toolkit handles all the complexity behind the scenes, enabling a simplified deployment of your Overleaf instance.</p>"},{"location":"getting-started/microservices/#working-with-docker-compose-services","title":"Working with Docker Compose services","text":"<p>The Overleaf Toolkit runs your instance inside a Docker container, plus the supporting databases (MongoDB and Redis), each in their own containers. All of this is orchestrated with <code>docker compose</code>.</p> <p>Note</p> <p>For legacy reasons, the main Overleaf container is called <code>sharelatex</code>, and is based on the <code>sharelatex/sharelatex</code> Docker image. This is because the technology is based on the ShareLaTeX code base, which was merged into Overleaf. See this blog post for more details. At some point in the future, this will be renamed to match the Overleaf naming scheme.</p>"},{"location":"getting-started/microservices/#architecture","title":"Architecture","text":"<p>Inside the Overleaf container, the software runs as a set of microservices, managed by <code>runit</code>. Some of the more interesting files inside the container are:</p> <ul> <li><code>/etc/service/</code>: initialization files for the microservices.</li> <li><code>/var/log/sharelatex/</code>: logs for each microservice.</li> <li><code>/var/www/sharelatex/</code>: code for the various microservices.</li> <li><code>/var/lib/sharelatex/</code>: the mount-point for persistent data (corresponds to the directory indicated by <code>OVERLEAF_DATA_PATH</code> on the host).</li> </ul>"},{"location":"getting-started/microservices/#the-mongodb-and-redis-containers","title":"The MongoDB and Redis Containers","text":"<p>Overleaf depends on two external databases: MongoDB and Redis. By default, the Toolkit will provision a container for each of these databases, in addition to the Overleaf container, for a total of three Docker containers.</p> <p>Tip</p> <p>If you would prefer to connect to an existing MongoDB or Redis instance, you can do so by setting the appropriate settings in the overleaf.rc configuration file.</p>"},{"location":"getting-started/microservices/#editor-and-compile-process","title":"Editor and Compile Process","text":"<p>In this section we'll provide a broad overview for the handling of documents and the compile process.</p> <p>Note</p> <p>This document described the compile process with Sandboxed Compiles as available in Server Pro only. In Server CE, the compile process uses simple sub-processes -- replace the items referencing a container with a single item run compile in sub-process.</p> <p>Components/Actors:</p> Name Description <code>user</code> A user of the application <code>editor</code> The client application running in the browser <code>clsi</code> The micro service used for compiling PDFs <code>document-updater</code> The micro service used for processing document updates <code>filestore</code> The micro service handling binary files <code>real-time</code> The micro service used for handling web sockets <code>web</code> The (not so) micro service used for handling API requests"},{"location":"getting-started/microservices/#redis-caching","title":"Redis caching","text":"<ul> <li>user: loads editor page</li> <li>editor: opens web socket</li> <li>editor: sends request to open a document via web socket<ul> <li>real-time -&gt; document-updater: document is loaded from MongoDB into Redis</li> </ul> </li> <li>editor: sends document update via web socket<ul> <li>real-time -&gt; document-updater: document is updated in Redis</li> </ul> </li> <li>editor: sends more compile requests<ul> <li>After 5 minutes have passed since last flush (per doc):<ul> <li>document-updater: flush doc from Redis to MongoDB</li> </ul> </li> </ul> </li> <li>editor: sends more updates<ul> <li>every 100 updates (per doc):<ul> <li>document-updater: flush doc history from Redis to MongoDB</li> </ul> </li> </ul> </li> <li>user: leaves the editor/closes browser tab<ul> <li>5 minutes later<ul> <li>real-time: checks for other collaborators, if there are none:<ul> <li>real-time -&gt; document-updater: flushes docs from Redis to MongoDB</li> </ul> </li> </ul> </li> </ul> </li> </ul>"},{"location":"getting-started/microservices/#reading-from-mongodb-into-redis","title":"Reading from MongoDB into Redis","text":"<ul> <li>document-updater -&gt; web -&gt; docstore: read from MongoDB</li> </ul>"},{"location":"getting-started/microservices/#flushing-from-redis-into-mongodb","title":"Flushing from Redis into MongoDB","text":"<ul> <li>document-updater -&gt; web -&gt; docstore: write into MongoDB</li> </ul>"},{"location":"getting-started/microservices/#compile-full-sync-mode","title":"Compile - \"full\" sync-mode","text":"<ul> <li>editor: sends compile request with sync-mode set to \"full\" compile</li> <li>web -&gt; document-updater: any documents are flushed from redis into MongoDB</li> <li>web -&gt; docstore: all documents are downloaded from MongoDB</li> <li>web -&gt; clsi: compile request is sent to clsi, including:<ul> <li>the sync-mode </li> <li>a hash of the file tree -&gt; the \"project state\"</li> <li>all docs with their content -&gt; subject to 7MB request body limit</li> <li>binary file URLs for separate downloading</li> </ul> </li> <li>clsi: check on-disk state with sync-mode and \"project state\"<ul> <li>this is a full sync, so we can ignore what was previously written</li> </ul> </li> <li>clsi: cleanup compile dir</li> <li>clsi: write all docs into compile dir</li> <li>clsi: write all binary files into compile dir<ul> <li>clsi copies the files from a per project local cache</li> <li>on cache miss:<ul> <li>clsi-&gt;filestore: download files</li> </ul> </li> </ul> </li> <li>clsi: write the \"project state\"</li> <li>clsi: ensure docker container exists with desired config<ul> <li>build container options, includes texlive version</li> <li>hash options</li> <li>container name: <code>project-&lt;project-id&gt;-&lt;user-id&gt;-&lt;hash&gt;</code></li> </ul> </li> <li>clsi: start container and stream stdout/stderr into memory -&gt; limit 2MB</li> <li>clsi: leave stopped container behind -&gt; cleaned up after 24h</li> <li>clsi: write stdout/stderr to disk</li> <li>clsi: copy output files into unique output directory<ul> <li>build-id composed of 8 random bytes plus timestamp in ms precision</li> <li>delete all but last 3 (anonymous)/ 1 (logged in user) build folders</li> </ul> </li> <li>clsi: compile was failure/timeout<ul> <li>delete compile cache - it may have partial files/corrupted cache</li> </ul> </li> <li>editor: downloads output.log and output.pdf</li> </ul>"},{"location":"getting-started/microservices/#compile-incremental-sync-mode","title":"Compile - \"incremental\" sync-mode","text":"<ul> <li>editor: sends compile request with sync-mode set to \"incremental\" compile</li> <li>web -&gt; document-updater: get any documents from redis</li> <li>the \"project state\" hash is also stored in redis</li> <li>web sends the hash of the file tree to document-updater and document-updater      can turn the incremental compile into a full compile on mismatch<ul> <li>see compile process as performed when 'editor requested \"full\" compile'</li> </ul> </li> <li>web -&gt; clsi: compile request is sent to clsi, including:</li> <li>the sync-mode </li> <li>a hash of the file tree -&gt; the \"project state\"</li> <li>all docs from redis with their content -&gt; subject to 7MB request body limit</li> <li>no binary fines</li> <li>clsi: check on-disk state with sync-mode and \"project state\"</li> <li>this is an incremental sync, so the \"project state\" must match</li> <li>on mismatch: respond with 409, let web retry with \"full\" sync<ul> <li>see compile process as performed when 'editor requested \"full\" compile'</li> </ul> </li> <li>clsi: write updated docs into compile dir</li> <li>clsi: ensure docker container exists with desired config</li> <li>build container options, includes texlive version</li> <li>hash options</li> <li>container name: <code>project-&lt;project-id&gt;-&lt;user-id&gt;-&lt;hash&gt;</code></li> <li>clsi: start container and stream stdout/stderr into memory -&gt; limit 2MB</li> <li>clsi: leave stopped container behind -&gt; cleaned up after 24h</li> <li>clsi: write stdout/stderr to disk</li> <li>clsi: copy output files into unique output directory</li> <li>build-id composed of 8 random bytes plus timestamp in ms precision</li> <li>delete all but last 3 (anonymous)/ 1 (logged in user) build folders</li> <li>clsi: compile was failure/timeout</li> <li>delete compile cache - it may have partial files/corrupted cache</li> <li>editor: downloads output.log and output.pdf</li> </ul>"},{"location":"getting-started/microservices/#compile-switching-between-modes","title":"Compile - switching between modes","text":"<ul> <li>editor: observes a compile failure, next compile is a \"full\" compile</li> <li>editor: observes a compile success, next compile is an \"incremental\" compile</li> </ul>"},{"location":"getting-started/software-requirements/","title":"Software requirements","text":""},{"location":"getting-started/software-requirements/#operating-systems","title":"Operating systems","text":"<p>For the best experience when running Overleaf, we highly recommend using a  Debian-based operating system, such as  Ubuntu. This choice aligns with the software's development environment and is the preferred option among the majority of Overleaf users.</p> <p>Important</p> <p>When utilizing Server Pro with Sandbox Compiles, it's important to note that the application requires root access to the Docker socket. </p>"},{"location":"getting-started/software-requirements/#dependencies","title":"Dependencies","text":"<p>Both Server CE and Server Pro currently support the following versions of dependencies:</p> <ul> <li> Docker 23.0, 24.0, 25.0 and 26.0</li> <li> MongoDB 5.0</li> <li> Redis 6</li> </ul> <p>Tip</p> <p><code>docker-compose</code> is generally installed with Docker via the <code>docker-compose-plugin</code> package.</p> <p>MongoDB and Redis are automatically pulled by <code>docker compose</code> when running Server CE or Server Pro, unless configured to use a different installation.</p> <p>The Overleaf Toolkit depends on the following programs:</p> <ul> <li>bash</li> <li>Docker</li> </ul> <p><code>docker compose</code> is required and is generally installed with Docker.</p> <p>We recommend that you install the most recent version of Docker that is available for your operating system.</p> <p>Once Docker is installed correctly, you should be able to run these commands without error:</p> <pre><code># Shows the installed Docker version\ndocker --version\n\n# docker compose plugin (v2)\ndocker compose version\n# legacy docker-compose (v1)\ndocker-compose --version\n\n# List the running Docker containers on your system\ndocker ps\n\nCONTAINER ID   IMAGE                                     COMMAND                  CREATED        STATUS                        PORTS                NAMES\nb1fadcd1dcb1   quay.io/sharelatex/sharelatex-pro:5.1.0   \"/sbin/my_init\"          23 hours ago   Up About a minute             0.0.0.0:80-&gt;80/tcp   sharelatex\n7900ebb9ebb8   redis:6.2                                 \"docker-entrypoint.s\u2026\"   45 hours ago   Up About a minute             6379/tcp             redis\nfbd49d420e59   mongo:5.0                                 \"docker-entrypoint.s\u2026\"   45 hours ago   Up About a minute (healthy)   27017/tcp            mongo\n</code></pre> <p>Tip</p> <p>The Overleaf Toolkit includes a handy <code>bin/doctor</code> script that produces a report pointing to any unfulfilled dependency.</p>"},{"location":"getting-started/what-skills-do-i-need/","title":"What skills do I need?","text":"<p>We recommend that the on-site administrator of your Overleaf Server instance has:</p> <ul> <li>General IT administration skills</li> <li>Familiarity with Linux command line tools</li> <li>General networking knowledge and troubleshooting skills</li> <li>Experience backing up and restoring production systems</li> <li>Experience running applications using Docker is a bonus</li> <li>Experience with coordinating maintenance windows for upgrades of live production systems</li> </ul> <p>We find that on-site administrators with these skills will be able to provide the best experience for users of Overleaf at your organization.</p>"},{"location":"guides/common-problems/","title":"Common problems","text":"<p>Note</p> <p>These sections are for v5.x and later. If you are using an earlier version please use <code>sharelatex</code> instead of <code>overleaf</code> in path names.</p> <p>In this section, we aim to address frequently encountered issues that you may encounter while running your own on-premises version of Overleaf. </p>"},{"location":"guides/common-problems/#recovering-deleted-docs","title":"Recovering deleted docs","text":"<p>Docs are logically deleted and will be in the <code>deletedDocs</code> array in the <code>project</code> document.</p> <p>List the deleted docs in mongo:</p> <pre><code>db.projects.findOne({_id: ObjectId(\"&lt;project_id&gt;\")}, { deletedDocs: 1} )\n</code></pre> <p>Then open a shell in the <code>sharelatex</code> container. From there you can run the <code>restore_soft_deleted_docs</code> script.</p> <p>You will need: - your admin user ID - the project ID - the list of doc names from <code>deletedDocs</code></p> <p>Example restoring a deleted <code>restoreMe.tex</code> document:</p> <pre><code>node /var/www/sharelatex/web/scripts/restore_soft_deleted_docs.js &lt;admin_id&gt; &lt;project_id&gt; restoreMe.tex\n{ doc:\n   { _id: 5f91b367e86f6d0001680ecc,\n     name: '2020-10-22T16-29-27.066Z-restoreMe.tex' },\n  folderId: null }\n</code></pre> <p>This will have created a bunch of docs in the root of the project that look like TIMESTAMP-original-name. They should have the content and the tracked changes and comments from before deletion.</p>"},{"location":"guides/common-problems/#running-overleaf-with-an-nfs-filesystem","title":"Running Overleaf with an NFS filesystem","text":"<p>Mounting a NFS filesystem in an Overleaf container is technically possible, but it's not recommended and can result in different types of performance errors.</p> <p>One common error that compiles see is:</p> <p>EBUSY: resource busy or locked, unlink '/var/lib/overleaf/data/compiles/62f3d57bef7cf9005c364e75-62f3d57bef7cf9005c364e7a/.nfs573663533034825247625441'</p> <p>In particular we advise against using NFS backed filesystems for ephemeral data, like the directories use for compilation data. We recommend using a local scratch disk, preferably a local SSD for the following directories:</p> Path Description <code>/var/lib/overleaf/tmp</code> ephemeral data such as uploads and processing zip file data, <code>Settings.path.dumpFolder</code> and <code>Settings.path.uploadFolder</code> are sub-directories of this folder <code>/var/lib/overleaf/data/cache</code> cache for binary files of projects that are being compiled (<code>Settings.path.clsiCacheDir</code>) <code>/var/lib/overleaf/data/compiles</code> ephemeral compile dir data (<code>Settings.path.compilesDir</code>) <code>/var/lib/overleaf/data/output</code> ephemeral compile artifacts for download by the browser (<code>Settings.path.outputDir</code>) <p>For <code>docker-compose</code> based setups, we suggest just overriding the bind-mount from NFS, which avoids changing paths in the application. Here's an example of a <code>docker-compose</code> config excerpt with the use of a scratch disk that is mounted at <code>/scratch</code>:</p> <pre><code>services:\n  sharelatex:\n    environment:\n      SANDBOXED_COMPILES_HOST_DIR: /scratch/compiles/\n    volumes:\n      - nfs:/var/lib/overleaf/data\n      - /scratch/cache/:/var/lib/overleaf/data/cache\n      - /scratch/compiles/:/var/lib/overleaf/data/compiles\n      - /scratch/output/:/var/lib/overleaf/data/output\n      - /scratch/tmp/:/var/lib/overleaf/tmp\n</code></pre> <p>There is no need to migrate any existing files from the NFS to their new home after the update. The LaTeX compiler can recreate all the files with a full compilation run again.</p>"},{"location":"guides/common-problems/#upgrading-to-redis-62-results-in-a-restart-loop","title":"Upgrading to Redis 6.2 results in a restart loop","text":"<p>Use the <code>docker logs redis</code> command to output a copy of the logs.</p>"},{"location":"guides/common-problems/#fatal-cant-initialize-background-jobs","title":"<code>Fatal: Can't initialize Background Jobs</code>","text":"<p>The full output will look something like this: <pre><code>1:M 11 Feb 2024 15:19:22.609 # Server initialized\n1:M 11 Feb 2024 15:19:22.609 # Fatal: Can't initialize Background Jobs.\n1:C 11 Feb 2024 15:19:26.055 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\n</code></pre> If you see the line <code>Fatal: Can't initialize Background Jobs</code>, this may be related to the version of Docker currently in use. Updating to a version &gt;=20.10.10 should resolve this issue.</p> <p>For more information, see the Redis upstream issue here: https://github.com/redis/redis/issues/12362</p>"},{"location":"guides/common-problems/#incorrect-orientation-of-template-gallery-previewthumbnail-images","title":"Incorrect orientation of template gallery preview/thumbnail images","text":"<p>On occasion, the preview/thumbnail images generated by Server Pro can be created in the wrong orientation and require manual intervention to correct. These images are stored in <code>/var/lib/overleaf/data/template_files/</code> (&gt;= 5.0.3) and <code>/var/lib/sharelatex/data/template_files/</code> (earlier). </p> <p>Important</p> <p>We recommend backing up this folder before making any changes. </p> <p>You'll need to follow the steps below for each affected template: * Navigate to your instances template gallery (/templates/all), open an affected template, and copy the ID from the URL (https://your-instance-url/templates/6645d346c224815e9460a695) * Run the following command from the Docker host:</p> <p><code>docker exec sharelatex /bin/bash -c \"mogrify -rotate 90 /var/lib/overleaf/data/template_files/6645d346c224815e9460a695_*{thumbnail,preview}\"</code></p> <p>In the above example, you'll need to replace the ID <code>6645d346c224815e9460a695</code> with the one from the affected template and update the path if appropriate. </p>"},{"location":"guides/doc-version-recovery/","title":"Doc version recovery","text":"<p>If you never ran Server Pro version 5.0.1 or Community Edition version 5.0.1, or you started a brand new instance with 5.0.1, you do not need to run this recovery process.</p> <p>Update 1</p> <p>(2024-04-22 13:40 BST): Added step \"Stop new updates from getting into the system and flush all changes to MongoDB\".</p> <p>Update 2</p> <p>(2024-04-23 11:45 BST): Account for broken flushes in 5.0.1 and skip flushes when 5.0.2 was started.</p> <p>The duration of the recovery will depend on the number and size of projects in your instance and the storage backend used by the history store for chunks (as defined in <code>OVERLEAF_HISTORY_CHUNKS_BUCKET</code>).</p> <p>The recovery process will delay the application start inside the Server Pro container. The site will appear offline during that time. We only support running the recovery from a single instance of the Server Pro container, all other horizontal scaling workers need to be offline.</p> <p>You can stop and resume the recovery process if needed.</p> <p>Based on our performance tests, the recovery process can process approximately 10k small projects per minute on modern hardware (3GHz CPU clock speed and local NVMe storage). As an example, for an instance with 100k projects, schedule a maintenance window that allows at least 10+2min of downtime. Use the following query to estimate the number of projects in your instance: <pre><code>$ docker exec mongo mongosh sharelatex --quiet --eval 'db.projects.estimatedDocumentCount() + db.deletedProjects.estimatedDocumentCount()'\n</code></pre></p> <p>Please read the following recovery steps in full before you start. Server Pro customers are more than welcome to reach out to support@overleaf.com with any questions.</p> <p>Steps of the recovery process:    1. Pull the <code>5.0.3</code> release images.    2. Identify a few projects by id that are missing history; ideally you have permission to make a change to one of them.    3. Schedule a maintenance window for the downtime.    4. Stop all but one worker when using a horizontal scaling setup.    5. Stop new updates from getting into the system and flush all changes to MongoDB:        1. Close the editor and disconnect all users manually via the admin panel on <code>https://my-server-pro.example.com/admin#open-close-editor</code> in the \"Open/Close Editor\" tab.        2. Stop the Websocket/real-time service.           <pre><code>$ docker exec sharelatex sv stop real-time-overleaf\n</code></pre>        3. Wait for the real-time service to exit, as indicated by <code>down:</code>.           <pre><code>$ docker exec sharelatex sv status real-time-overleaf\nrun: real-time-sharelatex: (pid 394) 50s, want down, got TERM\n# wait a little longer...\n\n$ docker exec sharelatex sv status real-time-overleaf\ndown: real-time-sharelatex: 7s, normally up\n</code></pre>        4. Stop the git-bridge container if enabled.           <pre><code>$ docker stop git-bridge\n</code></pre>        5. If you never ran 5.0.2: Issue a manual flush for document updates and wait for it to finish with success.</p> <pre><code>      You can repeat the command on error. In case you see a non-zero `failureCount` in successive runs, please stop the migration (restore the services via `docker restart git-bridge sharelatex`) and reach out to support.\n      ```\n      $ docker exec sharelatex bash -c 'source /etc/container_environment.sh &amp;&amp; source /etc/overleaf/env.sh &amp;&amp; cd services/document-updater &amp;&amp; LOG_LEVEL=info node scripts/flush_all.js'\n      ...\n      {\"name\":\"default\",\"hostname\":\"...\",\"pid\":324,\"level\":30,\"successCount\":...,\"failureCount\":0,\"msg\":\"finished flushing all projects\",\"time\":\"...\",\"v\":0}\n      Done flushing all projects\n      ```\n   6. If you never ran 5.0.2: Ensure that all changes have been flushed out of redis.\n\n      If you get any output from `redis-cli`, please stop the migration (restore the services via `docker restart git-bridge sharelatex`) and reach out to support.\n      ```\n      $ docker exec redis redis-cli --scan --pattern 'DocVersion:*'\n      # no output from redis-cli indicates success, check exit code of redis-cli next, it should be zero\n      $ echo $?\n      0\n      ```\n   7. Try to flush any pending history changes.\n\n      This will need to be a best effort flush as some projects have broken histories due to the bad database migration. Any failures will be addressed with a re-sync of the history at the end of the recovery process.\n      ```\n      $ docker exec sharelatex bash -c 'source /etc/container_environment.sh &amp;&amp; source /etc/overleaf/env.sh &amp;&amp; cd /overleaf/services/project-history &amp;&amp; LOG_LEVEL=info node scripts/flush_all.js' \n      ```\n</code></pre> <ol> <li>Consider taking a consistent backup of the instance.</li> <li>Upgrade to version <code>5.0.3</code>.</li> <li>The recovery process runs on container start automatically.</li> <li>You can follow the progress of the script by tailing the log file <code>/var/lib/overleaf/data/history/doc-version-recovery.log</code>. It will print the total number of projects at the start and a summary after every 1000 projects processed.        <code>$ docker exec sharelatex tail --retry --follow /var/lib/overleaf/data/history/doc-version-recovery.log</code></li> <li>Wait for the recovery process to finish by either tailing the above log file until a <code>Done.</code> line has been printed or waiting for <code>Finished recovery of doc versions.</code> to be printed to the standard output of the Server Pro container.</li> <li> <p>Validate the recovery process by opening the history pane for a few of the projects with previously missing history.</p> <ol> <li>Expedite the resync for the projects to test (They will get processed eventually, but we do not want to wait for them to get their turn.)       <code>$ docker exec sharelatex curl -X POST --silent \"http://127.0.0.1:3054/project/000000000000000000000000/resync?force=true\"</code>       (Repeat with each of the project-ids to test, replace <code>000000000000000000000000</code> with one project-id at a time.)</li> <li>Open the project editor for the projects <code>https://my-server-pro.example.com/project/000000000000000000000000</code></li> <li>Open the \"History\" pane for the project and see the latest content.</li> <li>Optional: Close the \"History\" pane again. Make a code change, such as adding a comment to the header.</li> <li>Optional: Issue a re-compile to trigger a flush of the local change. Open the \"History\" pane again and see the change. When done, undo the change.</li> </ol> </li> <li> <p>Horizontal scaling: Start the other workers again.</p> </li> <li> <p>Please keep the instance running that executed the recovery process. It will resync the history for all projects in the background with a concurrency of 1. This will result in slightly elevated base load. (You can restart the instance, but it will need to start over with the resyncs.)</p> </li> <li> <p>Server Pro customers: Please let the support team know when you have completed the recovery process.</p> </li> </ol>"},{"location":"guides/for-users/","title":"For users","text":""},{"location":"guides/for-users/#using-templates-as-an-individual","title":"Using templates as an individual","text":"<p>If an individual user would like to use a template from the Template Gallery on overleaf.com they would need to:</p> <ol> <li>Navigate to the Template Gallery on overleaf.com and locate the required template, for example IEEE Photonics Journal Paper Template - Example Submission</li> <li>Click on the Open as Template button</li> <li>Click on the project menu and choose Download Source</li> <li>Next, log into their on-premise Server Pro account</li> <li>Click the New Project button from the projects dashboard and choose Upload Project</li> <li>Click the Select a .zip file button and choose the downloaded template zip file</li> </ol> <p>The user can then use this newly uploaded template as required.</p> <p>Note</p> <p>An overleaf.com account is required</p>"},{"location":"guides/full-project-history-migration/","title":"Full project history migration","text":"<p>The <code>3.5.x</code> release of Overleaf Community Edition includes the Full Project History feature that is already available in our SaaS offering, overleaf.com</p> <p>After upgrading your instance to Server CE <code>3.5.13</code>, all new projects will be using Full Project History by default. Existing projects will continue using the legacy History system, until they\u2019re migrated.</p> <p>Note: If you upgrade to <code>3.5.13</code> and decide to downgrade to an earlier version, then you should restore from a full system backup. The history of projects created in <code>3.5.13</code> is not compatible with earlier versions of Server CE. </p> <p>The new Full Project History brings several improvements for users: - It tracks changes in binary files, which is unsupported in the legacy system. - There is support for labelled versions. - The system is in general more robust, there is less chance of data loss.</p> <p>Check Full Project History documentation for more information about full project history.</p>"},{"location":"guides/full-project-history-migration/#migrating-existing-projects","title":"Migrating existing projects","text":"<ol> <li>Create a full backup of your instance with a consistent snapshot of the mongo, redis and sharelatex directories.</li> <li>Update the version of <code>sharelatex/sharelatex</code> image to <code>3.5.13</code> <ul> <li>toolkit users: Use the <code>$ bin/upgrade</code> script for upgrading the toolkit to the latest version and edit <code>config/version</code> to <code>3.5.13</code>.</li> </ul> </li> <li>Start the instance.<ul> <li>Ideally, you\u2019d want to prevent users from accessing your instance while the migration takes place, to avoid data loss in case you need to restore your backup. See Offline migration for more information on how to do this.</li> </ul> </li> <li>Wait until all the Server CE services are up and running (see command below)</li> </ol> <pre><code>$ bin/docker-compose exec sharelatex /bin/bash -c \"curl http://localhost:3000/status\"\nweb sharelatex is alive (api)%\n</code></pre> <ol> <li>Run the migration script: </li> </ol> <pre><code># Overleaf Toolkit users:\n$ bin/docker-compose exec sharelatex /bin/bash -c \"cd /overleaf/services/web; VERBOSE_LOGGING=true node scripts/history/migrate_history.js --force-clean --fix-invalid-characters --convert-large-docs-to-file\"\n\n# legacy docker-compose.yml users:\n$ docker exec sharelatex /bin/bash -c \"cd /overleaf/services/web; VERBOSE_LOGGING=true node scripts/history/migrate_history.js --force-clean --fix-invalid-characters --convert-large-docs-to-file\"\n</code></pre> <p>(<code>--force-clean</code> clears partially migrated project history data in the new system, this allows retrying the migration for individual projects that failed in prior attempts; <code>--fix-invalid-characters</code> replaces non printable characters that are not supported by the new history system; <code>--convert-large-docs-to-file</code> converts documents that are above the 2MB editable-size threshold to a non-editable file)</p> <p>The output should look like this:</p> <pre><code>Migrated Projects  :  1\nTotal Projects     :  51\nRemaining Projects :  51\nTotal history records to migrate: 98\nStarting migration...\nMigrating project: 63d29b5772dd80015a81bffe\nmigration result { upgraded: true, historyType: 'NoneWithoutConversion' }\nMigrating project: 63d29c2e72dd80015a81c0a2\nmigration result { upgraded: true, historyType: 'NoneWithoutConversion' }\n\n// \u2026\n\nMigration complete\n==================\nProjects migrated:  51\nProjects failed:  0\nDone.\n</code></pre> <p>If the migration is successful, you'll get an exit code of <code>0</code>, and the last lines indicating no failures:</p> <pre><code>Projects failed:  0\nDone.\n</code></pre> <p>You can reopen access to your users (see next step).  If there are failures, please see the troubleshooting section below. You can still reopen the site if the problems are not immediately fixed, and the unmigrated projects will remain on the legacy history system.</p> <ol> <li>Reopen the site. If you had chosen to perform an offline migration then you will need to re-open the site. If you are still logged in you will need to:</li> <li>Click on the Admin button and choose Manage Site</li> <li>Click the Open/Close Editor tab</li> <li>Click the Reopen Editor button</li> </ol> <p>If you have closed your browser then you will need to restart the site with <code>$ bin/up</code>.</p>"},{"location":"guides/full-project-history-migration/#offline-migration","title":"Offline migration","text":"<p>To prevent users from being able to log in while the history migration script is running, please follow these steps: - Log into your Overleaf instance with an admin account - Click on the Admin button and choose Manage Site - Click the Open/Close Editor tab - Click on the Close Editor button - Click on the Disconnect all users button</p> <p>Once this has been done, if any users are logged in they will get redirected to the maintenance page, and any new users visiting the log-in page will see the maintenance page and won't be able to log in. </p>"},{"location":"guides/full-project-history-migration/#online-migration","title":"Online migration","text":"<p>It is possible to run the migration scripts while the application is still running. There are a few considerations to take into account:</p> <ul> <li>The migration process is CPU intensive, you should monitor resource usage while the script is running. </li> <li>With a high <code>--concurrency</code> value, the event loop in some services (<code>track-changes</code> in particular) might experience some blocking, which would lead to a degraded UX experience. We recommend starting with the default <code>--concurrency=1</code> value. </li> <li>You can stop the script at any time. Starting it again will resume the migration when you left it. This is useful in case you prefer to run the migration in less busy hours (e.g. at night).</li> </ul> <p>Our recommendation is to close the site and run the migration offline in a maintenance window when your project count is less than 1000 projects (<code>db.projects.count()</code>). If the number of projects is large you can run the script and monitor its progress, then decide whether to continue running it online or offline based on your particular case. </p>"},{"location":"guides/full-project-history-migration/#clean-up-legacy-history-data","title":"Clean up legacy history data","text":"<p>A script to cleanup legacy history data was added in Server Pro <code>3.5.6</code>, <code>4.0.6</code> and <code>4.1.0</code>.</p> <pre><code>bin/docker-compose exec sharelatex /bin/bash -c \"cd /overleaf/services/web; node scripts/history/clean_sl_history_data.js\"\n</code></pre> <p>The script can be run after all the projects have been migrated. It can also be used to free some space while performing an online migration.</p> <p>Note</p> <p>In Server Pro before version 3.5.13, the script deletes the content of <code>docHistory</code> and <code>docHistoryIndex</code> collections. Mongo does not release disk space after you delete documents, instead, it will reuse that space for future documents in the same collection. Nothing will write to these collections again after the history migration, so the disk space will remain unused.</p> <p>If you want to make the disk space available again you can upgrade to Server Pro 3.5.13 (when still using the 3.x release) or Server Pro 4.2.5 (when using the 4.x release) and re-run the cleanup script.</p> <p>The cleanup script as included in Server Pro the latest patch releases of <code>3.5.x</code> and latest <code>4.x.x</code> are dropping the collections as the final step.</p> <p>It is safe to re-run the cleanup script.</p>"},{"location":"guides/full-project-history-migration/#troubleshooting","title":"Troubleshooting","text":"<p>We will add troubleshooting advice here. Please note that while we normally offer support only to Server Pro customers, given the nature of this migration, we will also do our best to support CE customers who experience problems specific to the full project history migration.</p> <p>If the full project history migration script fails (i.e. exits with an error or prints a non-zero number of failed projects), please send the following details to our support team by email support+historymigration@overleaf.com, detailing:</p> <p>Subject: Full project history migration problem</p> <ul> <li>Instance Type: CE or Server Pro (delete as appropriate)</li> <li>Installation Type: Overleaf toolkit or <code>docker-compose.yml</code> or other (delete as appropriate)</li> <li>Version: 3.5.x (toolkit: <code>$ cat config/version</code>)</li> <li>Migration script output (which should be located in the container under <code>/overleaf/services/web</code>)</li> <li>Migrated Projects: (as per migration script output)</li> <li>Total Projects: (as per migration script output)</li> <li>Remaining Projects: (as per migration script output)</li> <li>Duration of the migration:</li> <li><code>bin/doctor</code> output (when using toolkit)</li> <li>Toolkit version: <code>$ git rev-parse HEAD</code> (when using toolkit)</li> </ul> <p>Consider attaching the log files for the <code>history-v1</code>, <code>project-history</code> and <code>track-changes</code> services to the email. You can find these at <code>/var/log/sharelatex</code> inside the <code>sharelatex</code> container and export them like this: <pre><code>$ docker cp sharelatex:/var/log/sharelatex/history-v1.log history-v1.log\n$ docker cp sharelatex:/var/log/sharelatex/project-history.log project-history.log\n$ docker cp sharelatex:/var/log/sharelatex/track-changes.log track-changes.log\n</code></pre> Please redact any sensitive information from the log files before attaching them.</p>"},{"location":"guides/full-project-history-migration/#finding-broken-file-trees","title":"Finding broken file trees","text":"<p>The migration may fail for projects which have a malformed file tree (for example, where filenames are empty).  You can find a list of these problems using the <code>find_malformed_filetrees</code> script which checks all projects in the database:</p> <pre><code>$ bin/docker-compose exec sharelatex /bin/bash -c \"cd /overleaf/services/web; node scripts/find_malformed_filetrees.js\"\nBAD PATH: 123456789012345678901234 rootFolder.0.1.2.3\nBAD PATH: 123456789012345678901234 rootFolder.0.4.5.6\n...\n</code></pre> <p>To fix the invalid paths, use the <code>fix_malformed_filetree</code> script, running the command once for each bad path:</p> <pre><code>$ bin/docker-compose exec sharelatex /bin/bash -c \"cd /overleaf/services/web; node scripts/fix_malformed_filetree.js 123456789012345678901234 rootFolder.0.1.2.3\"\n$ bin/docker-compose exec sharelatex /bin/bash -c \"cd /overleaf/services/web; node scripts/fix_malformed_filetree.js 123456789012345678901234 rootFolder.0.4.5.6\"\n...\n</code></pre>"},{"location":"guides/full-project-history-migration/#downgrading-projects-from-full-project-history-to-legacy-history","title":"Downgrading projects from full project history to legacy history","text":"<p>If there is a project which has been migrated to full project history but you want to go back to the legacy history, use the <code>downgrade_project</code> script as follows:</p> <pre><code>$ bin/docker-compose exec sharelatex /bin/bash -c \"cd /overleaf/services/web; PROJECT_ID=YOURPROJECTID node scripts/history/downgrade_project.js\"\n</code></pre>"},{"location":"guides/project-management/","title":"Project management","text":""},{"location":"guides/project-management/#recovering-deleted-docs","title":"Recovering deleted docs","text":"<ol> <li>Log in using your administrator credentials</li> <li>Click Admin and select Manage Users</li> <li>Using the search field, enter the email of the user you want to restore the doc for</li> <li>Click their email address in the list of returned results to open their user info page</li> <li>Click the Projects tab and use the search field to search for the project</li> <li>Click on the information icon next to the project name to open the Project Info</li> <li>Click on the Deleted Docs tab</li> <li>Click on the Undelete button next to the deleted doc to restore it back to the users project. </li> </ol> <p>The restored file will take the following format: <code>FILENAME-TIMESTAMP.EXTENSION</code>. For example, a restored version of <code>main.tex</code> will be restored to the root of the project with the file name <code>main-2024-02-23-130441542.tex</code>.</p>"},{"location":"guides/project-management/#transferring-ownership-of-a-project","title":"Transferring ownership of a project","text":"<p>The admin panel in Server Pro has a dedicated page per project. You can either get to it by searching for the user on \"/admin/user\", then going to their Projects tab, finding the project in the list and clicking on the  icon; or by directly navigating to the page with a known project-id \"/admin/project/\". On the project info page, you can find a Transfer Ownership button, which opens a modal where you can specify any user as the new owner. The new owner does not need to be an existing collaborator on the project. <p>Info</p> <p>Note that the previous owner will be added as a collaborator with read-and-write access to the project as part of the ownership transfer process.</p>"},{"location":"guides/troubleshooting/","title":"Gathering information","text":""},{"location":"guides/troubleshooting/#consulting-the-doctor","title":"Consulting the Doctor","text":"<p>The Overleaf Toolkit comes with a handy tool for debugging your installation: <code>bin/doctor</code></p> <p>Let's run the <code>bin/doctor</code> script:</p> <pre><code>$ bin/doctor\n</code></pre> <p>We should see some output similar to this:</p> <pre><code>====== Overleaf Doctor ======\n- Host Information\n    - Linux\n    ...\n- Dependencies\n    - bash\n        - status: present\n        - version info: 5.1.16(1)-release\n    - docker\n        - status: present\n        - version info: Docker version 25.0.3, build 4debf41\n    - docker compose\n        - status: present\n        - version info: docker compose version v2.25.5\n    ...\n====== Configuration ======\n    ...\n====== Warnings ======\n- None, all good\n====== End ======\n</code></pre> <p>First, we see some information about the host system (the machine that the Toolkit is being run on), then some information about dependencies. If any dependencies are missing, we will see a warning here. Next, the doctor checks our local configuration. At the end, the doctor will print out some warnings, if any problems were encountered.</p> <p>When you run into problems with your Toolkit, you should first run the doctor script and check it's output. </p>"},{"location":"guides/troubleshooting/#validating-the-version-number","title":"Validating the version number","text":"<p>In certain setups, particularly when customers are overriding configuration defaults, re-tagging images, or hosting their repositories, it may be sometimes necessary to validate the version of the Overleaf you are running, especially when minor changes have been made and the differences might not be so noticeable. You can validate the version number by running the following command and then checking the our release notes](https://github.com/overleaf/overleaf/wiki#release-notes) for the version that corresponds to the returned value.</p> <p><pre><code># Get the first 12 characters of Image Id from the sharelatex image\n$ docker inspect --format '{{.Image}}' sharelatex | cut -d ':' -f 2 | cut -c 1-12\n\n3a75a815d297\n</code></pre> In this case, the truncated Image ID <code>3a75a815d297</code> is for Server Pro 4.2.1</p>"},{"location":"guides/troubleshooting/#debug-logging","title":"Debug logging","text":"<p>Sometimes it might be necessary to enable additional logging so that we have more visibility of what happening. To enable debug logging for specific period of time (in this case 1-day), and without introducing any downtime, please run the following command from your Server Pro instance host. </p> <pre><code>docker exec sharelatex bash -exc 'mkdir -p /logging &amp;&amp; echo $(node -p \"Date.now()+1000*60*60*24\") &gt; /logging/tracingEndTime'\n</code></pre> <p>Note</p> <p>Logging will be in debug mode for 1-day but the debug logging event trigger file will remain in place until it is deleted.</p> <p>Once you've run the command it'll take up to 1 minute for Server Pro to start logging in debug mode.</p> <p>To stop debug logging before 1-day, or to remove the debug logging event trigger file, please run the following command from your Server Pro instance terminal. </p> <pre><code>docker exec sharelatex rm /logging/tracingEndTime\n</code></pre>"},{"location":"guides/troubleshooting/#getting-help","title":"Getting help","text":"<p>Important</p> <p>Users of the free Overleaf Community Edition should open an issue on github and include the output of the <code>bin/doctor</code> script in your message. </p> <p>Users of Overleaf Server Pro should contact <code>support+serverpro@overleaf.com</code> for assistance. </p> <p>When reaching out, to help us identify what the issue might be, please provide us with either a copy of your docker-compose.yml file (ensuring that all sensitive information is redacted ) or the output from running <code>bin/doctor</code> and the contents of the /config folder (again redacting all sensitive information) if you are using the Toolkit. </p> <p>In addition to that, please also let us know the answers to the following:</p> <ul> <li>What version of Server Pro are you currently running?</li> <li>What hardware and operating system are you using?</li> <li>Have any recent changes been made to your Server Pro instance, for example, configuration changes made to Server Pro itself, the host or any hardware/infrastructure changes?</li> </ul> <p>Please also provide us with a copy of the web.log. You can get a copy of this log from the container by running this command:  <code>docker cp sharelatex:/var/log/sharelatex/web.log web.log</code> and additionally, copies of any of the following logs relevant to the issue:</p> <ul> <li>A copy of the clsi.log to help with project compiling issues. You can get a copy of this log from the container by running this command:  <code>docker cp sharelatex:/var/log/sharelatex/clsi.log clsi.log</code></li> <li>A copy of the git-bridge.log to help with the Git Bridge integration. You can get a copy of this log from the container by running this command:  <code>docker logs git-bridge &gt; git-bridge.log</code></li> <li>A copy of the project-history.log to help with project history issues. You can get a copy of this log from the container by running this command:  <code>docker cp sharelatex:/var/log/sharelatex/project-history.log project-history.log</code></li> <li>A copy of the history-v1.log to help with project history issues. You can get a copy of this log from the container by running this command:  <code>docker cp sharelatex:/var/log/sharelatex/history-v1.log history-v1.log</code></li> <li>A copy of the MongoDB logs to help with database related issues. You can get a copy of this log from the container by running this command:  <code>docker logs mongo &gt; mongodb.log</code></li> </ul> <p>Once we have this information, we'll be able to look into this issue for you and provide you with some next steps.</p>"},{"location":"guides/troubleshooting/#live-troubleshooting-sessions","title":"Live troubleshooting sessions","text":"<p>Unfortunately, while there are benefits associated with live troubleshooting sessions, due to the nature of the application being an on-premise solution there are a number of reasons we're unable to provide them, the most important being privacy/security, ensuring that no sensitive information is inadvertently shared (this is why we ask for redacted configuration files). </p> <p>Live troubleshooting is not always the most effective method when we encounter an issue for the first time. In these cases, issues require thorough investigation and testing, which shouldn't be rushed in a live session (even if this is in a test environment) as steps can be overlooked and resolutions not properly documented. </p> <p>Instead, we focus on asynchronous support, allowing us to provide secure, considered troubleshooting steps as quickly as possible, with most support queries responded to within one business day.</p>"},{"location":"guides/user-management/","title":"User management","text":""},{"location":"guides/user-management/#searching-for-users","title":"Searching for users","text":""},{"location":"guides/user-management/#provisioning-users","title":"Provisioning users","text":"<p>Once you are logged in as an admin user, you can visit /admin/register on your Overleaf instance and create new users. If you have an email backend configured in your settings file, new users will be sent an email with a URL to set their password. If not, you will have to distribute the password reset URLs manually. These are shown when you create a user.</p>"},{"location":"guides/user-management/#creating-administrators","title":"Creating administrators","text":""},{"location":"guides/user-management/#deleting-users","title":"Deleting users","text":""},{"location":"guides/user-management/#counting-users","title":"Counting users","text":"<p>Create a mongo shell by running <code>bin/mongo</code> and check the number of entries in the <code>users</code> collection:</p> <pre><code>&gt; db.users.count()\n16\n</code></pre>"},{"location":"guides/user-management/#updating-user-details","title":"Updating user details","text":""},{"location":"guides/user-management/#generating-password-reset-links","title":"Generating password reset links","text":""},{"location":"guides/user-management/#viewing-user-audit-logs","title":"Viewing user audit logs","text":""},{"location":"guides/user-management/#viewing-user-session-information","title":"Viewing user session information","text":""},{"location":"guides/user-management/#understanding-license-usage","title":"Understanding license usage","text":"<p>Overleaf Server Pro licensing is quite different from other cloud-based solution in that there is no concept of free collaboration, any user who logs in and accesses a project is considered an active user by the system, necessitating a corresponding license. </p> <p>Tip</p> <p>Administrators can view the total number of active users on your instance via Admin &gt; Manage Users &gt; License Usage. An active user is defined as someone who has opened a project on your Server Pro instance in the last 12 months.</p> <p>The active/inactive flag for an account is just a high-level indicator for the administrator to help indicate usage. If a user who holds an Server Pro license leaves your organization, there is no immediate necessity to delete their account and their associated projects. This action is often required for regulatory and compliance purposes, but from a licensing point of view, the license allocated to the departing user can be reassigned to their successor, allowing for a seamless transition.</p> <p>In general, it's advisable not to delete accounts (unless they are no longer required), as this action would lead to the removal of the account's projects and prevent any collaborators from accessing them. </p> <p>Presently, there is no provision for deactivating accounts; they either exist with retained data or don't exist at all. The recommended approach is to leave the account and its associated data within Server Pro, ensuring any projects are part of your backup process.</p> <p>Over time, unused accounts will transition to an inactive state (as they will not have accessed a project within the past 12 months), denoting that they no longer require a license, even though the accounts and associated projects are retained. In the event a user returns, they can access their account and projects, reinstating their status as an active user and once again requiring a licence.</p> <p>It's important to highlight that in Server Pro, Administrators retain the capability to access the projects of any user, even after that user has left the organization. This maintains a certain degree of access and authority over projects. Additionally, Administrators hold the ability to transfer ownership of projects from one user to another, offering full control over your data.</p> <p>When it comes to renewals, as Server Pro doesn't transmit usage information back to us, we rely on customers to report their user count for license compliance. Server Pro doesn't enforce a strict user limit, and there's no explicit 'inactive' setting for users. This means that if you're aware of inactive users, you have the option to exclude them when reporting your seat count to us. </p> <p>One way of doing this would be to report the number of users within your authorized group, rather than the total number of users in the Server Pro instance, as the latter might encompass older, inactive accounts.</p>"},{"location":"installation/post-installation-tasks/","title":"Post-installation tasks","text":""},{"location":"installation/post-installation-tasks/#creating-your-first-administrator-account","title":"Creating your first administrator account","text":"<p>In a browser, open http://localhost/launchpad. You should see a form with email and password fields. Fill these in with the credentials you want to use as the administrator account, then click Register.</p> <p></p> <p>Then click the link to go to the login page (http://localhost/login). Enter the credentials. Once you are logged in, you will be taken to a welcome page.</p> <p></p> <p>Click the green button at the bottom of the page to start using Overleaf.</p>"},{"location":"installation/post-installation-tasks/#creating-your-first-example-project","title":"Creating your first example project","text":"<p>Open http://localhost/project in your browser and you will see a button prompting you to create your first project. </p> <p></p> <p>Click this button, select Example Project and follow the on-screen instructions.</p> <p>You should then be taken to the new project, where you will see a text editor and a PDF preview.</p> <p></p> <p>To finish you can click on the Home icon to return to your users projects page.</p>"},{"location":"installation/using-the-toolkit/","title":"Using the Overleaf Toolkit","text":"<p>The Overleaf Toolkit is the recommended way to deploy and manage Overleaf Server CE and Server Pro instances. </p> <p>In this section we will guide you through downloading the Toolkit from GitHub, familiarizing yourself with some of the Toolkit's commands and configuring some basic settings. By the end of this page you should have a running Overleaf Community Edition instance.</p>"},{"location":"installation/using-the-toolkit/#downloading-the-toolkit","title":"Downloading the Toolkit","text":"<p>The Toolkit is compatible with both the Server CE and Server Pro and is the recommend installation method. Using the Toolkit will allow you to easily get started with Server CE and seamlessly upgrade to Server Pro if required.</p> <p>To install the Toolkit you'll need to navigate to the intended installation path and then clone the Overleaf Toolkit GitHub repository using this command:</p> <pre><code>git clone https://github.com/overleaf/toolkit.git ./overleaf-toolkit\n</code></pre> <p>Tip</p> <p>To prevent any potential permissions issues we recommend installing the Toolkit in your users <code>$HOME</code> directory.</p> <p>Wait for the cloning process to complete then let's switch into the newly created <code>overleaf-toolkit</code> directory:</p> <pre><code>cd ./overleaf-toolkit\n</code></pre>"},{"location":"installation/using-the-toolkit/#taking-a-look-around","title":"Taking a look around","text":"<p>Now that we have a local copy of the Toolkit, let's take a look at the structure of the repository using the <code>ls</code> command:</p> <pre><code>ls -l\n</code></pre> <p>Info</p> <p>The <code>ls -l</code> command displays a detailed long listing view of the contents of a directory, providing additional file information such as permissions, ownership and size.</p> <p>If everything was cloned successfully you should see something like this:</p> <pre><code>drwxr-xr-x 3 fry fry  4096 Aug 30 14:16 bin\n-rw-r--r-- 1 fry fry  6465 Aug 30 14:16 CHANGELOG.md\ndrwxr-xr-x 2 fry fry  4096 Sep  6 12:43 config\ndrwxr-xr-x 5 fry fry  4096 Aug 30 14:22 data\ndrwxr-xr-x 3 fry fry  4096 Aug 30 14:16 doc\ndrwxr-xr-x 3 fry fry  4096 Aug 30 14:16 lib\n-rw-r--r-- 1 fry fry 34520 Aug 30 14:16 LICENSE\n-rw-r--r-- 1 fry fry  1178 Aug 30 14:16 README.md\n</code></pre> <p>Note</p> <p>All user-owned configuration files are found in the <code>config/</code> directory. This directory is excluded from the git revision control system, so it will not be changed by updating the Toolkit. </p> Name Description <code>bin</code> This folder contains a collection of scripts that help you manage your Overleaf server instance. You can read more about these scripts in our Commands section below. <code>config</code> This folder contains your own local configuration files. <code>lib</code> This folder contains base configuration files used by the Toolkit. <code>data</code> By default this folder contains the storage location for MongoDb, Redis and Overleaf. For more information see Persistent data section below. <p>Info</p> <p>The Toolkit will not change any data in the <code>config/</code> directory without your permission.</p>"},{"location":"installation/using-the-toolkit/#initializing-the-configuration","title":"Initializing the configuration","text":"<p>Let's initialize our new servers configuration files with some sensible defaults by running the bundle <code>bin/init</code> script. </p> <pre><code>bin/init\n</code></pre> <p>Info</p> <p>This script will not overwrite any existing configuration files.</p> <p>Now lets check the contents of the <code>config/</code> directory using the <code>ls</code> command:</p> <p><pre><code>ls config\n</code></pre> If everything was successfully initialized you should see three configuration files <code>overleaf.rc</code>,  <code>variables.env</code> and <code>version</code>. These are the main server configuration files and allow you to customize how your server operates and how your users interact with your instance.</p> Name Description <code>overleaf.rc</code> The main top-level configuration file. <code>variables.env</code> Environment variables loaded into the Docker container. <code>version</code> The version of the Docker image to use. <p>Info</p> <p>For now it's enough to know that these files exist and where you can find them. Later on in the documentation we'll go through each of the files in more detail and explain how you can customize your instance using them. If you want to skip ahead you can see a full breakdown of these configuration files see our Configuration section.</p>"},{"location":"installation/using-the-toolkit/#personalizing-your-instance","title":"Personalizing your instance","text":"<p>Before we start your Overleaf instance for the first time we're going to update the <code>config/variables.env</code> configuration file with your custom information.</p> <p>Open the <code>config/variables.env</code> file using your favourite text editor and update each of the following environment variables with the required information.</p> Name Description Example <code>OVERLEAF_SITE_URL</code> Where your instance of Overleaf is publicly available. This is used in public links, and when connecting over websockets, so must be configured correctly! https://overleaf.lilliput.com <code>OVERLEAF_EMAIL_FROM_ADDRESS</code> This email address will be used as the <code>from</code> address for all outgoing emails. no-reply@lilliput.com <code>OVERLEAF_ADMIN_EMAIL</code> The email address where users can reach the person who runs the site. it-services@lilliput.com <p>Once you have updated these environment variables, save and quit - you're now ready to start your instance for the first time.</p> <p>To start your instance run the following command:</p> <pre><code>bin/up\n</code></pre> <p>This command will download all the required images, create the containers (using your customizations) and start up the instance. You should see some log output from the various Docker containers. You can start them up again (without attaching to the log output) by running <code>bin/start</code>.</p> <p>Info</p> <p>The Overleaf Toolkit uses <code>docker compose</code> to manage the Overleaf Docker containers. The Toolkit provides a set of scripts which wrap <code>docker compose</code>, and takes care of most of the details for you.</p> <p>If all goes well, you should be able view the log in page for your new Overleaf instance by navigating to http://127.0.0.1/ or http://localhost/ in your browser.</p> <p></p> <p>Warning</p> <p>Depending on your network configuration and where your Overleaf instance is being hosted you may need to make some additional configuration changes. See the Configuration section for more details.</p> <p>That's it for the initial part of installation. You can now move onto the Post installation tasks where you'll Create your first administrator account and First example project.</p>"},{"location":"maintenance/data-and-backups/","title":"Data and Backups","text":"<p>Some times we need to change the schema of data in the database as we evolve Overleaf, migration scripts are used to automate this process. They will have been run on overleaf.com first which is the largest instance of Overleaf in the world so most eventualities will have been encounter already, however we make no guarantees over your data. Please ensure that you create a consistent back of your data before upgrading you instance.</p>"},{"location":"maintenance/data-and-backups/#data-storage","title":"Data storage","text":"<p>Server CE and Server Pro store their data in three separate places:</p> <ul> <li>Mongo Database: This is where user and project data reside.</li> <li>Redis: serves as a high-performance cache for in-flight data, primarily storing information related to project editions and collaboration.</li> <li> <p>Overleaf Filesystem: stores non-editable project files (including images) and also acts as a temporary disk cache during project compilations.</p> <p>Note</p> <p>This might be <code>~/sharelatex_data</code> or <code>~/overleaf_data</code>, depending on when you're instance was setup.</p> <p>Note</p> <p>For project files and full project history data we also support S3 compatible storage backends.</p> </li> </ul> <p>See section \"Folders in detail\" for details on the folder layout on disk.</p>"},{"location":"maintenance/data-and-backups/#performing-a-consistent-backup","title":"Performing a consistent backup","text":"<p>There are three stores which need to included when taking a consistent backup:</p> <ul> <li>MongoDB</li> <li>Redis</li> <li>Overleaf Filesystem data</li> </ul> <p>In order to produce a consistent backup it is mandatory to stop users from producing new data while the backup process is running. We therefore advise scheduling a maintenance window during which, users should not be able to access the instance or edit their projects.</p> <p>Before you start the backup process you will need to take your instance offline. Starting with Server Pro <code>3.5.0</code> the shutdown down process automates the closing of the site and the disconnection of users.</p> <p>To shutdown your instance you'll need to run <code>bin/docker-compose stop sharelatex</code> if you are running a Toolkit deployment or <code>docker compose stop sharelatex</code> if you are running Docker Compose.</p> <p>Once the <code>sharelatex</code> container has been stopped you and start the backup process.</p> <p>Once the backup process has been completed successfully you'll need to start the <code>sharelatex</code> container. To do this run <code>bin/docker-compose start sharelatex</code> if you are running a Toolkit deployment or <code>docker compose start sharelatex</code> if you are running Docker Compose.</p> <p>Important</p> <ul> <li> <p>Backups should be stored on a separate server to the one your Overleaf instance is running on, ideally in a different location entirely. </p> </li> <li> <p>Replicating databases onto multiple MongoDB instances might offer some redundancy, it doesn't safeguard against corruption.</p> </li> <li> <p>Testing your backups is the best way to ensure they are complete and functional.</p> </li> </ul>"},{"location":"maintenance/data-and-backups/#mongodb","title":"MongoDB","text":"<p>MongoDB comes with a command-line tool called mongodump which can be used to create a backup of user and project data stored in the database.</p>"},{"location":"maintenance/data-and-backups/#overleaf-filesystem-data","title":"Overleaf Filesystem data","text":"<p>For Toolkit deployments, the path where your non-editable files are stored is specified in <code>config/overleaf.rc</code> using the <code>OVERLEAF_DATA_PATH</code> environment variable. This might be: <code>data/sharelatex</code>, using a tool such as rsync to recursively copy this directory is required to ensure a complete backup is created.</p>"},{"location":"maintenance/data-and-backups/#redis","title":"Redis","text":"<p>Redis stores user sessions and pending document updates before they are flushed to MongoDB. </p>"},{"location":"maintenance/data-and-backups/#aof-append-only-file","title":"AOF (Append Only File)","text":"<p>AOF (Append Only File) persistence is the recommended configuration for Redis persistence.</p> <p>Toolkit users have AOF persistence enabled by default for new installs. Existing users are recommended to follow the instructions on the official documentation to switch to AOF:</p> <p>https://redis.io/docs/latest/operate/oss_and_stack/management/persistence/#how-i-can-switch-to-aof-if-im-currently-using-dumprdb-snapshots</p> <p>If you decide to continue using RDB snapshots along with AOF persistence you can copy the RDB file to a secure location as a backup.</p>"},{"location":"maintenance/data-and-backups/#migrating-data-between-servers","title":"Migrating data between servers","text":"<p>At best you do not have any valuable data in the new instance yet. We do not have a process for merging the data of instances.</p> <p>Assuming the new instance has not data yet, here are some steps you could follow. On a high level we produce a tar-ball of the mongo, redis and overleaf volumes, copy it over to the new server and inflate it there again.</p> <p>With the default docker-compose file that would be: <pre><code># Gracefully shutdown the old instance\n# (See https://github.com/overleaf/overleaf/wiki/Data-and-Backups#performing-a-backup)\nold-server$ docker stop sharelatex\nold-server$ docker stop mongo redis\n\n# Create the tar-ball\nold-server$ tar --create --file backup-old-server.tar ~/OVERLEAF_data ~/mongo_data ~/redis_data\n\n# Copy the backup-old-server.tar file from the old-server to the new-server using any method that fits\n\n# Gracefully shutdown new instance (if started yet)\nnew-server$ docker stop sharelatex\nnew-server$ docker stop mongo redis\n\n# Move new data, you can delete it too\nnew-server$ mkdir backup-new-server\nnew-server$ mv ~/OVERLEAF_data ~/mongo_data ~/redis_data backup-new-server/\n\n# Populate data dirs again\nnew-server$ tar --extract --file backup-old-server.tar\n\n# Start containers\nnew-server$ docker start mongo redis\nnew-server$ docker start sharelatex\n</code></pre> Depending on your docker-compose config, you may need to adjust the paths of the mongo/redis/overleaf volume.</p> <p>With a toolkit setup that would be: <pre><code># Gracefully shutdown the old instance\n# (See https://github.com/overleaf/overleaf/wiki/Data-and-Backups#performing-a-backup)\nold-server$ bin/stop\n\n# Create the tar-ball\nold-server$ tar --create --file backup-old-server.tar config/ data/\n\n# Copy the backup-old-server.tar file from the old-server to the new-server using any method that fits\n\n# Gracefully shutdown new instance (if started yet)\nnew-server$ bin/stop\n\n# Move new data, you can delete it too\nnew-server$ mkdir backup-new-server\nnew-server$ mv config/ data/ backup-new-server/\n\n# Populate config/data dir again\nnew-server$ tar --extract --file backup-old-server.tar\n\n# Start containers\nnew-server$ bin/up\n</code></pre></p>"},{"location":"maintenance/data-and-backups/#folders-in-detail","title":"Folders in detail","text":"<ol> <li><code>~/mongo_data</code> (b)</li> <li>mongodb datadir</li> <li><code>~/redis_data</code> (b)</li> <li>redis db datadir</li> <li><code>~/overleaf_data</code></li> <li>bin<ol> <li>synctex (d)<ul> <li>unused in latest release, previously a custom synctex binary was used    (synctex is used for source mapping between .tex files and the pdf) </li> </ul> </li> </ol> </li> <li>data<ol> <li>cache (e)<ul> <li>binary file cache for compiles</li> </ul> </li> <li>compiles (e)<ul> <li>latex compilation happens here</li> </ul> </li> <li>db.sqlite (d)<ul> <li>unused in latest release, previously stored clsi cache details    (either moved to simple in-memory maps or we scan the disk)</li> </ul> </li> <li>db.sqlite-wal (d)<ul> <li>unused in latest release, see db.sqlite</li> </ul> </li> <li>output (e)<ul> <li>latex compilation output storage for serving to client</li> </ul> </li> <li>template_files (b)<ul> <li>image previews of template system (Server Pro only)</li> </ul> </li> <li>user_files (b)<ul> <li>binary files of projects</li> </ul> </li> <li>history (b)<ul> <li>full project history files</li> </ul> </li> </ol> </li> <li>tmp<ol> <li>dumpFolder (e)<ul> <li>temporary files from handling zip files</li> </ul> </li> <li>uploads (e)<ul> <li>buffering of file uploads (binary file/new-project-from-zip upload)</li> </ul> </li> <li>projectHistories (e)<ul> <li>temporary files for full project history migrations</li> </ul> </li> </ol> </li> </ol> <p>The folders have additional hints: - (b) include in backups, best when the instance is stopped to ensure consistency - (d) can be deleted - (e) ephemeral files, can be deleted when the instance is stopped</p>"},{"location":"maintenance/docker-compose-to-toolkit-migration/","title":"docker-compose.yml to Toolkit migration","text":"<p>If you're currently using Docker Compose via a <code>docker-compose.yml</code> file, migrating to the Toolkit can make running an on-premises version of Overleaf easier to deploy, upgrade and maintain.</p> <p>To migrate, you'll need to convert your existing Docker Compose setup into the format used by the Toolkit. This process involves copying existing configuration into the Toolkit.</p> <p>This guide will walk you through each step of this process, ensuring a smooth migration from Docker Compose to the Toolkit.</p> <p>Note</p> <p>These instructions are for v4.x and earlier. Therefore all variables use the <code>SHARELATEX_</code> prefix instead of <code>OVERLEAF_</code></p>"},{"location":"maintenance/docker-compose-to-toolkit-migration/#clone-the-toolkit-repository","title":"Clone the Toolkit repository","text":"<p>First, let's clone this Toolkit repository to the host machine: <pre><code>$ git clone https://github.com/overleaf/toolkit.git ./overleaf-toolkit\n</code></pre> Next run the <code>bin/init</code> command to initialise the Toolkit with its default configuration.</p>"},{"location":"maintenance/docker-compose-to-toolkit-migration/#setting-the-image-and-version","title":"Setting the image and version","text":"<p>In the <code>docker-compose.yml</code> file the image and version are defined in the component description:</p> <pre><code>version: '2.2'\nservices:\n    sharelatex:\n        restart: always\n        # Server Pro users:\n        # image: quay.io/sharelatex/sharelatex-pro\n        image: sharelatex/sharelatex:3.5.13\n</code></pre> <p>When using the Toolkit, the image name is automatically resolved; the only requirement is to set <code>SERVER_PRO=true</code> in config/overleaf.rc to pick the Server Pro image or <code>SERVER_PRO=false</code> to use Community Edition.</p> <p>The desired Server Pro/Community Edition version number is set in the config/version file. The Toolkit requires a specific version number like \"4.2.3\". In case you are using <code>latest</code>, you can use <code>bin/images</code> to find the image id of your local <code>latest</code> version, then use the release notes for 2.x, 3.x, 4.x or 5.x to map the image id to the version.</p> <p>If you are sourcing the image from your own internal registry you can override the image the Toolkit uses by setting <code>OVERLEAF_IMAGE_NAME</code>. You do not need to specify the tag as the Toolkit will automatically add it based on your config/version file.</p>"},{"location":"maintenance/docker-compose-to-toolkit-migration/#configuring-external-access","title":"Configuring external access","text":"<p>By default, Overleaf will listen on 127.0.0.1:80, only allowing traffic from the Docker host machine.</p> <p>To allow external access, you\u2019ll need to set the <code>OVERLEAF_LISTEN_IP</code> and <code>OVERLEAF_PORT</code> in the [config/overleaf.rc](/configuration/overleaf-toolkit/</p>"},{"location":"maintenance/docker-compose-to-toolkit-migration/#environment-variable-migration","title":"Environment variable migration","text":"<p>You\u2019ll likely have a set of environment variables defined in the sharelatex service:</p> <pre><code>environment:\n    OVERLEAF_APP_NAME: Overleaf Community Edition\n    OVERLEAF_PROXY_LEARN: 'true'\n    \u2026\n</code></pre> <p>Each of these variables should be copied, with several exceptions we\u2019ll list later, into the Toolkit\u2019s config/variables.env file, ensuring the following form (note the use of <code>=</code> instead of <code>:</code>):</p> <pre><code>OVERLEAF_APP_NAME=Overleaf Community Edition\nOVERLEAF_PROXY_LEARN=true\n</code></pre> <p>As mentioned above, there are several exceptions, as certain features are configured differently when using the Toolkit:</p> <ul> <li>Variables starting with <code>SANDBOXED_COMPILES_</code> and <code>DOCKER_RUNNER</code> are no longer needed. To enable Sandboxed Compiles, set <code>SIBLING_CONTAINERS_ENABLED=true</code> in your config/overleaf.rc file.</li> <li>Variables starting with <code>OVERLEAF_MONGO_</code>, <code>OVERLEAF_REDIS_</code> and the <code>REDIS_HOST</code> variable are no longer needed. MongoDB and Redis are now configured in the config/overleaf.rc file using  <code>MONGO_URL</code>, <code>REDIS_HOST</code> and <code>REDIS_PORT</code>.</li> </ul> <p>For advanced configuration options, refer to the config/overleaf.rc documentation.</p>"},{"location":"maintenance/docker-compose-to-toolkit-migration/#nginx-proxy","title":"NGINX Proxy","text":"<p>For instructions on how to migrate <code>nginx</code>, please see TLS Proxy.</p>"},{"location":"maintenance/docker-compose-to-toolkit-migration/#volumes","title":"Volumes","text":""},{"location":"maintenance/docker-compose-to-toolkit-migration/#sharelatex","title":"ShareLaTeX","text":"<p>The location of the data volume for the <code>sharelatex</code> container will need to be set using <code>OVERLEAF_DATA_PATH</code> in the config/overleaf.rc file.</p>"},{"location":"maintenance/docker-compose-to-toolkit-migration/#mongodb","title":"MongoDB","text":"<p>The location of the data volume for the <code>mongo</code> container will need to be set using <code>MONGO_DATA_PATH</code> in the config/overleaf.rc file.</p>"},{"location":"maintenance/docker-compose-to-toolkit-migration/#redis","title":"Redis","text":"<p>The location of the data volume for the <code>redis</code> container will need to be set using <code>REDIS_DATA_PATH</code> in the config/overleaf.rc file.</p>"},{"location":"maintenance/email-migration/","title":"Email migration","text":"<p>From a login perspective, the primary identifier for a user is their email address. If you are migrating from locally based authentication to SSO, you your are migrating from one IdP to another, you may be required to updated users email addresses.</p> <p>To help with this, a script is provided in Server Pro that will migrate user emails using a CSV file with the following format:</p> <p>oldEmail,newEmail</p> <p>The script will iterate through the CSV file and update the users's email addresses from oldEmail to newEmail, after performing some validation checks.</p>","tags":["Server Pro"]},{"location":"maintenance/email-migration/#validation","title":"Validation","text":"<p>Before running the migration the <code>&lt;csv_file&gt;</code> will be checked to ensure that:</p> <ul> <li>For each row, both the oldEmail and the newEmail are valid email addresses</li> <li>There are no duplicate entries, for example, you are not attempting to update different users to the same new email address or you are attempting to update the same user account with an already-used email address</li> </ul>","tags":["Server Pro"]},{"location":"maintenance/email-migration/#usage","title":"Usage","text":"<pre><code>docker cp &lt;csv_file&gt; sharelatex:/overleaf/services/web/&lt;csv_file&gt;\ndocker exec sharelatex /bin/bash -c \"cd /overleaf/services/web;node ./modules/server-ce-scripts/scripts/migrate-user-emails.js [--commit] [--continue|--ignore-missing] [--admin-id=ADMIN_USER_ID] &lt;csv_file&gt;\"\n</code></pre>","tags":["Server Pro"]},{"location":"maintenance/email-migration/#flags","title":"Flags","text":"Name Description <code>--commit</code> The inclusion of the <code>--commit</code> flag will actually do the migration. When omitted, the migration will happen in a dry-run mode where no changes are made but validation is still performed.  Default:<code>false</code> <code>--continue</code> The <code>--continue</code> flag will continue the migration process if a user account if the email address on the account has already been updated <code>--ignore-missing</code> The <code>--ignore-missing</code> flag will continue the migration process if a user account was not found <code>--admin-id</code> The <code>--admin-id</code> should be set to the ID of the Administrator who is performing the migration and will be used for audit log entries. Go to Admin &gt; Manage Users  and search for your email address and click on the first result to find your user-id. <code>&lt;csv_file&gt;</code> The <code>&lt;csv_file&gt;</code> is the file with the old and new email addresses in","tags":["Server Pro"]},{"location":"maintenance/email-migration/#completion","title":"Completion","text":"<p>While executing the migration script, depending on the flags that you have chosen will determine whether an error is logged to the console and then continues, or logged to the console and exits. If the script terminates prematurely due to an error, the script will exit with code 1 to denote that it was unsuccessful.</p> <p>On completion of the migration, the script will log the number of successful, failed and skipped updates to the console. If the migration is completed successfully it will exit with code 0.</p>","tags":["Server Pro"]},{"location":"maintenance/horizontal-scaling/","title":"Horizontal scaling","text":"<p>Starting with version 3.5.6 Server Pro supports horizontal scaling.</p> <p>This document lists the technical requirements and provides guidelines for running Server Pro in more than one node.</p> <p>Important</p> <p>Starting with Server CE/Server Pro <code>5.0.3</code> environment variables have been rebranded from <code>SHARELATEX_*</code> to <code>OVERLEAF_*</code>.</p> <p>If you're using a <code>4.x</code> version (or earlier) please make sure the variables are prefix accordingly (e.g. <code>SHARELATEX_SITE_URL</code> instead of <code>OVERLEAF_SITE_URL</code>)</p> <p>Setting up horizontal scaling requires a significant effort. We advise considering horizontal scaling only when reaching a certain scale.As an example, a Server Pro installation for 1,000 total users has been set up successfully using a single server provisioned with two 4-core processors and 32GB of system memory. See the hardware requirements documentation for recommendations.</p> <p>A deployment of Server Pro with horizontal scaling involves a set of external components, such as a Load Balancer and an S3-compatible backend.</p> <p>We can help troubleshoot errors in the Server Pro containers that might be the result of misconfiguration and provide general advice based on this document.</p> <p>Resolving technical issues specific to your hardware/software to provide the external components are not covered by our support terms.</p>","tags":["Server Pro"]},{"location":"maintenance/horizontal-scaling/#requirements","title":"Requirements","text":"","tags":["Server Pro"]},{"location":"maintenance/horizontal-scaling/#external-central-data-storage","title":"External, central data storage","text":"<p>The data storage in Server Pro can be split into four data stores:</p> <ul> <li> <p>MongoDB</p> <p>Most of the data is persisted into MongoDB.</p> <p>We support either a local instance or an external instance.</p> </li> <li> <p>Redis</p> <p>Redis stores temporary data, such as pending document updates before they are flushed to MongoDB.</p> <p>Redis is used for communicating document updates between different services and notifying the editor about state changes in a given project.</p> <p>Redis is used for storing the user sessions.</p> <p>We support either a local instance or an external instance.</p> </li> <li> <p>Project files and History files</p> <p>Non-editable project files are stored outside of MongoDB.</p> <p>The new project history system (Server Pro 3.5 onwards) stores the history outside MongoDB as well.</p> <p>For small single instances we support either a local file system (which could be backed by a local SSD, NFS or EBS) or a S3 compatible data storage system.</p> <p>For horizontal scaling, we only support S3 compatible data storage systems.</p> <p>NFS/Amazon EFS/Amazon EBS are not supported for horizontal scaling. Please see the wiki page on scaling storage in Server Pro for more details.</p> </li> <li> <p>Ephemeral files</p> <p>LaTeX compiles need to run on fast, local disks for optimal performance. The output of the compilation does not need to persisted or backed up.</p> <p>Buffering of new file uploads and the creation of project zip files also benefits from using a local disk.</p> <p>Warning</p> <p>We strongly advise on using a local disk. Using any kind of networked disk (such as NFS or EBS) can result in unexpected compile errors and other performance issues.</p> </li> <li> <p>Git-bridge</p> <p>Note</p> <p>Git-bridge is available in Server Pro starting with version 4.0.1.</p> <p>The git-repositories are stored locally on disk.There are no replication options available. Git-bridge should be run as a singleton. For optimal performance we advise on using a local disk for git-bridge data. The git-bridge data disk should be backed up regularly.</p> <p>For the data storage with horizontal scaling you need:</p> <ul> <li>a central MongoDB instance that is accessible from all Server Pro instances</li> <li>a central Redis instance that is accessible from all Server Pro instances</li> <li>a central S3 compatible backend for project and history files</li> <li>a local disk on each instance for ephemeral files</li> <li>a local disk on the instance that hosts the git-bridge container for git-bridge data</li> </ul> </li> </ul>","tags":["Server Pro"]},{"location":"maintenance/horizontal-scaling/#load-balancer-requirements","title":"Load balancer requirements","text":"<ul> <li> <p>Persistent routing, e.g. using a cookie</p> <p>This requirement stems from these components:</p> <ul> <li> <p>The real-time editing capability in Server Pro uses websockets with a fallback to polling. Each editing session has local state on the server side and the requests of a given editing session always need to be routed to the same Server Pro instance. The collaboration feature uses redis pub/sub for sharing updates between multiple Server Pro instances.</p> </li> <li> <p>The LaTeX compilation keeps the output and compile cache locally for optional performance. Upon issuing a compile request to one Server Pro instance, the following PDF/log download requests need to be routed to the same Server Pro instance.</p> </li> </ul> </li> <li> <p>Long request timeouts to support the compilation of large LaTeX documents</p> </li> <li> <p>Websocket support for optimal performance</p> </li> <li> <p>POST payload size of 50MB</p> </li> <li> <p>Keep-alive timeout must be lower than the Server Pro keep-alive timeout</p> <p>The keep-alive timeout in Server Pro can be configured using the environment variable <code>NGINX_KEEPALIVE_TIMEOUT</code>. The default value is 65s.</p> <p>With the default, a keep-alive timeout of 60s in the load balancer works.</p> <p>With <code>NGINX_KEEPALIVE_TIMEOUT=120</code>, the load balancer could pick 115s.</p> </li> <li> <p>Client IPs</p> <p>Set the request header <code>X-Forwarded-For</code> to the client IP.</p> </li> <li> <p>When terminating SSL</p> <p>The load balancer needs to add the request header <code>X-Forwarded-Proto: https</code>.</p> <p> Sample HAProxy configuration <p><pre><code>global\n  group haproxy\n  user haproxy\n\n  # Verbose logging\n  log stdout format raw local0 debug\n\ndefaults\n  mode                    http\n  option                  httpchk HEAD /status\n  http-check              expect status 200\n  default-server          check\n\n  # Verbose logging\n  log                     global\n  option                  httplog\n\n  # Reroute to a different backend if the sticky one is down\n  option                  redispatch 1\n  # These retries are for TCP connect errors, not on HTTP status 500 responses\n  retries                 3\n\n  # Sticky session for 24h of inactivity -- compile output is deleted after 24h\n  cookie                  server-pro-ha insert maxidle 24h\n\n  # Try to connect to any backend for 1min, then return 503\n  timeout queue           1m\n  # Give Server Pro instances 15s to startup\n  timeout connect         15s\n\n  # Abort requests from very slow clients (allow 1min of inactivity when reading a request)\n  timeout client          1m\n\n  # Allow slow compiles -- hard-coded limit in clsi is 10min\n  timeout server          10m\n\n  # Disconnect the editor after 23h -- 1h ahead of their last use yesterday\n  timeout tunnel          23h\n\n  # Note: The keepalive behavior in haproxy works great with the default keepalive setup in Server Pro.\n  # Haproxy is cleaning up connections in the background and it will redispatch requests when needed.\n\nlisten server-pro-ha-http\n  bind :80\n  http-request redirect scheme https unless { ssl_fc }\n\nlisten server-pro-ha-https\n  bind :443 ssl crt /etc/ssl/certs/ssl-key-and-certificate-bundle.pem\n\n  # Tell the application that we are behind https\n  http-request set-header X-Forwarded-Proto https\n\n  # Tell the application the actual client ip\n  option forwardfor\n\n  # See https://hstspreload.org/#deployment-recommendations\n  http-response set-header Strict-Transport-Security \"max-age=63072000; includeSubDomains; preload;\"\n\n  # Route git traffic to the sibling container of the git-bridge\n  use-server server-pro-ha-1 if { path_beg /git/ }\n\n  # Debugging\n  http-response add-header X-Served-By %s\n  stats enable\n  stats uri /haproxy\n\n  server server-pro-ha-1 198.18.1.1:80 cookie server-pro-ha-1\n  server server-pro-ha-2 198.18.1.2:80 cookie server-pro-ha-2\n  server server-pro-ha-3 198.18.1.3:80 cookie server-pro-ha-3\n</code></pre> </p>","tags":["Server Pro"]},{"location":"maintenance/horizontal-scaling/#server-pro-configuration","title":"Server Pro configuration","text":"<ul> <li> <p>Secrets</p> <p>The Server Pro instances need to agree on shared secrets:</p> <ul> <li><code>WEB_API_PASSWORD</code> (web api auth)</li> <li><code>STAGING_PASSWORD</code> and <code>V1_HISTORY_PASSWORD</code> same value (history auth)</li> <li><code>CRYPTO_RANDOM</code> (for session cookie)</li> <li><code>OT_JWT_AUTH_KEY</code> (history auth)</li> </ul> <p>All of these secrets need to be configured with their own unique value and shared between the instances.</p> <p>When not configured and user requests get routed to different Server Pro instances, their request will fail authentication checks and they either get redirect to the login page frequently or their actions in the UI will fail in unexpected ways.</p> <p>When not configured, Server Pro uses a new random value for each secret based on 32 random bytes from <code>/dev/urandom</code> (256 random bits).</p> <p><pre><code># https://github.com/overleaf/overleaf/blob/45ca0f796c679103efd305ddbef28073c4a5de32/server-ce/init_scripts/00_regen_sharelatex_secrets.sh#L14\ndd if=/dev/urandom bs=1 count=32 2&gt;/dev/null | base64 -w 0 | rev | cut -b 2- | rev | tr -d '\\n+/'\n</code></pre> </p> <li> <p>MongoDB</p> <p>Point <code>OVERLEAF_MONGO_URL</code> (<code>SHARELATEX_MONGO_URL</code> for versions <code>4.x</code> and earlier) at the central MongoDB instance.</p> </li> <li> <p>Redis</p> <p>Point <code>OVERLEAF_REDIS_HOST</code> (<code>SHARELATEX_REDIS_HOST</code> for versions <code>4.x</code> and earlier) and <code>REDIS_HOST</code> at the central redis instance.</p> </li> <li> <p>S3 compatible storage for project and history files</p> <p>Please see the documentation on S3 for details.</p> </li> <li> <p>Ephemeral files</p> <p>The default bind-mount of a local SSD to <code>/var/lib/overleaf</code> (<code>/var/lib/sharelatex</code> for versions <code>4.x</code> and earlier) will be sufficient. Be sure to point <code>SANDBOXED_COMPILES_HOST_DIR</code> at the mount point on the host.</p> <p>Warning</p> <p>We strongly advise on using a local disk. Using any kind of networked disk (such as NFS or EBS) can result in unexpected compile errors and other performance issues.</p> </li> <li> <p>Proxy configuration</p> </li> <li> <p>Set <code>OVERLEAF_BEHIND_PROXY=true</code> (<code>SHARELATEX_BEHIND_PROXY</code> for versions <code>4.x</code> and earlier) for accurate client IPs.</p> </li> <li> <p>Set <code>TRUSTED_PROXY_IPS</code> to the IP of the load balancer     (Multiple CIDRs can be specified, separated with a comma).</p> </li> <li> <p>Git-bridge integration</p> <p>Note</p> <p>Git-bridge is available in Server Pro starting with version 4.0.1.</p> <p>The git-bridge container needs a sibling Server Pro container for handling incoming git requests. This sibling container can serve regular user traffic as well.In the sample configuration, the first instance acts as sibling container for git-bridge, but any instance could function as that really.</p> <p>Why do we need to designate one Server Pro container as sibling for git-bridge? Server Pro hands out download URLs for the history service to git-bridge.  We need to configure these history URLs to be accessible from the git-bridge container.</p> <p>Server Pro container config:</p> <ul> <li>Set <code>GIT_BRIDGE_ENABLED</code> to <code>'true'</code></li> <li>Set <code>GIT_BRIDGE_HOST</code> to <code>&lt;git-bridge container name&gt;</code> e.g. <code>git-bridge</code></li> <li>Set <code>GIT_BRIDGE_PORT</code> to <code>8000</code></li> <li> <p>Set <code>V1_HISTORY_URL</code> to <code>http://&lt;server-pro sibling container name&gt;:3100/api</code>.</p> <p>Note: This is only necessary on the sibling container for the git-bridge container.       The other instances can use a localhost URL, which is the default.</p> </li> </ul> <p>Git-Bridge container config:</p> <ul> <li>Set <code>GIT_BRIDGE_API_BASE_URL</code> to <code>http://&lt;server-pro sibling container name&gt;/api/v0</code>, e.g. <code>http://server-pro-ha-1/api/v0</code></li> <li>Set <code>GIT_BRIDGE_OAUTH2_SERVER</code> to <code>http://&lt;server-pro sibling container name&gt;</code>, e.g. <code>http://server-pro-ha-1</code></li> <li>Set <code>GIT_BRIDGE_POSTBACK_BASE_URL</code> to <code>http://&lt;git-bridge container name&gt;:8000</code>, e.g. <code>http://git-bridge:8000</code></li> <li>Set <code>GIT_BRIDGE_ROOT_DIR</code> to the bind-mounted git-bridge data disk, e.g. <code>/data/git-bridge</code></li> </ul> <p> Sample docker-compose.yml configuration <p>Note: The following configuration is showing a self-contained setup.       For the demo to work, you need to provide a valid SSL key/certificate and adjust the <code>OVERLEAF_SITE_URL</code> (<code>SHARELATEX_SITE_URL</code> for versions <code>4.x</code> and earlier).       For an actual setup, you must replace the dummy secrets with actual secrets as noted inline.       For an actual setup, you need to move the individual containers onto dedicates nodes and adjust the IP addresses to your local network setup.</p> <p><pre><code>version: '2.2'\n\n# Actual horizontal scaling setup: pick your own network and replace IPs in config.\nnetworks:\n    default:\n        ipam:\n            config:\n                # This subnet is part of a reserved subnet used for benchmarking\n                # https://tools.ietf.org/html/rfc2544\n                # The full subnet is 198.18.0.0/15\n                # Use 198.18.0.0/24 for lb and dbs\n                # Use 198.18.1.0/24 for server-pro\n                # Use 198.18.0.128/25 for ephemeral container\n                - gateway: 198.18.0.1\n                  ip_range: 198.18.0.128/25\n                  subnet: 198.18.0.0/23\n\nservices:\n    # Actual horizontal scaling setup: run haproxy outside docker on a separate host.\n    lb:\n        image: haproxy:2.6\n        container_name: lb\n        user: root\n        logging:\n            driver: local\n            options:\n                max-size: 10g\n                max-file: '100'\n        volumes:\n            - ./haproxy.conf:/usr/local/etc/haproxy/haproxy.cfg\n            # $ cat certificate.pem key.pem &gt; ssl-key-and-certificate-bundle.pem\n            - /path/to/ssl-key-and-certificate-bundle.pem:/etc/ssl/certs/ssl-key-and-certificate-bundle.pem\n        # Alternative to \"ports\": use host network to avoid docker-proxy overhead\n        network_mode: host\n\n        # Alternative to \"network_mode: host\": use docker-proxy for network isolation\n        # ports:\n        #     - \"80:80\"\n        #     - \"443:443\"\n        # networks:\n        #     default:\n        #         ipv4_address: 198.18.0.2\n\n        # Actual horizontal scaling setup: remove these as they run on other hosts.\n        depends_on:\n            server-pro-ha-1:\n                condition: service_started\n            server-pro-ha-2:\n                condition: service_started\n            server-pro-ha-3:\n                condition: service_started\n\n    # Actual horizontal scaling setup: run this container next to server-pro-ha-1.\n    # For Server Pro 4.1 onwards.\n    git-bridge:\n        restart: always\n        # The tag should match the `server-pro-ha-1` container tag.\n        image: quay.io/sharelatex/git-bridge:4.0.1\n        volumes:\n            # Actual horizontal scaling setup: point /data/git-bridge at a dedicated local ssd.\n            - ~/git_bridge_data:/data/git-bridge\n        container_name: git-bridge\n        environment:\n            GIT_BRIDGE_API_BASE_URL: \"http://server-pro-ha-1/api/v0\"\n            GIT_BRIDGE_OAUTH2_SERVER: \"http://server-pro-ha-1\"\n            GIT_BRIDGE_POSTBACK_BASE_URL: \"http://git-bridge:8000\"\n            GIT_BRIDGE_ROOT_DIR: \"/data/git-bridge\"\n        user: root\n        command: [\"/server-pro-start.sh\"]\n        networks:\n            default:\n                ipv4_address: 198.18.0.6\n\n    # Actual horizontal scaling setup: run this container on a separate host.\n    server-pro-ha-1: &amp;server-pro-ha-config\n        restart: always\n        image: quay.io/sharelatex/sharelatex-pro:4.0.1\n        container_name: server-pro-ha-1\n        hostname: server-pro-ha-1\n        depends_on:\n            # Actual horizontal scaling setup: keep this entry.\n            git-bridge:\n                condition: service_started\n\n            # Actual horizontal scaling setup: remove the ones below as they run on other hosts.\n            mongo:\n                condition: service_healthy\n            redis:\n                condition: service_started\n            minio:\n                condition: service_started\n            mongo_replica_set_setup:\n                condition: service_completed_successfully\n            minio_setup:\n                condition: service_completed_successfully\n        stop_grace_period: 60s\n        volumes:\n            - /tmp/scratch-disk1:/var/lib/sharelatex\n            - /var/run/docker.sock:/var/run/docker.sock\n        environment: &amp;server-pro-ha-environment\n            # Actual horizontal scaling setup: provide your own domain/app name.\n            OVERLEAF_SITE_URL: 'https://overleaf.example.com'\n            OVERLEAF_APP_NAME: Server Pro Horizontal Scaling Demo\n\n            OVERLEAF_MONGO_URL: mongodb://198.18.0.3/sharelatex\n            OVERLEAF_REDIS_HOST: 198.18.0.4\n            REDIS_HOST: 198.18.0.4\n\n            ENABLED_LINKED_FILE_TYPES: 'project_file,project_output_file'\n            EMAIL_CONFIRMATION_DISABLED: 'true'\n\n            SANDBOXED_COMPILES: 'true'\n            SANDBOXED_COMPILES_SIBLING_CONTAINERS: 'true'\n            SANDBOXED_COMPILES_HOST_DIR: '/tmp/scratch-disk1/data/compiles'\n\n            # S3\n            # Actual horizontal scaling setup: pick secure credentials.\n            OVERLEAF_FILESTORE_BACKEND: s3\n            OVERLEAF_FILESTORE_USER_FILES_BUCKET_NAME: overleaf-user-files\n            OVERLEAF_FILESTORE_TEMPLATE_FILES_BUCKET_NAME: overleaf-template-files\n            OVERLEAF_FILESTORE_S3_ACCESS_KEY_ID: OVERLEAF_FILESTORE_S3_ACCESS_KEY_ID\n            OVERLEAF_FILESTORE_S3_SECRET_ACCESS_KEY: OVERLEAF_FILESTORE_S3_SECRET_ACCESS_KEY\n            OVERLEAF_FILESTORE_S3_ENDPOINT: http://198.18.0.5:9000\n            OVERLEAF_FILESTORE_S3_PATH_STYLE: 'true'\n            OVERLEAF_FILESTORE_S3_REGION: ''\n\n            OVERLEAF_HISTORY_BACKEND: \"s3\"\n            OVERLEAF_HISTORY_PROJECT_BLOBS_BUCKET: \"overleaf-project-blobs\"\n            OVERLEAF_HISTORY_CHUNKS_BUCKET: \"overleaf-chunks\"\n            OVERLEAF_HISTORY_S3_ACCESS_KEY_ID: \"OVERLEAF_HISTORY_S3_ACCESS_KEY_ID\"\n            OVERLEAF_HISTORY_S3_SECRET_ACCESS_KEY: \"OVERLEAF_HISTORY_S3_SECRET_ACCESS_KEY\"\n            OVERLEAF_HISTORY_S3_ENDPOINT: http://198.18.0.5:9000\n            OVERLEAF_HISTORY_S3_PATH_STYLE: 'true'\n            OVERLEAF_HISTORY_S3_REGION: ''\n            # /S3\n\n            # git-bridge\n            GIT_BRIDGE_ENABLED: 'true'\n            GIT_BRIDGE_HOST: git-bridge\n            GIT_BRIDGE_PORT: 8000\n            # Only needed on the sibling instance of git-bridge\n            V1_HISTORY_URL: \"http://server-pro-ha-1:3100/api\"\n            # /git-bridge\n\n            # Horizontal scaling\n            # Actual horizontal scaling setup: pick secure credentials.\n            WEB_API_PASSWORD: WEB_API_PASSWORD\n            STAGING_PASSWORD: V1_HISTORY_PASSWORD\n            V1_HISTORY_PASSWORD: V1_HISTORY_PASSWORD\n            CRYPTO_RANDOM: CRYPTO_RANDOM\n            OT_JWT_AUTH_KEY: OT_JWT_AUTH_KEY\n            OVERLEAF_BEHIND_PROXY: 'true'\n            # Actual horizontal scaling setup: IPs of load balancers\n            TRUSTED_PROXY_IPS: 198.18.0.1,198.18.0.2\n            # /Horizontal scaling\n\n        # Actual horizontal scaling setup: run on host 198.18.1.1 and expose ports\n        # ports:\n        #     - \"80:80\"\n        networks:\n            default:\n                ipv4_address: 198.18.1.1\n\n    # Actual horizontal scaling setup: run this container on a separate host.\n    server-pro-ha-2:\n        &lt;&lt;: *server-pro-ha-config\n        hostname: server-pro-ha-2\n        container_name: server-pro-ha-2\n        volumes:\n            - /tmp/scratch-disk2:/var/lib/sharelatex\n            - /var/run/docker.sock:/var/run/docker.sock\n        environment:\n            &lt;&lt;: *server-pro-ha-environment\n            SANDBOXED_COMPILES_HOST_DIR: '/tmp/scratch-disk2/data/compiles'\n            V1_HISTORY_URL: \"http://localhost:3100/api\"\n\n        # Actual horizontal scaling setup: run on host 198.18.1.2 and expose ports\n        # ports:\n        #     - \"80:80\"\n        networks:\n            default:\n                ipv4_address: 198.18.1.2\n\n    # Actual horizontal scaling setup: run this container on a separate host.\n    server-pro-ha-3:\n        &lt;&lt;: *server-pro-ha-config\n        hostname: server-pro-ha-3\n        container_name: server-pro-ha-3\n        volumes:\n            - /tmp/scratch-disk3:/var/lib/sharelatex\n            - /var/run/docker.sock:/var/run/docker.sock\n        environment:\n            &lt;&lt;: *server-pro-ha-environment\n            SANDBOXED_COMPILES_HOST_DIR: '/tmp/scratch-disk3/data/compiles'\n            V1_HISTORY_URL: \"http://localhost:3100/api\"\n\n        # Actual horizontal scaling setup: run on host 198.18.1.3 and expose ports\n        # ports:\n        #     - \"80:80\"\n        networks:\n            default:\n                ipv4_address: 198.18.1.3\n\n    # Actual horizontal scaling setup: run this container on a separate host.\n    minio:\n        image: minio/minio:RELEASE.2023-05-18T00-05-36Z\n        container_name: minio\n        command: server /data\n        volumes:\n            # Actual horizontal scaling setup: run minio with multiple disks, see minio docs.\n            - ~/minio_data:/data\n        environment:\n            # Actual horizontal scaling setup: pick secure credentials.\n            MINIO_ROOT_USER: MINIO_ROOT_USER\n            MINIO_ROOT_PASSWORD: MINIO_ROOT_PASSWORD\n\n        # Actual horizontal scaling setup: run on host 198.18.0.5 and expose port\n        # ports:\n        #     - \"9000:9000\"\n        networks:\n            default:\n                ipv4_address: 198.18.0.5\n\n    # Actual horizontal scaling setup: run this setup once on a separate host.\n    minio_setup:\n        depends_on:\n            - minio\n        image: minio/mc:RELEASE.2023-05-18T16-59-00Z\n        entrypoint: sh\n        command:\n            - '-c'\n            # Actual horizontal scaling setup: pick secure credentials.\n            - |\n                mc alias set s3 http://198.18.0.5:9000 MINIO_ROOT_USER MINIO_ROOT_PASSWORD \\\n                || sleep 10 &amp;&amp; \\\n                mc alias set s3 http://198.18.0.5:9000 MINIO_ROOT_USER MINIO_ROOT_PASSWORD \\\n                || sleep 10 &amp;&amp; \\\n                mc alias set s3 http://198.18.0.5:9000 MINIO_ROOT_USER MINIO_ROOT_PASSWORD \\\n                || sleep 10 &amp;&amp; \\\n                mc alias set s3 http://198.18.0.5:9000 MINIO_ROOT_USER MINIO_ROOT_PASSWORD\n\n                mc mb --ignore-existing s3/overleaf-user-files\n                mc mb --ignore-existing s3/overleaf-template-files\n                mc admin user add s3 \\\n                  OVERLEAF_FILESTORE_S3_ACCESS_KEY_ID \\\n                  OVERLEAF_FILESTORE_S3_SECRET_ACCESS_KEY\n\n                mc mb --ignore-existing s3/overleaf-project-blobs\n                mc mb --ignore-existing s3/overleaf-chunks\n                mc admin user add s3 \\\n                  OVERLEAF_HISTORY_S3_ACCESS_KEY_ID \\\n                  OVERLEAF_HISTORY_S3_SECRET_ACCESS_KEY\n\n                echo '\n                  {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                      {\n                        \"Effect\": \"Allow\",\n                        \"Action\": [\n                          \"s3:ListBucket\"\n                        ],\n                        \"Resource\": \"arn:aws:s3:::overleaf-user-files\"\n                      },\n                      {\n                        \"Effect\": \"Allow\",\n                        \"Action\": [\n                          \"s3:PutObject\",\n                          \"s3:GetObject\",\n                          \"s3:DeleteObject\"\n                        ],\n                        \"Resource\": \"arn:aws:s3:::overleaf-user-files/*\"\n                      },\n                      {\n                        \"Effect\": \"Allow\",\n                        \"Action\": [\n                          \"s3:ListBucket\"\n                        ],\n                        \"Resource\": \"arn:aws:s3:::overleaf-template-files\"\n                      },\n                      {\n                        \"Effect\": \"Allow\",\n                        \"Action\": [\n                          \"s3:PutObject\",\n                          \"s3:GetObject\",\n                          \"s3:DeleteObject\"\n                        ],\n                        \"Resource\": \"arn:aws:s3:::overleaf-template-files/*\"\n                      }\n                    ]\n                  }' &gt; policy-filestore.json\n\n                echo '\n                  {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                      {\n                        \"Effect\": \"Allow\",\n                        \"Action\": [\n                          \"s3:ListBucket\"\n                        ],\n                        \"Resource\": \"arn:aws:s3:::overleaf-project-blobs\"\n                      },\n                      {\n                        \"Effect\": \"Allow\",\n                        \"Action\": [\n                          \"s3:PutObject\",\n                          \"s3:GetObject\",\n                          \"s3:DeleteObject\"\n                        ],\n                        \"Resource\": \"arn:aws:s3:::overleaf-project-blobs/*\"\n                      },\n                      {\n                        \"Effect\": \"Allow\",\n                        \"Action\": [\n                          \"s3:ListBucket\"\n                        ],\n                        \"Resource\": \"arn:aws:s3:::overleaf-chunks\"\n                      },\n                      {\n                        \"Effect\": \"Allow\",\n                        \"Action\": [\n                          \"s3:PutObject\",\n                          \"s3:GetObject\",\n                          \"s3:DeleteObject\"\n                        ],\n                        \"Resource\": \"arn:aws:s3:::overleaf-chunks/*\"\n                      }\n                    ]\n                  }' &gt; policy-history.json\n\n                # Put the contents of the policy from the previous section in policy-filestore.json\n                # Reminder: Replace the bucket names accordingly.\n                mc admin policy create s3 overleaf-filestore policy-filestore.json\n                mc admin policy attach s3 overleaf-filestore \\\n                  --user=OVERLEAF_FILESTORE_S3_ACCESS_KEY_ID || true\n\n                mc admin policy create s3 overleaf-history policy-history.json\n                mc admin policy attach s3 overleaf-history \\\n                  --user=OVERLEAF_HISTORY_S3_ACCESS_KEY_ID || true\n\n    # Actual horizontal scaling setup: run this container on a separate host.\n    mongo:\n        restart: always\n        image: mongo:4.4\n        container_name: mongo\n        command: \"--replSet overleaf\"\n        expose:\n            - 27017\n        volumes:\n            - ~/mongo_data:/data/db\n        healthcheck:\n            test: echo 'db.stats().ok' | mongo localhost:27017/test --quiet\n            interval: 10s\n            timeout: 10s\n            retries: 5\n\n        # Actual horizontal scaling setup: run on host 198.18.0.3 and expose port\n        # ports:\n        #     - \"27017:27017\"\n        networks:\n            default:\n                ipv4_address: 198.18.0.3\n\n    mongo_replica_set_setup:\n        image: mongo:4.4\n        entrypoint: sh\n        depends_on:\n            mongo:\n                condition: service_healthy\n        command:\n            - '-c'\n            - |\n                mongo 198.18.0.3 --eval \"rs.initiate({ _id: \\\"overleaf\\\", members: [ { _id: 0, host: \\\"198.18.0.3:27017\\\" } ] })\"\n\n    # Actual horizontal scaling setup: run this container on a separate host.\n    redis:\n        restart: always\n        image: redis:6.2\n        container_name: redis\n        expose:\n            - 6379\n        volumes:\n            - ~/redis_data:/data\n\n        # Actual horizontal scaling setup: run on host 198.18.0.4 and expose port\n        # ports:\n        #     - \"6379:6379\"\n        networks:\n            default:\n                ipv4_address: 198.18.0.4\n</code></pre> </p>","tags":["Server Pro"]},{"location":"maintenance/horizontal-scaling/#hardware","title":"Hardware","text":"<p>We recommend using the same hardware specifications for all the Server Pro instances that are taking part in horizontal scaling.</p> <p>The general recommendations on hardware specifications for Server Pro instances apply.</p>","tags":["Server Pro"]},{"location":"maintenance/horizontal-scaling/#upgrading-server-pro","title":"Upgrading Server Pro","text":"<p>As part of the upgrade process, Server Pro is automatically running database migrations.These migrations are not designed to be run from multiple instances in parallel.</p> <p>The migrations need to finish before the actual web application is started. You can either check the logs for an entry of <code>Finished migrations</code> or wait until the application accepts traffic.</p> <p>The upgrade procedure looks like this:</p> <ol> <li>Schedule a maintenance window</li> <li>Stop all the instances of Server Pro</li> <li>Take a consistent backup as described in the documentation</li> <li>Start a single instance of Server Pro with the new version</li> <li>Validate that the new instance is working as expected</li> <li>Bring up the other instances with the new version</li> </ol>","tags":["Server Pro"]},{"location":"maintenance/s3-migration/","title":"S3 migration","text":"<p>Note</p> <p>These instructions are for v5.x and later. If you are following this guide for an earlier version please use <code>sharelatex</code> instead of <code>overleaf</code> in path names and <code>SHARELATEX_</code> prefix instead of <code>OVERLEAF_</code> for environment variables.</p> <p>This guide will walk you through the migration from on-disk storage to an S3 compatible object storage.</p> <p>This document refers to sections of the introduction document on the S3 Setup.</p> <p>We'd ove to hear from you</p> <p>If you'd like to share with us how many files you migrated over, their overall volume and how long the migration took - we've love to hear from you. Please drop us a message at <code>support@overleaf.com</code> .</p>"},{"location":"maintenance/s3-migration/#requirements","title":"Requirements","text":"<ul> <li>A S3 compatible object storage to talk to, see \"S3 Setup\" for options</li> <li>Free disk space for migrating existing data, about the current on disk size</li> <li>A maintenance window for doing the actual migration</li> <li>A full backup, including the config, to enable restoring from it</li> </ul>"},{"location":"maintenance/s3-migration/#estimate-the-disk-size-needed-for-the-migration","title":"Estimate the disk size needed for the migration","text":"<p>We can use <code>du(1)</code> for calculating the current disk usage: <pre><code>docker exec sharelatex \\\n  du --human-readable --max-depth=0 /var/lib/overleaf/data/user_files\n\ndocker exec sharelatex \\\n  du --human-readable --max-depth=0 /var/lib/overleaf/data/template_files\n</code></pre></p> <p>In case you do not have sufficient disk space available on the current server, try attaching another disk to the server.</p> <p>Note</p> <p>The history directories already have the correct layout. You can upload directly from the bind-mounted source folder, which does not require any additional disk space.</p>"},{"location":"maintenance/s3-migration/#migration-steps","title":"Migration steps","text":""},{"location":"maintenance/s3-migration/#step-0-shutdown-the-instance","title":"Step 0 shutdown the instance","text":"<p>We need to make sure that all user/template files will get migrated. It is best to shut down the instance to avoid missing newly uploaded files.</p> <p>Please see our guide on performing a consistent a backup for the shutdown procedure.</p>"},{"location":"maintenance/s3-migration/#step-1-rewrite-directory-layout","title":"Step 1 rewrite directory layout","text":"<p>We need to rewrite the directory layout of project files for uploading them to S3.The directory layout for local storage in filestore is <code>&lt;project-id&gt;_&lt;file-id&gt;</code> and the directory layout in S3 is <code>&lt;project-id&gt;/&lt;file-id&gt;</code>.</p> <p>In the following, <code>/srv/overleaf-s3-migration</code> is used for storing the files in the new directory layout.</p> <p>We can make use of <code>tar(1)</code> for rewriting the layout:</p> <pre><code>mkdir -p /srv/overleaf-s3-migration/user_files \\\n         /srv/overleaf-s3-migration/template_files\ndocker exec sharelatex \\\n  tar --create --directory /var/lib/overleaf/data/user_files . \\\n| tar --extract --directory /srv/overleaf-s3-migration/user_files \\\n  --transform=sx_x/x\ndocker exec sharelatex \\\n  tar --create --directory /var/lib/overleaf/data/template_files . \\\n| tar --extract --directory /srv/overleaf-s3-migration/template_files \\\n  --transform=sx_x/xg\n</code></pre>"},{"location":"maintenance/s3-migration/#step-2-upload-the-files","title":"Step 2 upload the files","text":"<p>Depending on your preference, you can use the minio mc S3 client or the aws cli for uploading the files to your S3 compatible object storage.</p>"},{"location":"maintenance/s3-migration/#aws-cli","title":"aws cli","text":"<p>Note</p> <p>Here you should replace <code>overleaf-user-files</code>, <code>overleaf-template-files</code>, <code>overleaf-project-blobs</code> and <code>overleaf-chunks</code> with the names of your S3 buckets.</p> <p>Note</p> <p>Also replace <code>/srv/overleaf-bind-mount</code> with the local path of the <code>/var/lib/overleaf</code> bind-mount. By default, this is <code>~/overleaf_data</code> in a docker-compose.yml deployment and <code>&lt;toolkit-checkout&gt;/data/overleaf</code> when using the Toolkit.</p> <pre><code>aws s3 sync /srv/overleaf-s3-migration/user_files s3://overleaf-user-files\naws s3 sync /srv/overleaf-s3-migration/template_files s3://overleaf-template-files\n\naws s3 sync /srv/overleaf-bind-mount/data/history/overleaf-project-blobs s3://overleaf-project-blobs\naws s3 sync /srv/overleaf-bind-mount/data/history/overleaf-chunks s3://overleaf-chunks\n</code></pre>"},{"location":"maintenance/s3-migration/#minio-mc","title":"minio mc","text":"<p>We are using the server alias \"s3\" here, you may have picked another name.</p> <pre><code>mc mirror /srv/overleaf-s3-migration/user_files s3/overleaf-user-files\nmc mirror /srv/overleaf-s3-migration/template_files s3/overleaf-template-files\n\nmc mirror /srv/overleaf-bind-mount/data/history/overleaf-project-blobs s3/overleaf-project-blobs\nmc mirror /srv/overleaf-bind-mount/data/history/overleaf-chunks s3/overleaf-chunks\n</code></pre>"},{"location":"maintenance/s3-migration/#step-3-start-the-instance-pointing-at-s3","title":"Step 3 start the instance pointing at S3","text":"<p>Add all the S3 related variables to your config, as detailed in the \"S3 Setup -&gt; Overview of variables\" section.</p> <p>For Docker Compose deployments, you can also remove the bind-mount for the data dir from the volumes section.</p> <p>Note</p> <p>Please keep the bind-mount of a scratch disk for ephemeral files in place.</p> <p>You can now start the instance and validate the migration: - can preview binary files in the editor - can compile a PDF with images - can upload new files</p>"},{"location":"maintenance/s3-migration/#rolling-back","title":"Rolling back","text":"<p>You can roll back the migration gracefully in reversing the steps:</p> <ol> <li>shutdown the instance</li> <li>mirror back the files by flipping the sequence of source/destination</li> <li>write new files back into the local directory using an inverse <code>transform</code></li> <li>restart the instance with the old configuration</li> </ol> <pre><code># When using aws cli\naws s3 sync s3://overleaf-user-files /srv/overleaf-s3-migration/user_files\naws s3 sync s3://overleaf-template-files /srv/overleaf-s3-migration/template_files\naws s3 sync s3://overleaf-project-blobs /srv/overleaf-bind-mount/data/history/overleaf-project-blobs\naws s3 sync s3://overleaf-chunks /srv/overleaf-bind-mount/data/history/overleaf-chunks\n\n# When using minio mc\nmc mirror s3/overleaf-user-files /srv/overleaf-s3-migration/user_files\nmc mirror s3/overleaf-template-files /srv/overleaf-s3-migration/template_files\nmc mirror s3/overleaf-project-blobs /srv/overleaf-bind-mount/data/history/overleaf-project-blobs\nmc mirror s3/overleaf-chunks /srv/overleaf-bind-mount/data/history/overleaf-chunks\n</code></pre> <pre><code># Write files into local Server CE/Server Pro\ntar --create --directory /srv/overleaf-s3-migration/user_files . \\\n| docker exec --interactive sharelatex \\\n    tar \\\n      --extract \\\n      --keep-old-files \\\n      --directory /var/lib/overleaf/data/user_files \\\n      --transform=sx./xx --transform=sx/x_x \\\n      --wildcards '*/*/*'\n\ntar --create --directory /srv/overleaf-s3-migration/template_files . \\\n| docker exec --interactive sharelatex \\\n    tar \\\n      --extract \\\n      --keep-old-files \\\n      --directory /var/lib/overleaf/data/template_files \\\n      --transform=sx./xx --transform=sx/x_xg \\\n      --wildcards '*/*/*/*/pdf-converted-cache/*' \\\n      --wildcards '*/*/*/*/pdf' \\\n      --wildcards '*/*/*/*/zip'\n</code></pre> <p>Note</p> <p>The first transform removes the top level folder. The 2nd transform changes the directory layout to a flat one. The wildcards ensure that only files are extracted, not their parent (project) folders.</p>"},{"location":"maintenance/updating-mongodb/","title":"Updating MongoDB","text":"<p>From version <code>2.0.0</code> until <code>2.4.2</code> we haven't been too specific about which version of MongoDB should be used with Overleaf Community Edition and Server Pro, with the exception for the minimum supported version specified in supported dependencies list. </p> <p>Starting on <code>2.5.0</code>, any new release will indicate any change on the supported version of MongoDB in its release notes.</p> <p>Similarly, the version of <code>mongo</code> docker image in <code>docker-compose.yml</code> has been historically untagged. Starting on Server CE/Server Pro <code>2.5.0</code>, the tag will be updated to the version supported by the latest release of Server CE/Server Pro.</p>"},{"location":"maintenance/updating-mongodb/#should-i-update-mongodb","title":"Should I update MongoDB?","text":"<p>You should only consider updating your MongoDB version if you're planning to upgrade your instance of Server CE/Server Pro. </p> <p>If you're running a MongoDB version that is newer than the recommended for your current (or target) version (e.g, Server CE/Server Pro 2.4.0 along with Mongo 4.2) there's no need to make any changes. You should never downgrade your MongoDB version.</p> <p>If you experience a specific problem that you think might be related to your current version of MongoDB, feel free to raise an issue if you are a Server CE user or contact Overleaf Support if you are Server Pro a user.</p>"},{"location":"maintenance/updating-mongodb/#checking-your-mongo-version","title":"Checking your Mongo version","text":"<p>Opening the <code>mongo</code> shell should immediately print the current version.</p> <p>Toolkit users: <pre><code>\u27a4 bin/docker-compose exec mongo mongo -version\nMongoDB shell version v4.4.1\n</code></pre></p> <p>Docker Compose users: <pre><code>\u27a4 docker compose exec mongo mongo -version\nMongoDB shell version v4.4.1\n</code></pre></p>"},{"location":"maintenance/updating-mongodb/#update-process","title":"Update process","text":"<p>Updating the version of MongoDB during an upgrade of your Server CE/Server Pro instance is as follows:</p> <ol> <li>Decide the version of Server CE/Server Pro you plan to upgrade to.</li> <li>Find the version of MongoDB recommended by that specific Overleaf Server CE/Server Pro release.</li> <li>Follow the instructions to upgrade MongoDB to the target version.</li> <li>Upgrade Server CE/Server Pro image version and restart the instance.</li> </ol> <p>Our recommendation is to always upgrade Server CE/Server Pro to the latest version available, since it's always guaranteed to be supported (Server Pro users only). In case you decide to go to an earlier version, this table shows the recommended version of MongoDB for earlier releases of Server CE/Server Pro, but you should never downgrade your MongoDB version.</p> Server CE/Server Pro Version MongoDB Version 2.0.x 3.4 2.1.x  to 2.4.x 3.6 &gt;=2.5.0 4.0 &gt;=3.1.0 4.2 &gt;=3.2.0 4.4 &gt;4.2.0 5.0"},{"location":"maintenance/updating-mongodb/#upgrading-mongodb","title":"Upgrading MongoDB","text":"<p>MongoDB requires step-by-step upgrades. That means you can't go straight from, let's say <code>4.0</code> to <code>5.0</code>. You need first to update <code>4.2</code> to <code>4.4</code>, and then <code>5.0</code>.</p> <p>Tip</p> <p>MongoDB uses even numbers for their stable versions.</p> <p>Update instructions when running mongo outside docker</p> <ul> <li>From <code>3.2</code> to <code>3.4</code></li> <li>From <code>3.4</code> to <code>3.6</code></li> <li>From <code>3.6</code> to <code>4.0</code></li> <li>From <code>4.0</code> to <code>4.2</code></li> <li>From <code>4.2</code> to <code>4.4</code></li> <li>From <code>4.4</code> to <code>5.0</code></li> </ul> <p>Note that the instructions for <code>5.0</code> point to a replica set install, instead of standalone. MongoDB needs to be run as a replica set since Server Pro 4.0.1.</p> <p>Docker users - Update the version of the <code>mongo</code> image (docker-compose setup: edit <code>services -&gt; mongo -&gt; image</code>; Toolkit setup: update <code>MONGO_IMAGE</code>, e.g. <code>MONGO_IMAGE=mongo:5.0</code>)</p> <p>In most cases the update just requires setting up a compatibility setting before actually updating the version. Let's see an example.</p>"},{"location":"maintenance/updating-mongodb/#example-upgrading-mongodb-from-44-to-50","title":"Example: Upgrading MongoDB from <code>4.4</code> to <code>5.0</code>","text":"<p>Let's start by making sure we're running MongoDB <code>4.4</code>: </p> <p>Toolkit users: <pre><code>\u27a4 bin/docker-compose exec mongo mongo -version\nMongoDB shell version v3.4.24\n</code></pre></p> <p>Docker Compose users: <pre><code>\u27a4 docker compose exec mongo mongo -version\nMongoDB shell version v3.4.24\n</code></pre></p> <p>According to the upgrade instructions, the only requirement is to have <code>featureCompatibilityVersion</code> set to <code>4.4</code>. We do so by opening a mongo shell and running the indicated command:</p> <p>Toolkit users: <pre><code>\u27a4 bin/docker-compose exec mongo mongo\nMongoDB shell version v3.4.24\n...\n&gt; db.adminCommand( { setFeatureCompatibilityVersion: \"4.4\" } )\n{ \"ok\" : 1 }\n&gt; exit\nbye\n</code></pre></p> <p>Docker Compose users: <pre><code>\u27a4 docker-compose exec mongo mongo\nMongoDB shell version v3.4.24\nconnecting to: mongodb://127.0.0.1:27017\nMongoDB server version: 3.4.24\nWelcome to the MongoDB shell.\nFor interactive help, type \"help\".\n&gt; db.adminCommand( { setFeatureCompatibilityVersion: \"4.4\" } )\n{ \"ok\" : 1 }\n&gt; exit\nbye\n</code></pre></p> <p>Toolkit users:</p> <p>We'll then stop Server CE/Server Pro and MongoDB instances using the <code>bin/stop</code> command, set <code>MONGO_IMAGE=5.0</code> in <code>config/overleaf.rc</code>, and then restart the <code>mongo</code> service using <code>bin/up mongo</code>) to verify the update went smoothly.</p> <p>Finally, we'll update the Server CE/Server Pro image version to our target version and restart all the services using the <code>bin/up -d</code> command.</p> <p>Docker Compose:</p> <p>We'll then stop Server CE/Server Pro and MongoDB instances using the <code>docker compose down</code> command, update <code>docker-compose.yml</code> file to use <code>image: mongo:5.0</code>, and then restart the <code>mongo</code> service using the <code>docker compose up mongo</code> command to verify the update went smoothly.</p> <p>Finally, we'll update Server CE/Server Pro image version to our target version and restart all the services using the <code>docker compose up</code> command.</p>"},{"location":"release-notes/Release-Notes---0.1.2/","title":"0.1.2","text":"<p>The most significant change in this update is the inclusion of a new real-time service which handles the editor websocket connections. These were previously handled by the web service. If you are upgrading from a previous version of ShareLaTeX, there are some things you may need to update to get it all working:</p>"},{"location":"release-notes/Release-Notes---0.1.2/#installing-the-real-time-service","title":"Installing the real-time service","text":"<p>First make sure you actually have the real-time service installed:</p> <pre><code>$ grunt install:real-time\n</code></pre>"},{"location":"release-notes/Release-Notes---0.1.2/#websocketsurl","title":"websocketsUrl","text":"<p>You should add a new line to your config file to include the new <code>websocketsUrl</code> parameter:</p> <pre><code># settings.coffee\nmodules.exports =\n    ...\n    siteUrl: \"http://sharelatex.example.com\"\n    websocketsUrl: \"http://sharelatex.example.com\"\n    ...\n</code></pre> <p>This should be the same as your <code>siteUrl</code>.</p>"},{"location":"release-notes/Release-Notes---0.1.2/#reverse-proxy-settings","title":"Reverse proxy settings","text":"<p>In development the editor connects to the real-time service at http://localhost:3026, a separate end point from the web service, hence the need for a configurable parameter. In production you likely have a reverse proxy set up, and need to forward any requests to /socket.io onto the real-time service rather than the web service.</p> <p>See the [[Nginx as a Reverse Proxy]] page for an Nginx example, particularly the <code>location /socket.io</code> block.</p>"},{"location":"release-notes/Release-Notes---0.1.3-and-0.1.4/","title":"0.1.3 and 0.1.4","text":"<p>0.1.3 was mostly bug fixes. The notable thing for users running upgrading from old versions in 0.1.4 is user management, and the addition and removal of some settings parameters:</p>"},{"location":"release-notes/Release-Notes---0.1.3-and-0.1.4/#user-management","title":"User Management","text":"<p>Public registration is now removed in the open source version. It is a significant security risk to allow public access to a LaTeX installation on your server, and most users have request some for of private user management. See [[Creating and managing users]] for an overview of how it now works.</p>"},{"location":"release-notes/Release-Notes---0.1.3-and-0.1.4/#added-settings","title":"Added settings","text":"<ul> <li><code>appName</code> - This should be set to the name of your ShareLaTeX install. E.g. \"Acme Inc's ShareLaTeX Server\".</li> <li><code>adminEmail</code> - The contact email address of whoever is responsible for running the server.</li> </ul>"},{"location":"release-notes/Release-Notes---0.1.3-and-0.1.4/#deprecated-settings","title":"Deprecated settings","text":"<ul> <li><code>websocketsUrl</code> - This was the source of most problems with 0.1.2 and 0.1.3 so has been removed. The web service now proxies to the real-time service so the client does not need to know where to find it.</li> </ul>"},{"location":"release-notes/Release-Notes---0.2.0/","title":"0.2.0","text":"<ul> <li>Documents are now stored in their own collection, making projects thiner</li> <li>Word count</li> <li>lots of stability work including:</li> <li>Better handling of poor connections over websockets</li> <li>Seperation of web and api routes</li> </ul>"},{"location":"release-notes/Release-Notes---0.3.0/","title":"0.3.0","text":"<ul> <li>All configuration of ShareLaTeX is now done via Environmental variables.</li> <li>Much better LaTeX error parsing, include errors in .bbl files</li> <li>Snappier feedback when changing image</li> <li>Tags/folders can be deleted and renamed via side menu</li> <li>Clone and zip uploads speed improvement</li> <li>User is warned about overwriting files</li> <li>Synctex is more acurate. </li> <li>Prevention against massive projects effecting system</li> <li>Multiple small bug fixes</li> </ul>"},{"location":"release-notes/Release-Notes---0.4.0/","title":"0.4.0","text":""},{"location":"release-notes/Release-Notes---0.4.0/#this-has-not-been-released-yet","title":"This has not been released yet","text":"<ul> <li>Auto complete of share project popup</li> <li>Warning about broken latex pre compile in the editor (missing bracket etc)</li> <li>Bibliography reference popups</li> <li>Concurent compiles of the same project by different users</li> <li>New invite system making it easier for users to have project shared with their non ShareLaTeX email address</li> <li>Snappier loading of PDF pages</li> <li>Error logs have human readable tips on what is wrong</li> <li>Stop button when compiling pdfs</li> <li>New texlive 2016 image for sandboxed compiles</li> <li>User management scripts have been moved to user:create-admin rather than the old create-admin-user</li> <li>Improved sandboxing of processes</li> </ul>"},{"location":"release-notes/Release-Notes---0.5.0/","title":"0.5.0","text":""},{"location":"release-notes/Release-Notes---0.5.0/#050","title":"0.5.0","text":"<ul> <li>Code Check mode, shows tex errors in the editor</li> <li>Improved support for plain-text emails</li> <li>Show the current user email in the \"Account\" dropdown</li> <li>Improved project search</li> <li>Better cookie expiry behaviour</li> <li>Improved spell-check underline effect</li> <li>Old user accounts are automatically upgraded to modern feature set</li> </ul>"},{"location":"release-notes/Release-Notes---0.5.0/#server-pro-050","title":"Server Pro 0.5.0","text":"<ul> <li>New SAML integration option, link ShareLaTeX to SAML/Shibboleth/etc.</li> <li>Improved LDAP integration, no configuration changes required</li> <li>Option to have user details updated on every login (LDAP and SAML) SHARELATEX_LDAP_UPDATE_USER_DETAILS_ON_LOGIN</li> </ul>"},{"location":"release-notes/Release-Notes---0.5.0/#server-pro-052","title":"Server Pro 0.5.2","text":"<ul> <li>Correct an issue with LDAP configuration, requiring upgrade to a new configuration format.</li> <li>Add an option to restrict project invites to existing user accounts</li> </ul>"},{"location":"release-notes/Release-Notes---0.5.0/#server-pro-053","title":"Server Pro 0.5.3","text":"<ul> <li>Fix a bug where the <code>/register</code> link in nav-bar was not being hidden when using an external auth source.</li> </ul>"},{"location":"release-notes/Release-Notes---0.5.0/#server-pro-054","title":"Server Pro 0.5.4","text":"<ul> <li>Fix an issue with SHARELATEX_HEADER_NAV_LINKS option</li> </ul>"},{"location":"release-notes/Release-Notes---0.5.0/#server-pro-058","title":"Server Pro 0.5.8","text":"<ul> <li>New Launchpad page to help with first setup: (<code>/launchpad</code>)</li> <li>Fixed an issue with project invites and Saml</li> <li>Various bugfixes</li> </ul>"},{"location":"release-notes/Release-Notes---0.5.0/#server-pro-059","title":"Server Pro 0.5.9","text":"<ul> <li>Fixed an issue where logins were not being counted for LDAP users</li> <li>Internal improvements to page rendering</li> </ul>"},{"location":"release-notes/Release-Notes---0.5.0/#server-pro-0511","title":"Server Pro 0.5.11","text":"<ul> <li>Sandboxed Compiles with Sibling Containers</li> <li>Various bugfixes</li> </ul>"},{"location":"release-notes/Release-Notes---0.6.0/","title":"0.6.0","text":""},{"location":"release-notes/Release-Notes---0.6.0/#server-pro-063","title":"Server Pro 0.6.3","text":"<ul> <li>Fix bug in Sibling Containers feature</li> <li>Basic auto-complete for <code>\\ref{}</code> commands</li> <li>Assorted bug fixes</li> </ul>"},{"location":"release-notes/Release-Notes---0.6.0/#server-pro-062","title":"Server Pro 0.6.2","text":"<ul> <li>Fix bug with login redirect flow</li> <li>Enable Track Changes for all users</li> <li>Various bug fixes</li> <li>Protect user settings pages with \"Sudo Mode\",   Users will be prompted for their password   when accessing the settings page.</li> </ul>"},{"location":"release-notes/Release-Notes---0.6.0/#server-pro-061","title":"Server Pro 0.6.1","text":"<ul> <li>Handle errors in History feature</li> </ul>"},{"location":"release-notes/Release-Notes---0.6.0/#server-pro-060","title":"Server Pro 0.6.0","text":"<ul> <li>New Track Changes feature</li> <li>Various bug fixes</li> </ul>"},{"location":"release-notes/Release-Notes---1.0.0/","title":"1.0.0","text":""},{"location":"release-notes/Release-Notes---1.0.0/#server-pro-121","title":"Server Pro 1.2.1","text":"<p>(Community Edition Image ID: <code>8e1bae81acac</code>)</p>"},{"location":"release-notes/Release-Notes---1.0.0/#server-pro-120","title":"Server Pro 1.2.0","text":"<ul> <li>Use both 2016 and 2017 versions of texlive, for backward compatibility</li> </ul>"},{"location":"release-notes/Release-Notes---1.0.0/#server-pro-110","title":"Server Pro 1.1.0","text":"<ul> <li>Update texlive to 2017.1</li> <li>Use <code>https</code> for the learn-wiki proxy by default</li> </ul>"},{"location":"release-notes/Release-Notes---1.0.0/#server-pro-102","title":"Server Pro 1.0.2","text":"<ul> <li>A new auto-compile option, keep the pdf view in sync while you type </li> <li>A new link-sharing feature, replacing the public/private permissions system</li> <li>New administration interface</li> <li>Package-aware Autocomplete</li> <li>Various bug fixes and performance improvements</li> </ul>"},{"location":"release-notes/Release-Notes---1.0.0/#server-pro-100","title":"Server Pro 1.0.0","text":"<ul> <li>Upgraded all internal services to latest node-js runtime</li> <li>Per-User Track Changes</li> <li>Improved Autocomplete</li> <li>Improved Spellcheck</li> <li>Fixed an issue with creating templates</li> <li>Enable SES email configuration via Instance Roles</li> <li>Various bug-fixes and improvements</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/","title":"Server Pro 2.7.1","text":"<p>Release date: 2021-09-16</p> <p>Image ID: <code>823f6cb592f4</code> (Community Edition Image ID: <code>4f7d059759d2</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes","title":"Bugfixes","text":"<ul> <li>This release includes a security update preventing editor sessions from being disconnected.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#new-features","title":"New Features","text":"<ul> <li>An image placeholder is displayed when a template preview is not generated (due to having <code>ENABLE_CONVERSIONS</code> environment variable set to <code>false</code>).</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-270","title":"Server Pro 2.7.0","text":"<p>Release date: 2021-07-12</p> <p>Image ID: <code>e8efe0e39698</code> (Community Edition Image ID: <code>9ca6a3256fb6</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_1","title":"Bugfixes","text":"<ul> <li>Fixed comment attribution in projects with anonymous comments </li> <li>Fixed collaborators redirected out of a project when the owner edited the collaborators</li> <li>Fixed redis connections in the host machine when no password authentication is defined #895</li> <li>Fixed <code>host</code> headers in i18n installs #896</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#other-changes","title":"Other changes","text":"<ul> <li><code>SHARELATEX_SAML_CERT</code> is now required for SAML setup.</li> <li>Many small improvements and bugfixes</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-262","title":"Server Pro 2.6.2","text":"<p>Release date: 2021-05-20</p> <p>Image ID: <code>1f1f4f1c4f02</code> (Community Edition Image ID: <code>2d8a8b6d1930</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_2","title":"Bugfixes","text":"<ul> <li>Fixed <code>references</code> service crashing with <code>.bib</code> files larger than 6mb.</li> <li>Fixed incorrect emailing attempt during user registration, which displayed an error message in the logs.</li> <li>Fixed LDAP registration when <code>firstName</code> and <code>lastName</code> contain a list of variations with non-ascii characters.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-261","title":"Server Pro 2.6.1","text":"<p>Release date: 2021-04-23</p> <p>Image ID: <code>dd382a10a3e5</code> (Community Edition Image ID: <code>cfd4ec616219</code>)</p> <p>This release includes performance and stability improvements for handling larger projects. These improvements are backed by changes to data structures in the Mongo database. The changes are implemented in a backwards compatible way for reading existing data, but new data is written in a backwards incompatible format. You may be able to upgrade without making any changes to the database at this time, but in case of a roll-back, you will not be able to read all the newly written data. A future release will migrate the old data to the new format. As with previous updates, please ensure you have a backup before upgrading.</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_3","title":"Bugfixes","text":"<ul> <li>This release includes important security updates. It fixes some potential XSS vulnerabilities and upgrades to node 12 ahead of node 10 reaching end of life on 30 Apr 2021.</li> <li>Fallback linearisation breaks PDF/A when not using sandboxed compiles.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#new-features_1","title":"New Features","text":"<ul> <li>SAML: Add <code>/saml/meta</code> endpoint to fetch Service Provider Metadata.</li> <li>New configuration parameters for SMTP: <code>SHARELATEX_EMAIL_SMTP_NAME</code> and <code>SHARELATEX_EMAIL_SMTP_LOGGER</code>.</li> <li>Added configurable AWS Region to email settings (<code>SHARELATEX_EMAIL_AWS_SES_REGION</code>).</li> <li>Allow Nginx connection limits to be changed.</li> <li>Administrators can now promote other users to administrator again.</li> <li>Added <code>ADDITIONAL_TEXT_EXTENSIONS</code> for customisation of editable file types.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#other","title":"Other","text":"<ul> <li>UI and performance improvements.</li> <li>All services have been upgraded to Node v12 from v10.</li> </ul> <p>Note: <code>2.6.1</code> is the initial release on the <code>2.6.x</code> line, version <code>2.6.0</code> has not been published.</p>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-252","title":"Server Pro 2.5.2","text":"<p>Release date: 2021-01-26</p> <p>Image ID: <code>8afec2bb0ace</code> (Community Edition Image ID: <code>62b08784fc5d</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_4","title":"Bugfixes","text":"<ul> <li>Fixed account activation with uppercase emails (https://github.com/overleaf/overleaf/issues/819)</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-251","title":"Server Pro 2.5.1","text":"<p>Release date: 2021-01-14</p> <p>Image ID: <code>e9a932e0effd</code> (Community Edition Image ID: <code>5d6493ce30fe</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_5","title":"Bugfixes","text":"<ul> <li>Fixed log rotation</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-250","title":"Server Pro 2.5.0","text":"<p>Release date: 2020-11-20</p> <p>Image ID: <code>7ae2382c68b3</code> (Community Edition Image ID: <code>6e6f3526af69</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#new-features_2","title":"New Features","text":"<ul> <li>File Outline.</li> <li>TexLive 2020 is now available.</li> <li>Mongo version updated to 4.0 (see upgrade instructions).</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_6","title":"Bugfixes","text":"<ul> <li>Fixed anonymous read/write project links redirecting to the login page.</li> <li>HTML code in SHARELATEX_LEFT_FOOTER is now correctly displayed.</li> <li>Fixed SHARELATEX_CUSTOM_EMAIL_FOOTER not working.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#other_1","title":"Other","text":"<ul> <li>This will be the last CE/SP release where we officially support IE11. The next release in Q1 2021 will no longer be tested on IE11.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-242","title":"Server Pro 2.4.2","text":"<p>Release date: 2020-10-5</p> <p>Image ID: <code>83c76915b65a</code> (Community Edition Image ID: <code>814858a6bb38</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_7","title":"Bugfixes","text":"<ul> <li>Fixed anonymous read/write sharing</li> <li>Fixed html links in left footer</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-241","title":"Server Pro 2.4.1","text":"<p>Release date: 2020-08-26</p> <p>Image ID: <code>6cf8c22f2903</code> (Community Edition Image ID: <code>4be5fcb14878</code>)</p> <p>No changes from 2.4.0. This release is just to keep the version numbering consistent between Server Pro and Community Edition.</p>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-240","title":"Server Pro 2.4.0","text":"<p>Release date: 2020-08-20</p> <p>Image ID: <code>6cf8c22f2903</code> (Community Edition Image ID: <code>2ff144360052</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#new-features_3","title":"New Features","text":"<ul> <li>Audit log for users' account settings updates</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_8","title":"Bugfixes","text":"<ul> <li>This release fixes an important security issue: previously, it was possible for a specially crafted websocket request to bypass project authorization checks. https://github.com/overleaf/real-time/pull/177</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#other-changes_1","title":"Other changes","text":"<ul> <li>Many small improvements and bugfixes</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-231","title":"Server Pro 2.3.1","text":"<p>Release date: 2020-06-30</p> <p>Image ID: <code>6fc8c7709df6</code> (Community Edition Image ID: <code>050f166647d2</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_9","title":"Bugfixes","text":"<ul> <li>Fixed sync between editor and pdf with synctex when not using sandboxed compiles.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-230","title":"Server Pro 2.3.0","text":"<p>Release date: 2020-06-11</p> <p>Image ID: <code>feb1b349654b</code> (Community Edition Image ID: <code>843316001077</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#new-features_4","title":"New Features","text":"<ul> <li>TexLive version selector</li> <li>(when using sandboxed compiles)</li> <li>Show latexmk output in compile logs</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_10","title":"Bugfixes","text":"<ul> <li>Fixed broken LuaLatex builds when not using sandboxed compiles</li> <li>Fixed PDF/A validation broken when not using sandboxed compiles</li> <li>Fixed project uploads from zip files with many large text files</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#other-changes_2","title":"Other changes","text":"<ul> <li>gravatar.com service is no longer used</li> <li>Deleted documents no longer count toward overall project file limit</li> <li>Improvements to dashboard tag management</li> <li>Many small improvements and bugfixes</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-221","title":"Server Pro 2.2.1","text":"<p>Release date: 2020-03-10</p> <p>Image ID: <code>11dce4970997</code></p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_11","title":"Bugfixes","text":"<ul> <li>TexLive image not being persisted in project entities (<code>project.imageName</code> field)</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-220","title":"Server Pro 2.2.0","text":"<p>Release date: 2020-02-10</p> <p>Image ID: <code>4b4d9f8d4fad</code> (Community Edition Image ID: <code>0867310d1151</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_12","title":"Bugfixes","text":"<ul> <li>Incorrect template layout is now fixed</li> <li>Node upgrade to fix CVE-2019-15605, CVE-2019-15606 and CVE-2019-15604</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#new-features_5","title":"New Features","text":"<ul> <li>reCAPTCHA is now disabled</li> <li>Removed external access to Google Fonts.</li> <li>Other minor improvements and bugfixes.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-211","title":"Server Pro 2.1.1","text":"<p>Release date: 2020-01-21</p> <p>Image ID: <code>23f9a28eeef2</code> (Community Edition Image ID: <code>e01ae3fd29ac</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_13","title":"Bugfixes","text":"<ul> <li>Fixed unable to share projects via email address.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-210","title":"Server Pro 2.1.0","text":"<p>Release date: 2020-01-14</p> <p>Image ID: <code>61a994c2584f</code> (Community Edition Image ID: <code>503763f211f2</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#new-features_6","title":"New Features","text":"<ul> <li>Email confirmation banner can be disabled with the new environment variable <code>EMAIL_CONFIRMATION_DISABLED: 'true'</code></li> <li>New Archival/trashing workflow</li> <li>Project ownership can be changed from the admin panel.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#other-changes_3","title":"Other Changes","text":"<ul> <li>Admin: improved search using regular expressions </li> <li>Other minor improvements and bugfixes.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-203","title":"Server Pro 2.0.3","text":"<p>Release date: 2019-12-06</p> <p>Image ID: <code>d29f5373eca9</code></p> <p>2.0.3 is a Server Pro-only release, no Community Edition has been published.</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_14","title":"Bugfixes","text":"<ul> <li>Fixed unable to share projects via email address.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#other-changes_4","title":"Other Changes","text":"<ul> <li>Reenabled recaptcha, which was the root cause of the issue above.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-202","title":"Server Pro 2.0.2","text":"<p>Release date: 2019-11-26</p> <p>Image ID: <code>9907ccc100e5</code> (Community Edition Image ID: <code>de647e8b462c</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_15","title":"Bugfixes","text":"<ul> <li>Fixed link sharing for anonymous users when <code>SHARELATEX_ALLOW_PUBLIC_ACCESS: 'true'</code> and <code>SHARELATEX_ALLOW_ANONYMOUS_READ_AND_WRITE_SHARING: 'true'</code>.</li> <li>Fixed read-only access to shared projects.</li> <li>Fixed SAML logout (Server Pro only).</li> <li>Fixed sync between editor and pdf with <code>synctex</code> (Server Pro only).</li> <li>Fixed track changes slow to commit.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#other-changes_5","title":"Other Changes","text":"<ul> <li>Disabled recaptcha (Server Pro only).</li> <li>Importing external files is disabled by default.</li> <li>IMPORTANT: A new <code>SYNCTEX_BIN_HOST_PATH</code> is required when using Sibling Containers. Check the setup instructions in the wiki: https://github.com/overleaf/overleaf/wiki/Server-Pro:-sandboxed-compiles#mapping-the-location-of-synctex-in-the-host.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-201","title":"Server Pro 2.0.1","text":"<p>Release date: 2019-10-18</p> <p>Image ID: <code>cb014e03204a</code> (Community Edition Image ID: <code>708b20c0a403</code>)</p>"},{"location":"release-notes/Release-Notes-2.0/#bugfixes_16","title":"Bugfixes","text":"<ul> <li>Fixed \"Delete Forever\" button has no effect.</li> <li>Fixed admin creation using CLI.</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#known-issues","title":"Known issues","text":"<ul> <li>SyncTeX not working on Sandboxed Compiles (see workaround instructions).</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro-200","title":"Server Pro 2.0.0","text":"<p>Release date: 2019-10-09</p> <p>Image ID: <code>8fdd3419f5a5</code> (Community Edition Image ID: <code>2cdbdc229d4f</code>)</p> <p>A lot has changed in the last few years, with ShareLaTeX joining forces with Overleaf to create one incredible authoring platform. Now that the merge is complete it's time to release a new version of ~ShareLaTeX~ Overleaf Community Edition and Server Pro!</p>"},{"location":"release-notes/Release-Notes-2.0/#new-features_7","title":"New Features","text":"<p>This release brings Community Edition and Server Pro up to date with the cloud-based version of Overleaf. A lot has changed since the last release, with too many bug fixes and small improvements to count, but here are a few highlights:</p> <ul> <li>A brand new user interface theme</li> <li>Improved project dashboard</li> <li>A new interface for creating (or uploading) files in a project</li> <li>Linked Files: import a file from another project.</li> <li>Improved History view</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#server-pro","title":"Server Pro","text":"<p>This release of Server Pro includes a few new premium features:</p> <ul> <li>Rich Text mode: write your document like a rich-text document, backed by nice clean LaTeX</li> <li>Improved Sandboxed Compiles: no more fiddling with group permissions (see below)</li> <li>Improved Admin Interface: now you can inspect the state of a project from the Admin page, plus many more small improvements</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#changes-to-the-docker-compose-file-format","title":"Changes to the Docker-Compose file format","text":"<p>This release adds a few new options to the docker environment. We recommend using our updated example docker-compose.yml file and updating it to reflect your old configuration where necessary. </p> <p>The new variables are:</p> <ul> <li><code>ENABLED_LINKED_FILE_TYPES</code>: a comma-separated list-keys, which controls which types of \"linked file\" are available in the New File modal. Defaults to <code>'url,project_file'</code>, as in the example file.</li> <li><code>ENABLE_CONVERSIONS</code>: If set to <code>'true'</code>, will enable on-the-fly file preview conversions using ImageMagick. Set to another value to disable this feature</li> <li><code>REDIS_HOST</code>: should be set to the name of the Redis host, same as the <code>SHARELATEX_REDIS_HOST</code> variable. In the case of a simple docker-compose based deployment, this will just be <code>'redis'</code>. This duplication is, unfortunately, necessary in the short term while users migrate to the new Community Edition and Server Pro images, and will be resolved in a later release.</li> <li><code>REDIS_PORT</code>: In case we desire to use the port for Redis other than the default, we need to set the value in <code>REDIS_PORT</code> to be the same as in <code>SHARELATEX_REDIS_HOST</code>, for the same reason described above.</li> </ul> <p>And for Server Pro:</p> <ul> <li><code>DOCKER_RUNNER</code>: set to <code>'true'</code> when enabling Sandboxed Compiles with sibling containers. See the updated documentation on Sandboxed Compiles.</li> <li><code>SYNCTEX_BIN_HOST_PATH</code> (introduced in <code>2.0.2</code>): set to <code>&lt;your_sharelatex_data_directory&gt;/bin/synctex</code>. Check Sibling Containers documentation for extra context</li> </ul>"},{"location":"release-notes/Release-Notes-2.0/#changes-to-sandboxed-compiles","title":"Changes to Sandboxed Compiles","text":"<p>We've made some changes to the way the Sanboxed Compiles work. In previous versions, the administrators often needed to fiddle with user and group permissions on the docker socket to get Sibling Containers to work. In this release, we've changed all that so it's handled automatically inside the Server Pro container, so it should just work in the majority of cases.</p> <p>From this release onwards we will no longer support the old \"Docker-In-Docker\" method of sandboxed compiles, as it has become more and more difficult to get this to work as time goes on. We strongly encourage admins to consider the newer Sibling Containers method as an alternative.</p>"},{"location":"release-notes/Release-Notes-2.0/#upgrading-texlive","title":"Upgrading TexLive","text":"<p>You can now opt-in to a new version of TeX Live. The default is still TeX Live 2017, but you can find instructions on how to get TeX Live 2018 or later here: https://github.com/overleaf/overleaf/wiki/Server-Pro:-sandboxed-compiles#changing-the-texlive-image</p> <p>Before updating to a newer version of TexLive we strongly recommend backing up your data and update to the latest version of Server Pro available.</p>"},{"location":"release-notes/Release-Notes-2.0/#database-migrations","title":"Database Migrations","text":"<p>The following database migrations have been added, and will run automatically:</p> <ul> <li>Alter the structure of the User model to support future work</li> <li>Change structure of <code>project.tokens</code>, to enforce uniqueness on the numeric part   of a read-and-write sharing token</li> </ul> <p>Administrators and end-users should not notice any change in behaviour due to these migrations.</p>"},{"location":"release-notes/Release-Notes-2.0/#support","title":"Support","text":"<p>If anything seems out of place, or you run into any problems while upgrading, please get in touch with us via email at <code>support@overleaf.com</code></p>"},{"location":"release-notes/Release-Notes-3.x.x/","title":"3.x.x","text":""},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-3513","title":"Server Pro 3.5.13","text":"<p>Release date: 2023-10-06</p> <p>Image ID: <code>4f2113a3c903</code> (Community Edition Image ID: <code>0038aa2cc383</code>)</p> <ul> <li>Fixes history soft retry cronjob, which was executing the operation as a hard retry.</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-3512","title":"Server Pro 3.5.12","text":"<p>Release date: 2023-09-25</p> <p>Image ID: <code>af3621af7b83</code> (Community Edition Image ID: <code>a461cd37241b</code>)</p> <ul> <li>Workaround a bug in the History Migration Scripts when multiple updates have the same version.</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-3511","title":"Server Pro 3.5.11","text":"<p>Release date: 2023-08-10</p> <p>Image ID: <code>dcfec83c5091</code> (Community Edition Image ID: <code>6f8a5409f146</code>)</p> <ul> <li>Fixed a bug in the History Migration Scripts when large deleted documents exist.</li> <li>Extended the History Migration Cleanup Script to free up mongo storage space.</li> </ul> <p>Warning</p> <p>We advise customers to re-run the script again as per the documentation.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-3510","title":"Server Pro 3.5.10","text":"<p>Release date: 2023-07-20</p> <p>Image ID: <code>f83dc1e03fcf</code> (Community Edition Image ID: <code>373b0b94b156</code>)</p> <p>This release includes security updates.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-359","title":"Server Pro 3.5.9","text":"<p>Release date: 2023-07-14</p> <p>Image ID: <code>d746f967e231</code> (Community Edition Image ID: <code>25aa7097b27b</code>)</p> <p>This release includes security updates.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-358","title":"Server Pro 3.5.8","text":"<p>Release date: 2023-06-29</p> <p>Image ID: <code>03c294380d2c</code> (Community Edition Image ID: <code>39d691cb806e</code>)</p> <p>Fixes a bug preventing anonymous users from adding changes to the Project History when Full Project History is enabled.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-357","title":"Server Pro 3.5.7","text":"<p>Release date: 2023-06-01</p> <p>Image ID: <code>65cc2f2e2af6</code> (Community Edition Image ID: <code>cc998380cad7</code>)</p> <p>Fixes a bug in the History Migration Scripts when using <code>--force-clean</code> that prevented migration reattempts in certain situations.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-356","title":"Server Pro 3.5.6","text":"<p>Release date: 2023-05-04</p> <p>Image ID: <code>0dee80908e57</code> (Community Edition Image ID: <code>89c35e1b6ec8</code>)</p> <p>Added <code>clean_sl_history_data</code> script to cleanup legacy history data.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-355","title":"Server Pro 3.5.5","text":"<p>Release date: 2023-03-21</p> <p>Image ID: <code>35bda2a2a778</code> (Community Edition Image ID: <code>9db95d7e350c</code>)</p> <p>This release fixes the shutdown sequence in Server Pro / Community Edition.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-354","title":"Server Pro 3.5.4","text":"<p>Release date: 2023-03-20</p> <p>Image ID: <code>44d12da219d7</code> (Community Edition Image ID: <code>563d00cfad2a</code>)</p> <p>This release disables the primary email check feature in Server Pro / Community Edition.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-353","title":"Server Pro 3.5.3","text":"<p>Release date: 2023-03-07</p> <p>Image ID: <code>8c7444b2e929</code> (Community Edition Image ID: <code>60bef8c323a5</code>)</p> <p>This release includes a performance improvement to the Full Project History migration script.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-352","title":"Server Pro 3.5.2","text":"<p>Release date: 2023-03-07</p> <p>Image ID: <code>dca7282041af</code> (Community Edition Image ID: <code>cd45ea2957b0</code>)</p> <p>This release includes several improvements to the Full Project History migration scripts.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-351","title":"Server Pro 3.5.1","text":"<p>Release date: 2023-02-28</p> <p>Image ID: <code>6a64c0f67077</code> (Community Edition Image ID: <code>bfa72dc4430f</code>)</p> <p>This release includes a fix for a German translation in the editor.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-350","title":"Server Pro 3.5.0","text":"<p>Release date: 2023-02-13</p> <p>Image ID: <code>f6963b4eaad9</code> (Community Edition Image ID: <code>678db4634722</code>)</p> <p>This release includes the Full Project History feature that is already available in our SaaS offering, overleaf.com and brings several improvements for users:</p> <p>Tracks changes in binary files, which is unsupported in the legacy system. There is support for labelled versions. The system is in general more robust, there is less chance of data loss.</p> <p>After upgrading your instance all new projects will be using Full Project History by default (unless opting-out, see environment variables in Configuring Overleaf). Existing projects will continue using the legacy History system, until they\u2019re migrated.</p> <p>Full Project History migration instructions.</p> <p>This release also ships with official support for S3 compatible object storage. This could either be a self-hosted solution, like min.io or ceph.io, or AWS S3. The S3 based storage backend can optionally replaces the local fs/NFS storage backend. You can find a wiki page on setting up S3 in Server Pro and another wiki page describes the migration process for moving existing data into S3. With S3-compatible object storage support we prepared Server Pro for horizontal scaling, look out for news here soon!</p>"},{"location":"release-notes/Release-Notes-3.x.x/#bugfixes","title":"Bugfixes","text":"<ul> <li>Remove empty \"Advanced\" tab in admin panel.</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#other-changes","title":"Other changes","text":"<ul> <li>Added cleanup scripts to flush redis data on container shutdown. This might increase the time it takes to stop the instance to up to 1 minute. If you're not using the Overleaf Toolkit, you need to specify the timeouts in your container configuration.</li> <li>German translation coverage significantly improved (d5d3fcd) </li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-340","title":"Server Pro 3.4.0","text":"<p>Release date: 2023-01-11</p> <p>Image ID: <code>07f5275feec5</code> (Community Edition Image ID: <code>009c80a8d63e</code>)</p> <p>This release includes database migrations. Please backup your database before upgrading.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#new-features","title":"New Features","text":"<ul> <li>New environment variable <code>SHARELATEX_STATUS_PAGE_URL</code> can be set to a custom status page URL. This URL is displayed when the site is closed for maintenance and on 500 errors.</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#bugfixes_1","title":"Bugfixes","text":"<ul> <li>Fix parsing of <code>authnContext</code> in <code>passport-saml</code> options (Server Pro).</li> <li>Fix disconnect users option in site admin panel (Server Pro).</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#other-changes_1","title":"Other changes","text":"<ul> <li>Drop limit for <code>output.pdf</code> requests. This should mitigate errors compiling a project several times in a short time.</li> <li>Memory management improvements during file upload process. These changes reduce pressure on the disk from fewer IO operations.</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-332","title":"Server Pro 3.3.2","text":"<p>Release date: 2022-11-15</p> <p>Image ID: <code>c03e78f10d6d</code> (Community Edition Image ID: <code>eab840a50369</code>)</p> <p>This release includes a fix for a server error that can stop the project dashboard from opening:</p> <p>TypeError: (project.archived || []).some is not a function</p> <p>The fix sports a new migration for converting the <code>archived</code> and <code>trashed</code> state of projects from a per-project setting to a per-user setting.</p> <p>Note</p> <p>As always, please take a backup of your database before upgrading to this release. </p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-331","title":"Server Pro 3.3.1","text":"<p>Release date: 2022-10-18</p> <p>Image Id: <code>9194fb1de6b3</code> (no Community Edition image)</p> <p>This release includes a security update addressing potential vulnerabilities with SAML auth provider integration.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-330","title":"Server Pro 3.3.0","text":"<p>Release date: 2022-10-13</p> <p>Image ID: <code>56f044d08198</code> (Community Edition Image ID: <code>4c4bad165ea6</code>)</p> <p>This new release of Server Pro includes a MongoDB migration affecting several collections. Please ensure you have a database backup before upgrading.</p> <p>For CE users, and Server Pro users that don't run Sandboxed Compiles there is a change in how Latex packages are installed, now requiring to run <code>tlmgr path add</code> again after every use of <code>tlmgr install</code> in order to correctly symlink all the binaries into the system path.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#new-features_1","title":"New Features","text":"<ul> <li>Stop on First Error compilation mode</li> <li>User/Project audit logs can now store more than 200 entries.</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#other-changes_2","title":"Other changes","text":"<ul> <li>HTML content in Template descriptions is now sanitized using <code>sanitize-html</code> default options.  This might affect your existing templates.</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-322","title":"Server Pro 3.2.2","text":"<p>Release date: 2022-09-19</p> <p>Image ID: <code>20e80bd600fb</code> (Community Edition Image ID: <code>8552c59519a7</code>)</p>"},{"location":"release-notes/Release-Notes-3.x.x/#bugfixes_2","title":"Bugfixes","text":"<ul> <li>Fixes TexLive package setup (non-sandboxed compiles) (https://github.com/overleaf/overleaf/issues/1044)</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-321","title":"Server Pro 3.2.1","text":"<p>Release date: 2022-08-26</p> <p>Image ID: <code>3817bd0d07a4</code> (Community Edition Image ID: <code>31cc6bc2bfa7</code>)</p>"},{"location":"release-notes/Release-Notes-3.x.x/#bugfixes_3","title":"Bugfixes","text":"<ul> <li>Fixes source editor not being displayed (https://github.com/overleaf/overleaf/issues/1043)</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-320","title":"Server Pro 3.2.0","text":"<p>Release date: 2022-08-16</p> <p>Image ID: <code>4db483917643</code> (Community Edition Image ID: <code>1bce84a47f1f</code>)</p> <p>This new release of Server Pro includes several new features. It also requires updating Mongo version to <code>4.4</code>. Upgrade instructions are available here. Please ensure you have a database backup before upgrading.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#new-features_2","title":"New Features","text":"<ul> <li>User Activity and License Usage information (with a count of active users) is now displayed in the Admin Panel.</li> <li>PDF Preview Detach.</li> <li>User Dictionary entries can now be deleted from the Editor Settings panel.</li> <li>TexLive 2022 is available for instances running Sandboxed Compiles. Check the documentation for instructions to upgrade. TexLive 2022 is also the default version for instances not running Sandboxed Compiles.</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#bugfixes_4","title":"Bugfixes","text":"<ul> <li>Fixed history diff navigation. </li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-311","title":"Server Pro 3.1.1","text":"<p>Release date: 2022-08-10</p> <p>Image ID: <code>eb5802bfd8a4</code> (Community Edition Image ID: <code>401c5a25016d</code>)</p>"},{"location":"release-notes/Release-Notes-3.x.x/#bugfixes_5","title":"Bugfixes","text":"<ul> <li>Fixes history diff navigation (https://github.com/overleaf/overleaf/issues/1035)</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-310","title":"Server Pro 3.1.0","text":"<p>Release date: 2022-05-17</p> <p>Image ID: <code>699e7c990b0f</code> (Community Edition Image ID: <code>9c9fe33828a0</code>)</p> <p>This release requires updating Mongo version to <code>4.2</code>. Upgrade instructions are available here. Please ensure you have a database backup before upgrading.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#new-features_3","title":"New Features","text":"<ul> <li>Symbol Palette</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#other-changes_3","title":"Other changes","text":"<ul> <li>TexLive 2021 is available for instances running Sandboxed Compiles. Check the documentation for instructions to upgrade. </li> <li>The path of the application inside the container has changed from <code>/var/www/sharelatex</code> to <code>/overleaf</code>; if you have bind mounts that use the old path, they will need to be updated.</li> <li>Many small improvements and bugfixes.</li> </ul>"},{"location":"release-notes/Release-Notes-3.x.x/#server-pro-301","title":"Server Pro 3.0.1","text":"<p>Release date: 2021-10-05</p> <p>Image ID: <code>5e87b3c5ad41</code> (Community Edition Image ID: <code>9155d8a13aaa</code>)</p> <p>This major release includes migrations that update the database in a backwards incompatible format. Please ensure you have a database backup before upgrading, in case of roll-back you will not be able to read data in the new format.</p> <p>This update brings general performance and stability improvements to the application, along with many small improvements and bugfixes. </p> <p>We've recently updated the way we tag our docker images. In addition to <code>3.0.1</code>, we're also tagging the new version as <code>3</code> and <code>3.0</code>, representing the latest major and minor versions for the <code>3.x.x</code> branch respectively. These new tags will be updated again when a new minor or hotfix version is published.</p> <p><code>latest</code> tag won't be immediately updated to this new major version. If you're using a <code>docker-compose.yml</code> please update your <code>image</code> tag to <code>3</code>, <code>3.0</code> or <code>3.0.1</code>. Toolkit users can continue using the <code>bin/upgrade</code> script as usual.</p> <p>Important: before upgrading to this new major version you need to upgrade to version <code>2.7.1</code> first.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#troubleshooting","title":"Troubleshooting","text":""},{"location":"release-notes/Release-Notes-3.x.x/#duplicate-keys","title":"Duplicate Keys","text":"<p>A migration may occasionally fail due to unexpected duplicate entries in a mongo collection.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#duplicate-keys-in-tags-collection","title":"Duplicate keys in tags collection","text":"<p>If upgrading from <code>2.7.1</code> to <code>3.0.1</code> fails with messages containing <code>MongoError: Error during migrate \"20190912145029_create_tags_indexes\": E11000 duplicate key error collection: sharelatex.tags index: user_id_1_name_1 dup key: {&lt;\u2026&gt;}</code> this means that one of your users has multiple tags/folders with the same name.</p> <p>To recover, revert to your <code>2.7.1</code> backups and ask the user to make their tag/folder names unique. (The user id and specific tag name will be reported in the error message, so you can contact the affected user and mention the specific tag name that is problematic.) Then attempt the upgrade again.</p> <p>You can also attempt to detect multiple tags in advance, before you upgrade, with the following aggregate:</p> <p><pre><code>docker exec -it mongo mongo\nuse sharelatex\n\ndb.tags.aggregate([\n  {$group: {\n    _id: {name: \"$name\", user_id: \"$user_id\"},\n    count: {$sum: 1}\n  }},\n  {$match: {count: {$gt: 1}}},\n  {$sort: {count: -1}}\n])\n</code></pre> If it returns no results, there are no duplicate tags, and the migration should succeed.</p>"},{"location":"release-notes/Release-Notes-3.x.x/#duplicate-keys-in-contacts-collection","title":"Duplicate keys in contacts collection","text":"<p>If you see the error <code>MongoError: Error during migrate \"20190912145001_create_contacts_indexes\": E11000 duplicate key error collection: sharelatex.contacts index: user_id_1 dup key{&lt;\u2026&gt;}</code> this indicates a similar problem in the <code>contacts</code> collection.  You can check how many entries are affected with the following command:</p> <p><pre><code>docker exec -it mongo mongo\nuse sharelatex\n\ndb.contacts.aggregate([\n  {$group: {\n    _id: {user_id: \"$user_id\"},\n    count: {$sum: 1}\n  }},\n  {$match: {count: {$gt: 1}}},\n  {$sort: {count: -1}}\n])\n</code></pre> The contacts collection is a cache of names which appear as completions in the \"Share Project\" modal, it is not critical data. You can remove individual duplicate entries with the command</p> <pre><code>db.contacts.deleteOne({ \"user_id\" : ObjectId(\"...\") })\n</code></pre> <p>where the ObjectId value should be taken from the list of duplicates.  When the duplicate contacts have been removed, the migration should succeed.  </p>"},{"location":"release-notes/Release-Notes-3.x.x/#saml-initialisation-error","title":"SAML initialisation error","text":"<p>You might see a <code>cert is required</code> error when upgrading from Server Pro <code>2.6.2</code> or earlier if <code>SHARELATEX_SAML_CERT</code> is not provided.</p> <p>If you come across the issue, please add the <code>SHARELATEX_SAML_CERT</code> value, and update your instance to <code>2.7.1</code> before attempting to upgrade to <code>3.x.x</code>.</p>"},{"location":"release-notes/Release-Notes-4.x.x/","title":"Server Pro 4.2.5","text":"<p>Release date: 2024-06-11</p> <ul> <li>Server Pro Image ID: <code>cbe8a3d11874</code></li> <li>Community Edition Image ID: <code>8ac3da599b94</code></li> <li>Git Bridge Image ID: <code>59a17a340612</code></li> </ul> <p>This release provides security updates, bug fixes, and performance enhancements, including:</p> <ul> <li>Stricter controls to prevent arbitrary JavaScript execution in the project editor.</li> <li>Stricter controls to prevent arbitrary CSS loading in the project editor.</li> <li>Updated libraries to enhance security and performance.</li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-424","title":"Server Pro 4.2.4","text":"<p>Release date: 2024-04-17</p> <ul> <li>Server Pro Image ID: <code>875dd6e64e96</code></li> <li>Community Edition Image ID: <code>ab1e82612ec9</code></li> <li>Git Bridge Image ID: <code>455a8c0559a4</code></li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#security-release","title":"Security release","text":"<p>Server Pro 4.2.4 is a security release for the application runtime.</p> <p>The Node.js runtime has been upgraded to <code>18.20.2</code>. Check the release notes (<code>18.20.1</code>, <code>18.20.2</code>) for more information.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#other-changes","title":"Other changes","text":"<ul> <li>All services are now using IPv4 in the container</li> <li>Adds <code>bin/flush-history-queues</code> and <code>bin/force-history-resyncs</code> utility scripts.</li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-423","title":"Server Pro 4.2.3","text":"<p>Release date: 2024-02-16</p> <ul> <li>Server Pro Image ID: <code>a251a3f77aaa</code></li> <li>Community Edition Image ID: <code>168968a20483</code></li> <li>Git Bridge Image ID: <code>59a17a340612</code></li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#security-release_1","title":"Security release","text":"<p>Server Pro 4.2.3 is a security release for the application runtime.</p> <p>The Node.js runtime has been upgraded to 18.19.1 as per the security announcement upstream. It is worth noting that only CVE-2024-22019, a Denial of Service vulnerability, is applicable to Server Pro.</p> <p>If an access point to your Server Pro instance is publicly accessible via the internet, such as a login page or redirect to it, it is particularly important that you upgrade to Server Pro version 4.2.3.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-422","title":"Server Pro 4.2.2","text":"<p>Release date: 2024-02-07</p> <ul> <li>Server Pro Image ID: <code>166a56c173a1</code></li> <li>Community Edition Image ID: <code>f33f1873b490</code></li> <li>Git Bridge Image ID: <code>59a17a340612</code></li> </ul> <p>This release increases security against brute force attacks on projects with link-sharing enabled.</p> <p>If your Server Pro instance is configured with link-sharing enabled, using <code>SHARELATEX_ALLOW_PUBLIC_ACCESS=true</code>, it is particularly important that you upgrade to Server Pro version 4.2.2.</p> <p>We would also like to highlight a required upgrade of MongoDB to version 5.0 for the next Server Pro release. MongoDB 4.4 reaches end of life this month, February 2024. We recommend that all customers upgrade to MongoDB 5.0 at their earliest convenience.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-421","title":"Server Pro 4.2.1","text":"<p>Release date:  2023-11-23</p> <ul> <li>Server Pro Image ID: <code>3a75a815d297</code></li> <li>Community Edition Image ID: <code>ae1b8c082224</code></li> <li>Git Bridge Image ID: <code>59a17a340612</code></li> </ul> <p>This release restores public access to the <code>/saml/meta</code> endpoint.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-420","title":"Server Pro 4.2.0","text":"<p>Release date: 2023-11-10</p> <ul> <li>Server Pro Image ID: <code>8bdf368e59f4</code></li> <li>Community Edition Image ID: <code>ae1b8c082224</code></li> <li>Git Bridge Image ID: <code>59a17a340612</code></li> </ul> <p>This release separates the web service into an internal API service and a user facing service. Most of the changes in this regard are behind the scenes. The Git integration in Server Pro talks to the Server Pro container \"from the outside\" and its config needs changing.</p> <ul> <li>Toolkit users: please upgrade the toolkit (<code>bin/upgrade</code>) before upgrading to Server Pro 4.2.0.</li> <li><code>docker-compose</code> deployments: please update the contents of the <code>GIT_BRIDGE_API_BASE_URL</code> variable:</li> </ul> <pre><code>-GIT_BRIDGE_API_BASE_URL: \"http://sharelatex/api/v0/\"\n+GIT_BRIDGE_API_BASE_URL: \"http://sharelatex:3000/api/v0/\"\n</code></pre>"},{"location":"release-notes/Release-Notes-4.x.x/#new-features","title":"New Features","text":""},{"location":"release-notes/Release-Notes-4.x.x/#toolbar-in-code-editor","title":"Toolbar in Code Editor","text":"<p>A toolbar has been added to the Code Editor, which provides buttons for basic text styling, and inserting special characters, figures, code for tables, citations, and more.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#add-and-edit-tables-without-writing-code","title":"Add and edit tables without writing code","text":"<p>An easier way to create and edit tables is now available in Server Pro. You can also copy and paste tables and formatted text directly into Visual Editor, without losing the formatting.</p> <p>Check the blog post for more information.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#new-toolbar-option-insert-figure","title":"New toolbar option: Insert figure","text":"<p>The new Insert figure feature allows user to upload or just copy and paste an image file from your computer directly into the editor.</p> <p>Please refer to the blog post for more information.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#symbol-preview-in-editor-autocomplete","title":"Symbol preview in editor autocomplete","text":"<p>Math symbols are now previewed along with the autocomplete options in the editor.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#bugfixes","title":"Bugfixes","text":"<ul> <li>XeLatex is now available in the default Tex Live install when not using Sandboxed Compiles.</li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#other-changes_1","title":"Other changes","text":"<p>As announced with the previous Server Pro release, the legacy source editor has been removed from the editor. You can read more about the new editing experience on our blog.</p> <p>The new release also includes the following changes:</p> <ul> <li>Session length can now be configured with <code>SHARELATEX_COOKIE_SESSION_LENGTH</code>.</li> <li>Node runtime has been updated to v18.18.2</li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-416","title":"Server Pro 4.1.6","text":"<p>Release date:  2023-11-02</p> <ul> <li>Server Pro Image ID: <code>e40c0df3207f</code></li> <li>Community Edition Image ID: <code>50437e9a470c</code></li> <li>Git Bridge Image ID: <code>f499a7ef6e64</code></li> </ul> <p>This release adds several dependency patches bringing performance improvements in different parts of the application.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-415","title":"Server Pro 4.1.5","text":"<p>Release date:  2023-10-25</p> <ul> <li>Server Pro Image ID: <code>47246d85316b</code></li> <li>Community Edition Image ID: <code>d909899af648</code></li> <li>Git Bridge Image ID: <code>f499a7ef6e64</code></li> </ul> <p>This release includes a bug-fix for streaming compression in the history system that could result in hanging flushes. History changes will accumulate in Redis and do not get flushed for permanent storage on disk/S3, leading to potential data-loss when Redis runs out of memory. </p> <p>We advise all customers to upgrade to this release at their earliest convenience.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-414","title":"Server Pro 4.1.4","text":"<p>Release date:  2023-10-24</p> <ul> <li>Server Pro Image ID: <code>ef772a5f1148</code></li> <li>Community Edition Image ID: <code>1bcb24c3b31a</code></li> <li>Git Bridge Image ID: <code>f499a7ef6e64</code></li> </ul> <p>This release includes additional logging and a new config option for a request timeout.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-413","title":"Server Pro 4.1.3","text":"<p>Release date:  2023-10-06</p> <ul> <li>Server Pro Image ID: <code>6661a336d695</code></li> <li>Community Edition Image ID: <code>e46e0cf12e97</code></li> <li>Git Bridge Image ID: <code>f499a7ef6e64</code></li> </ul> <p>This release includes a fix for the history soft retry cronjob, which was executing the operation as a hard retry.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-412","title":"Server Pro 4.1.2","text":"<p>Release date: 2023-09-27</p> <ul> <li>Server Pro Image ID: <code>fab9def8230a</code></li> <li>Community Edition Image ID: <code>1ce6ef6ea798</code></li> <li>Git Bridge Image ID: <code>f499a7ef6e64</code></li> </ul> <p>This release includes security updates for the Git Bridge.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-411","title":"Server Pro 4.1.1","text":"<p>Release date: 2023-09-05</p> <ul> <li>Server Pro Image ID: <code>fab9def8230a</code></li> <li>Community Edition Image ID: <code>1ce6ef6ea798</code></li> <li>Git Bridge Image ID: <code>e5e9753fc979</code></li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#bugfixes_1","title":"Bugfixes","text":"<ul> <li>Hide tabs on user admin info pages that are only relevant for overleaf.com</li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-410","title":"Server Pro 4.1.0","text":"<p>Release date: 2023-08-24</p> <ul> <li>Server Pro Image ID: <code>a6c6bfe92bd1</code></li> <li>Community Edition Image ID: <code>1ce6ef6ea798</code></li> <li>Git Bridge Image ID: <code>e5e9753fc979</code></li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#security-release_2","title":"Security release","text":"<p>Server Pro 4.1 is a security release for the application runtime.</p> <p>The Node.js runtime has been upgraded from version 16 to 18 ahead of the upcoming deprecation of Node.js 16 on September 11, 2023.</p> <p>Only Server Pro 4.1 will operate with Node.js 18. All other supported versions of Server Pro require Node.js 16, which is being deprecated. We recommend that all customers upgrade to Server Pro 4.1 at their earliest convenience.</p> <p>If an access point to your Server Pro instance is publicly accessible via the internet, such as a login page or redirect to it, it is particularly important that you upgrade to Server Pro version 4.1 before September 11, 2023.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#history-migration","title":"History migration","text":"<p>Reminder: History migration for Server Pro 3.5.X and earlier</p> <p>If you are still using a Server Pro version before 4.0, we recommend starting with the upgrade process immediately. In Server Pro 4.0 we introduced a breaking change in the history system that requires migrating all the history data into the new system in order for Server Pro to function. </p> <p>The migration process can handle the majority of project histories without any manual work. However, very old projects can contain data that require additional steps to migrate. Starting the migration process now will give our support team adequate time to take a look into your migration issues and help you finish the migration ahead of the EOL date.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#history-cleanup","title":"History cleanup","text":"<p>Cleanup of orphaned data</p> <p>Server Pro versions 3.5.11, 4.0.6 and the latest 4.1 release include an updated script that fully deletes orphaned mongo data from the old history system. It is safe to run the script again. Please refer to the documentation on how to run the cleanup script.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#upcoming-changes","title":"Upcoming changes","text":"<p>Retirement of legacy source editor</p> <p>Server Pro 4.1 will be the last release with the legacy source editor. You can read more about the new editing experience on our blog.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#other-changes_2","title":"Other changes","text":"<p>Rich Text/Visual Editor enhancements</p> <ul> <li>The Rich Text/Visual editing experience has been improved. </li> <li>The \"Source\" editor has been renamed to \"Code Editor\" and the \"Rich Text\" editor has been renamed to \"Visual Editor\".</li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-406","title":"Server Pro 4.0.6","text":"<p>Release date: 2023-08-10</p> <p>Image ID: <code>da6f6f617532</code> (Community Edition Image ID: <code>504b19c82c27</code>)</p> <ul> <li>Bring back the History Migration Cleanup Script with a fix to free up mongo storage space.</li> </ul> <p>Warning</p> <p>We advise customers to re-run the script again as per the documentation.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-405","title":"Server Pro 4.0.5","text":"<p>Release date:  2023-07-20</p> <ul> <li>Server Pro Image ID: <code>bd37a572f01a</code></li> <li>Community Edition Image ID: <code>883bb853c896</code></li> <li>Git Bridge Image ID: <code>9bfd98050a43</code></li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#bugfixes_2","title":"Bugfixes","text":"<ul> <li>Fixes numbers replaced by underscores when downloading projects (overleaf/overleaf/issues/1133).</li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#other-changes_3","title":"Other changes","text":"<ul> <li>Security updates.</li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-404","title":"Server Pro 4.0.4","text":"<p>Release date: 2023-07-14</p> <ul> <li>Server Pro Image ID: <code>bcec664460d0</code></li> <li>Community Edition Image ID: <code>1cf00822f942</code></li> <li>Git Bridge Image ID: <code>9bfd98050a43</code></li> </ul> <p>This release includes security updates.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-403","title":"Server Pro 4.0.3","text":"<p>Release date: 2023-06-29</p> <ul> <li>Server Pro Image ID: <code>963eb95c3c86</code></li> <li>Community Edition Image ID: <code>380e3cb72a42</code></li> <li>Git Bridge Image ID: <code>9bfd98050a43</code></li> </ul> <p>Fixes a bug preventing anonymous users from adding changes to the Project History.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-402","title":"Server Pro 4.0.2","text":"<p>Release date: 2023-06-08</p> <ul> <li>Server Pro Image ID: <code>aa27991a39a7</code></li> <li>Community Edition Image ID: <code>26c75dfb6485</code></li> <li>Git Bridge Image ID: <code>9bfd98050a43</code></li> </ul> <p>Fixes a bug navigating through the documentation pages when <code>SHARELATEX_PROXY_LEARN=true</code>.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#server-pro-401","title":"Server Pro 4.0.1","text":"<p>Release date: 2023-05-30</p> <ul> <li>Server Pro Image ID: <code>3014d696b579</code> </li> <li>Community Edition Image ID: <code>26c75dfb6485</code></li> <li>Git Bridge Image ID: <code>9bfd98050a43</code></li> </ul> <p>Note: An issue was discovered with version 4.0 so it was never made public. This resulted in 4.0.1 being the first release in the 4.0 release line.</p> <p>Important: Before upgrading to this new major version you will need to first upgrade your Overleaf Server Pro instance to version 3.5.10 and migrate your projects to the new Full Project History system. Server Pro 4.0.0 will fail to start unless all the projects have been migrated.</p> <p>Read Full Project History migration instructions.</p> <p>This major release includes database migrations. Please ensure you have a database backup before upgrading.</p> <p>MongoDB now needs to run as a Replica Set. If you use an external Mongo database, you might already be running a replica set. If you use the Overleaf Toolkit you just need to pull the Toolkit's latest version. If you don't use the Toolkit, please see the instructions at the end of these release notes.</p> <p>We\u2019ve also updated the version of Redis to <code>6.2</code>. This change requires no action other than updating the image version. If you\u2019re using the Overleaf Toolkit, add the environment variable <code>REDIS_IMAGE=redis:6.2</code> to config/overleaf.rc (or update the version, if it was already defined). If you\u2019re using a custom <code>docker-compose.yml</code>, change the <code>redis</code> container image to <code>redis:6.2</code>.</p> <p>Note</p> <p>If upgrading to Redis 6.2 results in a restart loop, see this article in our troubleshooting guide for more information.</p>"},{"location":"release-notes/Release-Notes-4.x.x/#new-features-server-pro-only","title":"New Features (Server Pro only)","text":"<ul> <li>Overleaf Git integration \u2013 See the documentation for instructions to set up the git-bridge in your Server Pro install. </li> <li>Enhanced Rich Text functionality \u2013 Rich-text commenting and tracked changes.</li> <li>Support documentation for horizontal scaling, which allows for increased computing resources for large deployments</li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#new-features-for-overleaf-community-edition-and-server-pro","title":"New Features for Overleaf Community Edition and Server Pro","text":"<ul> <li> <p>A new Source editor in addition to the Legacy editor will be available to users. (The Legacy editor will eventually be retired. If users have any feedback or issues, please fill out this form.) The new Source editor provides better accessibility, and better support for non-latin text.</p> </li> <li> <p>Deleted projects and users can be automatically cleaned up after 90 days. This is an opt-in feature that can be enabled by setting the <code>ENABLE_CRON_RESOURCE_DELETION</code> environment variable to <code>true</code>. See the configuration documentation. </p> </li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#other-changes_4","title":"Other changes","text":"<ul> <li>TeXLive 2023 is now the default version for instances not running Sandboxed Compiles.</li> <li>The limit on a project\u2019s editable content size (the sum of sizes of all editable files) has been increased from 5MB to 7MB.</li> <li>General performance and stability improvements to the application, along with many small improvements and bug fixes.</li> </ul>"},{"location":"release-notes/Release-Notes-4.x.x/#manually-setting-up-mongodb-as-a-replica-set","title":"Manually setting up MongoDB as a replica set","text":"<p>The following instructions are not necessary if you use the Overleaf Toolkit or if you use an external Mongo database already configured as a replica set.</p> <p>If you run MongoDB with <code>docker-compose</code>, add the following command to the <code>mongo</code> container configuration:</p> <pre><code>mongo:\n    command: \"--replSet overleaf\"\n</code></pre> <p>Restart the mongo container then start a mongo shell with <code>docker-compose exec mongo mongo</code>. In that shell, run the following command to initiate the replica set:</p> <pre><code>rs.initiate({ _id: \"overleaf\", members: [ { _id: 0, host: \"mongo:27017\" } ] })\n</code></pre>"},{"location":"release-notes/Release-Notes-5.x.x/","title":"5.x.x","text":""},{"location":"release-notes/Release-Notes-5.x.x/#server-pro-510","title":"Server Pro  5.1.0","text":"<p>Release date: 2024-07-17</p> <ul> <li>Server Pro Image ID: <code>7216db608356</code></li> <li>Community Edition Image ID: <code>41a77f59f69e</code></li> <li>Git Bridge Image ID: <code>4cd4bea6fb01</code></li> </ul>"},{"location":"release-notes/Release-Notes-5.x.x/#mongodb-upgrade-to-v6","title":"MongoDB upgrade to v6","text":"<p>MongoDB 5 is reaching end of life on October 2024. All customers should upgrade to MongoDB 6.0. Follow the link to the official documentation for instructions.</p> <p>Toolkit users now need to split the MongoDB image between <code>MONGO_IMAGE</code> (with just the image name) and <code>MONGO_VERSION</code> in their <code>config/overleaf.rc</code> file.</p> <p>Example:</p> <pre><code># When using a custom image, MONGO_VERSION is required\nMONGO_IMAGE=my.docker.hub/mongo\nMONGO_VERSION=6.0-custom\n</code></pre> <p>Please ensure you have a consistent database backup before upgrading.</p>"},{"location":"release-notes/Release-Notes-5.x.x/#redis-aof-persistence-enabled-by-default","title":"Redis AOF Persistence enabled by default","text":"<p>AOF (Append Only File) persistence is now the recommended configuration for Redis persistence.</p> <p>Toolkit users have AOF persistence enabled by default for new installs. Existing users are recommended to follow the instructions on the official documentation to switch to AOF: https://redis.io/docs/latest/operate/oss_and_stack/management/persistence/#how-i-can-switch-to-aof-if-im-currently-using-dumprdb-snapshots</p>"},{"location":"release-notes/Release-Notes-5.x.x/#deprecation-for-docker-compose-v1","title":"Deprecation for docker-compose v1","text":"<p><code>docker-compose</code> v1 has reached its End Of Life in July 2023 (https://docs.docker.com/compose/migrate/). Support for <code>docker-compose</code> v1 in the Overleaf Toolkit will be dropped with the release of Server Pro 5.2. We recommend upgrading to Docker Compose v2 before then.</p>"},{"location":"release-notes/Release-Notes-5.x.x/#new-features","title":"New Features","text":"<ul> <li>SAML: multiple certificates are now supported. You can now set a list of comma-separated certificates in <code>OVERLEAF_SAML_SIGNING_CERT</code> and <code>OVERLEAF_SAML_CERT</code></li> <li>CSP (Content Security Policy) is now enabled by default. </li> </ul>"},{"location":"release-notes/Release-Notes-5.x.x/#bugfixes","title":"Bugfixes","text":"<ul> <li>Fixes a bug where projects created before enabling the templates feature couldn't be published as templates.</li> <li>Fixed spacing in project list footer.</li> <li>Fixed post-login redirection when login after clicking the \"Log in\" button in the header. </li> </ul>"},{"location":"release-notes/Release-Notes-5.x.x/#other-changes","title":"Other changes","text":"<ul> <li>Removed support for running LaTeX compiles with Docker-In-Docker in Server Pro. Sandboxed compiles using \"sibling\" containers is not affected by this.</li> <li>TeXLive images, as used for Sandboxed compiles, need to be pulled outside of Server Pro now. The Overleaf Toolkit is pulling all configured images as part of <code>bin/up</code>. All customers have been granted read access to quay.io/sharelatex/texlive-full.</li> <li>Stricter and faster graceful shutdown procedure for the Server Pro container</li> <li>The environment variable <code>SYNCTEX_BIN_HOST_PATH</code> is no longer used by the application</li> <li>We are sunsetting window properties like <code>window.project_id</code>. If you need access to any of these, please reach out to support@overleaf.com to discuss options.</li> <li>Significant reduction in Docker image size for Server Pro and CE</li> <li>Security updates to the base image and installed dependencies.</li> <li>Minor improvements and bugfixes. </li> </ul>"},{"location":"release-notes/Release-Notes-5.x.x/#server-pro-507","title":"Server Pro 5.0.7","text":"<p>Release date: 2024-07-12</p> <ul> <li>Server Pro Image ID: <code>a8c301474a4d</code></li> <li>Community Edition Image ID: <code>6f3e55a67fd5</code></li> <li>Git Bridge Image ID: <code>455a8c0559a4</code></li> </ul> <p>This is a security release. We added stricter controls for accessing project invite details and locked down access to files via the LaTeX compilation service.</p> <p>We strongly recommend turning on the Sandboxed compiles feature in Server Pro.</p>"},{"location":"release-notes/Release-Notes-5.x.x/#server-pro-506","title":"Server Pro 5.0.6","text":"<p>Release date: 2024-06-20</p> <ul> <li>Server Pro Image ID: <code>c9de60b06959</code></li> <li>Community Edition Image ID: <code>46bb44d4215d</code></li> <li>Git Bridge Image ID: <code>455a8c0559a4</code></li> </ul> <p>This is a security release. We added stricter controls for creating projects from ZIP URLs.</p>"},{"location":"release-notes/Release-Notes-5.x.x/#server-pro-505","title":"Server Pro 5.0.5","text":"<p>Release date: 2024-06-11</p> <ul> <li>Server Pro Image ID: <code>60da5806f83e</code></li> <li>Community Edition Image ID: <code>46bb44d4215d</code></li> <li>Git Bridge Image ID: <code>455a8c0559a4</code></li> </ul> <p>This is a security release. We added stricter controls to prevent arbitrary CSS loading in the project editor.</p>"},{"location":"release-notes/Release-Notes-5.x.x/#server-pro-504","title":"Server Pro 5.0.4","text":"<p>Release date: 2024-05-24</p> <ul> <li>Server Pro Image ID: <code>b0db0405a7ce</code></li> <li>Community Edition Image ID: <code>abcec6efbbf7</code></li> <li>Git Bridge Image ID: <code>455a8c0559a4</code></li> </ul> <p>This release provides security updates, bug fixes, and performance enhancements, including:</p> <ul> <li>Stricter controls to prevent arbitrary JavaScript execution in the browser.</li> <li>Updated libraries to enhance security and performance.</li> </ul>"},{"location":"release-notes/Release-Notes-5.x.x/#server-pro-503","title":"Server Pro 5.0.3","text":"<p>Release date: 2024-04-24</p> <ul> <li>Server Pro Image ID: <code>dc88a9ade14d</code></li> <li>Community Edition Image ID: <code>b4712d596c75</code></li> <li>Git Bridge Image ID: <code>455a8c0559a4</code></li> </ul> <p>This release builds up on 5.0.2 and includes the second revision of the recovery process for doc versions.</p> <p>If you never ran Server Pro version 5.0.1 or Community Edition version 5.0.1, or you started a brand new instance with 5.0.1, you do not need to run this recovery process. Please see the Bugfixes section for Server Pro 5.0.2 below for details on the need for a recovery and follow the doc version recovery process.</p>"},{"location":"release-notes/Release-Notes-5.x.x/#server-pro-502-retracted","title":"Server Pro 5.0.2 (Retracted)","text":"<p>Warning</p> <p>2024-04-22: We are retracting version 5.0.2. We have identified a few corner cases in the recovery procedure for docs.</p> <p>2024-04-24: Server Pro version 5.0.3 sports fixes for the previously identified corner cases.</p> <p>Release date: 2024-04-22</p> <ul> <li>Server Pro Image ID: <code>06eed5680340</code></li> <li>Community Edition Image ID: <code>9f018f899ba5</code></li> <li>Git Bridge Image ID: <code>455a8c0559a4</code></li> </ul>"},{"location":"release-notes/Release-Notes-5.x.x/#security-release","title":"Security release","text":"<p>Server Pro 5.0.2 is a security release for the application runtime.</p> <p>The Node.js runtime has been upgraded to <code>18.20.2</code>. Check their release notes (<code>18.20.1</code>, <code>18.20.2</code>) for more information.</p>"},{"location":"release-notes/Release-Notes-5.x.x/#bugfixes_1","title":"Bugfixes","text":"<ul> <li>Fixes database migration that resulted in the loss of doc versions. These are used by the history system and their loss resulted in the history system skipping over updates effectively resulting in no further changes to the history view and git-integration. This release fixes the database migration and also sports a recovery process for instances that ran release 5.0.1. If you ran version 5.0.1, please take a look at the dedicated doc version recovery process.</li> <li>Fixes <code>references</code> and <code>templates</code> services on Docker 26  ipv6.</li> </ul>"},{"location":"release-notes/Release-Notes-5.x.x/#other-changes_1","title":"Other changes","text":"<ul> <li>Adds <code>bin/flush-history-queues</code> and <code>bin/force-history-resyncs</code> utility scripts.</li> </ul>"},{"location":"release-notes/Release-Notes-5.x.x/#server-pro-501-retracted","title":"Server Pro 5.0.1 (Retracted)","text":"<p>Warning</p> <p>2024-04-18: We have identified a critical bug in a database migration that causes data loss. Please defer upgrading to release 5.0.1 until further notice on the mailing list. </p> <p>2024-04-24: Server Pro 5.0.3 has been released with a fix and recovery process that does not need access to a backup. See details above.</p> <p>Release date: 2024-04-02</p> <ul> <li>Server Pro Image ID: <code>0d28770b4692</code></li> <li>Community Edition Image ID: <code>ee69bf0baddf</code></li> <li>Git Bridge Image ID: <code>455a8c0559a4</code></li> </ul> <p>Note</p> <p>An issue was discovered with version <code>5.0.0</code>, so it was never made public. This resulted in <code>5.0.1</code> being the first release in the <code>5.0</code> release line.</p> <p>This major release includes the following changes:</p> <ul> <li>Required database upgrade from MongoDB 4 to MongoDB 5</li> <li>Rebranding of <code>SHARELATEX_*</code> to <code>OVERLEAF_*</code> environment variables</li> <li>Rebranding of filesystem paths from ShareLaTeX brand to Overleaf brand</li> </ul> <p>Important: the Toolkit will help migrating your configuration, please follow the prompts of <code>bin/upgrade</code>.</p>"},{"location":"release-notes/Release-Notes-5.x.x/#mongodb-upgrade-to-v5","title":"MongoDB upgrade to v5","text":"<p>MongoDB 4.4 has reached end of life on February 2024. All customers should upgrade to MongoDB 5.0 before upgrading to the 5.0 release line.</p> <p>The release also includes migrations that update the database in a backwards incompatible format. </p> <p>Please ensure you have a consistent database backup before upgrading. In case of roll-back, you will need to restore the database backup. Server Pro 4.x is not capable of reading the new format, which can result in data-loss or broken projects.</p>"},{"location":"release-notes/Release-Notes-5.x.x/#configuration-changes","title":"Configuration changes","text":"<p>Environment variables have been rebranded from <code>SHARELATEX_*</code> to <code>OVERLEAF_*</code>. Overleaf Toolkit users should be prompted to perform the migration when running <code>bin/upgrade</code>, and warnings will be printed when trying to run the Overleaf instance with the incorrect configuration.</p> <p>Filesystem paths have also been rebranded from ShareLaTeX brand to Overleaf brand: - <code>/var/lib/sharelatex</code> -&gt; <code>/var/lib/overleaf</code> - <code>/var/log/sharelatex</code> -&gt; <code>/var/log/overleaf</code> - <code>/etc/sharelatex</code> -&gt; <code>/etc/overleaf</code></p> <p>Filesystem changes are automatically handled by the Overleaf Toolkit. Otherwise, make sure bind-mount targets are updated to refer to the Overleaf equivalent, e.g.</p> <p><code>docker-compose/yml</code> before:</p> <pre><code>    volumes:\n     - /my/docker-host/path:/var/log/sharelatex\n</code></pre> <p><code>docker-compose.yml</code> after:</p> <pre><code>    volumes:\n     - /my/docker-host/path:/var/log/overleaf\n</code></pre>"},{"location":"release-notes/Release-Notes-5.x.x/#new-features_1","title":"New Features","text":"<ul> <li>Added support for using IAM credentials when using AWS S3 for project/history files</li> <li>Server Pro will refuse to start when using an older version of MongoDB</li> </ul>"},{"location":"release-notes/Release-Notes-5.x.x/#bugfixes_2","title":"Bugfixes","text":"<ul> <li>Fixes a scenario in which the share project modal doesn't display the link-sharing links immediately after turning on the feature</li> </ul>"},{"location":"release-notes/Release-Notes-5.x.x/#other-changes_2","title":"Other changes","text":"<ul> <li>All services are now using IPv4 in the container</li> <li>Container image upgrade from Ubuntu 20.04 to 22.04 LTS</li> <li>Security updates to the base image and installed packages, along with improvements and bugfixes.</li> </ul>"}]}